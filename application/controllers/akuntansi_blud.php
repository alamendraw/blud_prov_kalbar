<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

  
class Akuntansi_Blud extends CI_Controller {

    function __contruct()
    {   
        parent::__construct();
  
    } 
    
    function bulan() {
               
        for ($count = 1; $count <= 12; $count++)
        {
            $result[]= array( 
                     'bln' => $count,
                     'nm_bulan' => $this->tukd_model->getBulan($count)
                     );    
        }  
        echo json_encode($result);   
    }

function bulanx($bln){
            switch ($bln) {
            case '1':
                $bulan="JANUARI";
                break;
            case '2':
                $bulan="FEBRUARI";
                break;
            case '3':
                $bulan="MARET";
                break;
            case '4':
                $bulan="APRIL";
                break;
            case '5':
                $bulan="MEI";
                break;
            case '6':
                $bulan="JUNI";
                break;
            case '7':
                $bulan="JULI";
                break;
            case '8':
                $bulan="AGUSTUS";
                break;
            case '9':
                $bulan="SEPTEMBER";
                break;
            case '10':
                $bulan="OKTOBER";
                break;
            case '11':
                $bulan="NOVEMBER";
                break;
            case '12':
                $bulan="DESEMBER";
                break;

        }
        return $bulan;
}
       
    function config_skpd() {
        $skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_ubah FROM  ms_skpd_blud a LEFT JOIN trhrka_blud b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);

        $test = $query1->num_rows();

        $ii = 0;
        foreach ($query1->result_array() as $resulte) {
            $result = array(
                'id' => $ii,
                'kd_skpd' => $resulte['kd_skpd'],
                'nm_skpd' => $resulte['nm_skpd'],
                'statu' => $resulte['statu'],
                'status_ubah' => $resulte['status_ubah']
            );
            $ii++;
        }
        echo json_encode($result);
        $query1->free_result();
    }
    
    
    function list_ttd() {
        $kd_skpd  = $this->session->userdata('kdskpd');
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd_blud where kd_skpd='$kd_skpd' and kode='PA'order by nama";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
           
    }
    
    
    function skpd() {
        $id_user = $this->session->userdata('pcUser');
        $kd_skpd = $this->session->userdata('kdskpd');
        $id_group=$this->akuntansi_model->get_nama($id_user,'id_group','[user_blud]','id_user');
        $lccr = $this->input->post('q');
        
        if ($id_group=='3'){
            $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd_blud where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') order by kd_skpd ";
        }else{
            $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd_blud where kd_skpd='$kd_skpd'";
        }
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }
    
    function cetak_lo_blud_x(){
        $data['page_title']= 'CETAK LO BLUD (PSAP)';
        $this->template->set('title', 'CETAK LO BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lo_blud_psap',$data) ;    
    } 
    
    function cetak_lra_blud_x(){
        $data['page_title']= 'CETAK LRA BLUD (PSAP)';
        $this->template->set('title', 'CETAK LRA BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lra_blud_psap',$data) ;   
    }

    function cetak_lra_blud_konsol(){
        $data['page_title']= 'CETAK LRA BLUD (PSAP) KONSOL';
        $this->template->set('title', 'CETAK LRA BLUD (PSAP) KONSOL');   
        $this->template->load('template','akuntansi/cetak_lra_blud_konsol',$data) ;   
    }

    
    function cetak_lak_blud_x(){
        $data['page_title']= 'CETAK LAK BLUD (PSAP)';
        $this->template->set('title', 'CETAK LAK BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lak_blud_psap',$data) ;   
    }
    
    function cetak_neraca_blud_x(){
        $data['page_title']= 'CETAK NERACA BLUD (PSAP)';
        $this->template->set('title', 'CETAK NERACA BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_neraca_blud_psap',$data) ;    
    }
    
    function cetak_lpe_blud_x(){
        $data['page_title']= 'CETAK LPE BLUD (PSAP)';
        $this->template->set('title', 'CETAK LPE BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lpe_blud_psap',$data) ;   
    }
    
    function cetak_lpsal_blud_x(){
        $data['page_title']= 'CETAK LPSAL BLUD (PSAP)';
        $this->template->set('title', 'CETAK LPSAL BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lpsal_blud_psap',$data) ; 
    }
    
    function cetak_lo_blud_apbd_x(){
        $data['page_title']= 'CETAK LO APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK LO APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lo_blud_apbd_psap',$data) ;   
    }
    
    function cetak_lra_blud_apbd_x(){
        $data['page_title']= 'CETAK LRA APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK LRA APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lra_blud_apbd_psap',$data) ;  
    }
    
    function cetak_lak_blud_apbd_x(){
        $data['page_title']= 'CETAK LAK APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK LAK APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lak_blud_apbd_psap',$data) ;  
    }
    
    function cetak_neraca_blud_apbd_x(){
        $data['page_title']= 'CETAK NERACA APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK NERACA APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_neraca_blud_apbd_psap',$data) ;   
    }
    
    function cetak_lpe_blud_apbd_x(){
        $data['page_title']= 'CETAK LPE APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK LPE APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lpe_blud_apbd_psap',$data) ;  
    }
    
    function cetak_lpsal_blud_apbd_x(){
        $data['page_title']= 'CETAK LPSAL APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK LPSAL APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/cetak_lpsal_blud_apbd_psap',$data) ;    
    }
    
    function cetak_jurnal_blud_x(){
        $data['page_title']= 'CETAK JURNAL BLUD (PSAP)';
        $this->template->set('title', 'CETAK JURNAL BLUD (PSAP)');   
        $this->template->load('template','akuntansi/jur_umum_blud_psap',$data) ;    
    }
    
    function cetak_jurnal_blud_apbd_x(){
        $data['page_title']= 'CETAK JURNAL APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK  JURNAL APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/jur_umum_blud_apbd_psap',$data) ;   
    }
    
    function cetak_bukubesar_blud_x(){
        $data['page_title']= 'CETAK BUKU BESAR BLUD (PSAP)';
        $this->template->set('title', 'CETAK BUKU BESAR BLUD (PSAP)');   
        $this->template->load('template','akuntansi/bukubesar_blud_psap',$data) ;   
    }
    
    function cetak_bukubesar_blud_apbd_x(){
        $data['page_title']= 'CETAK BUKU BESAR APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK  BUKU BESAR APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/bukubesar_blud_apbd_psap',$data) ;  
    }
    
    function cetak_neracasaldo_blud_x(){
        $data['page_title']= 'CETAK NERACA SALDO BLUD (PSAP)';
        $this->template->set('title', 'CETAK NERACA SALDO BLUD (PSAP)');   
        $this->template->load('template','akuntansi/neracasaldo_blud_psap',$data) ; 
    }

    function cetak_neracasaldo_blud_konsol(){
        $data['page_title']= 'CETAK NERACA SALDO BLUD (PSAP)';
        $this->template->set('title', 'CETAK NERACA SALDO BLUD (PSAP)');   
        $this->template->load('template','akuntansi/neracasaldo_blud_psap_konsol',$data) ; 
    }
    
    function cetak_neracasaldo_blud_apbd_x(){
        $data['page_title']= 'CETAK NERACA SALDO APBD & BLUD (PSAP)';
        $this->template->set('title', 'CETAK  NERACA SALDO APBD & BLUD (PSAP)');   
        $this->template->load('template','akuntansi/neracasaldo_blud_apbd_psap',$data) ;    
    }
    
    function cetak_neracasaldo_skpd_x(){
        $data['page_title']= 'CETAK NERACA SALDO BLUD (PSAP)';
        $this->template->set('title', 'CETAK  NERACA SALDO BLUD (PSAP)');   
        $this->template->load('template','akuntansi/neracasaldo_skpd_psap',$data) ; 
    }
    
    function mapping(){
        $data['page_title']= 'POSTING JURNAL';
        $this->template->set('title', 'POSTING JURNAL');   
        $this->template->load('template','akuntansi/mapping',$data) ;   
    }
    
    function proses_mapping(){
        $user    = $this->session->userdata('pcNama');
        $skpd    = $this->session->userdata('kdskpd');
        $thn     = $this->session->userdata('pcThang');
        $this->db->query("exec jurnal_brewok_blud '$skpd','$user',$thn");     
        echo json_encode($oke=1);

    }
    
    function proses_mapping_transfer(){
        $user    = $this->session->userdata('pcNama');
        $skpd    = $this->session->userdata('kdskpd');
        $thn     = $this->session->userdata('pcThang');
        $this->db->query("exec transfer_data_apbd '$skpd',$thn");      
        echo '1';   
    }
    
    function jumum()
    {
        $data['page_title']= 'INPUT JURNAL UMUM';
        $this->template->set('title', 'INPUT JURNAL UMUM');   
        $this->template->load('template','akuntansi/jumum',$data) ; 
    }
    
    function jumum_psap()
    {
        $data['page_title']= 'INPUT JURNAL UMUM';
        $this->template->set('title', 'INPUT JURNAL UMUM');   
        $this->template->load('template','akuntansi/jumum_psap',$data) ; 
    }
    
    function load_ju() {
        $skpd     = $this->session->userdata('kdskpd');
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ="AND tabel='1'";
        if ($kriteria <> ''){                               
            $where="AND tabel='1' and (upper(no_voucher) like upper('%$kriteria%') or tgl_voucher like '%$kriteria%' or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhju_blud WHERE kd_skpd = '$skpd' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        $result["total"] = $total->total; 
        $query1->free_result(); 
        
        $sql = " select top $rows * from trhju_blud  WHERE kd_skpd = '$skpd' $where and no_voucher not in (select top $offset no_voucher from trhju_blud  WHERE kd_skpd = '$skpd' $where order by tgl_voucher,no_voucher,kd_skpd) order by tgl_voucher,no_voucher,kd_skpd ";//limit $offset,$rows";
        $query1 = $this->db->query($sql);          
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $row[] = array(                        
                        'no_voucher'    => $resulte['no_voucher'],
                        'tgl_voucher'   => $resulte['tgl_voucher'],
                        'kd_skpd'       => $resulte['kd_skpd'],
                        'nm_skpd'        => $resulte['nm_skpd'],
                        'ket'           => trim($resulte['ket']),
                        'reev'           => trim($resulte['reev']),
                        'total_d'         => $resulte['total_d'],
                        'total_k'         => $resulte['total_k']                                                                            
                        );
                        $ii++;
        }
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();                        
    }
   
    function load_dju(){
        $skpd     = $this->session->userdata('kdskpd');
        $nomor = $this->input->post('no');            
        $sql = "SELECT a.no_voucher,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.map_real,case when rk='D' then b.nm_rek5 else SPACE(4)+b.nm_rek5 end AS nm_rek5,b.debet,b.kredit,b.rk,b.jns,b.pos FROM trhju_blud a INNER JOIN trdju_blud b ON a.no_voucher=b.no_voucher AND a.kd_skpd=b.kd_unit
        WHERE a.no_voucher='$nomor' AND a.kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(                                
                        'no_voucher'  => $resulte['no_voucher'],                      
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_rek5'     => $resulte['kd_rek5'],
                        'kd_rek_ang'     => $resulte['map_real'],
                        'nm_rek5'     => $resulte['nm_rek5'],
                        'debet'       => $resulte['debet'],
                        'kredit'      => $resulte['kredit'],
                        'rk'          => $resulte['rk'],   
                        'jns'         => $resulte['jns'],
                        'post'         => $resulte['pos']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_ju_trskpd() {        
        $jenis =$this->input->post('jenis');
        $len = strlen($jenis);
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        
        $jns_beban='';
        $cgiat = '';
        if ($jenis !=''){
            $jns_beban = "and left(a.kd_rek5,$len)='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT distinct a.kd_kegiatan,a.nm_kegiatan,'' kd_program, '' as nm_program, 0 total FROM trdrka_blud a
                WHERE a.kd_skpd='$cskpd' $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(a.nm_kegiatan) LIKE UPPER('%$lccr%'))
                ";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();        
    }
 
    function load_ju_rek() {     
        //$jenis = $this->uri->segment(3);
        $jenis  = $this->input->post('jenis');        
        $len    = strlen($jenis);        
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');       
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');    
        $lenrka = strlen($kode)+strlen($giat)+1;
        $titik  = ".";
            
        if ($rek !=''){
            //if($jenis == '7' || $jenis == '8'  ||  $jenis == '9'){
                //$notIn = " and kd_rek4 not in ($rek) " ;
            //}else{
            $notIn = " and a.kd_rek5 not in ($rek) " ;
            //}
        }else{
            $notIn  = "";
        }
        //echo $jenis;
        /*
        if ($jenis == '4'  ||  $jenis == '5'){
            $sql = "SELECT DISTINCT RIGHT(a.no_trdrka,7) kd_rek5, b.nm_rek5, b.kd_rek5 kd_rek64 FROM trdpo_blud a 
            INNER JOIN ms_rek5_blud b ON a.kd_rek5=b.kd_rek5
            WHERE LEFT(a.no_trdrka,$lenrka) = '$kode$titik$giat' 
            $notIn AND ( upper(b.kd_rek5) like upper('%$lccr%') or upper(b.nm_rek5) like upper('%$lccr%')) order by kd_rek5, kd_rek64";                    
        }
        else {
                           
            $sql = "SELECT kd_rek5, nm_rek5, kd_rek5 kd_rek64 FROM ms_rek5_blud a where left(kd_rek5,$len)='$jenis' $notIn AND ( upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5";
        }*/
        
        $sql = "SELECT kd_rek5, nm_rek5, kd_rek5 kd_rek64 FROM ms_rek5_blud a where left(kd_rek5,$len)='$jenis' $notIn AND ( upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5";
        
            
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(                          
                        'kd_rek5' => $resulte['kd_rek64'],  
                        'kd_rek_ang' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();             
    }
  
    function simpan_ju(){
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd = $this->input->post('nmskpd');
        $ket    = $this->input->post('ket');
        $reev   = $this->input->post('reev');
        $total_d = $this->input->post('total_d');
        $total_k = $this->input->post('total_k');
        $csql    = $this->input->post('sql');
        
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('Y-m-d H:i:s');      
        $msg        = array();
                        if ($tabel == 'trhju_blud') {
                        $sql = "delete from trhju_blud where kd_skpd='$skpd' and no_voucher='$nomor'";
                        $asg = $this->db->query($sql);
                        $sql = "delete from trdju_blud where no_voucher='$nomor' and kd_unit='$skpd'";
                        $asg = $this->db->query($sql);
                        if ($asg){
                            $sql = "insert into trhju_blud(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel,reev) 
                                    values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total_d','$total_k','1','$reev')";
                            $asg = $this->db->query($sql);
                            if (!($asg)){
                               $msg = array('pesan'=>'0');
                               echo json_encode($msg);
                                exit();
                            } else {
                                $msg = array('pesan'=>'1');
                                echo json_encode($msg);
                            }             
                            } else {
                            $msg = array('pesan'=>'0');
                            echo json_encode($msg);
                            exit();
                            }
                        }
            
                         else if ($tabel == 'trdju_blud') {
                            
                            // Simpan Detail //                       
                                $sql = "delete from trdju_blud where no_voucher='$nomor' and kd_unit='$skpd'";
                                $asg = $this->db->query($sql);
                                if (!($asg)){
                                    $msg = array('pesan'=>'0');
                                    echo json_encode($msg);
                                    exit();
                                }else{            
                                    $sql = "insert into trdju_blud(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,kd_unit,pos,urut,map_real)"; 
                    
                                    $asg = $this->db->query($sql.$csql);
                                    if (!($asg)){
                                       $msg = array('pesan'=>'0');
                                        echo json_encode($msg);
                                        exit();
                                    }  else {
                                       $msg = array('pesan'=>'1');
                                        echo json_encode($msg);
                                    }
                                }                                                                 
                        } 
                
    }
  
    function simpan_ju_edit(){
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $no_bku  = $this->input->post('no_bku');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd = $this->input->post('nmskpd');
        $ket    = $this->input->post('ket');
        $reev   = $this->input->post('reev');
        $total_d = $this->input->post('total_d');
        $total_k = $this->input->post('total_k');
        $csql    = $this->input->post('sql');
        
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('Y-m-d H:i:s');      
        $msg        = array();

    
       
                        if ($tabel == 'trhju_blud') {
                        $sql = "delete from trhju_blud where kd_skpd='$skpd' and no_voucher='$no_bku'";
                        $asg = $this->db->query($sql);
                        $sql = "delete from trdju_blud where no_voucher='$no_bku' and kd_unit='$skpd'";
                        $asg = $this->db->query($sql);
                        if ($asg){
                            $sql = "insert into trhju_blud(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel,reev) 
                                    values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total_d','$total_k','1','$reev')";
                            $asg = $this->db->query($sql);
                            if (!($asg)){
                               $msg = array('pesan'=>'0');
                               echo json_encode($msg);
                                exit();
                            } else {
                                $msg = array('pesan'=>'1');
                                echo json_encode($msg);
                            }             
                            } else {
                            $msg = array('pesan'=>'0');
                            echo json_encode($msg);
                            exit();
                            }
                        }
            
                         else if ($tabel == 'trdju_blud') {
                            
                            // Simpan Detail //                       
                                $sql = "delete from trdju_blud where no_voucher='$no_bku' and kd_unit='$skpd'";
                                $asg = $this->db->query($sql);
                                if (!($asg)){
                                    $msg = array('pesan'=>'0');
                                    echo json_encode($msg);
                                    exit();
                                }else{            
                                    $sql = "insert into trdju_blud(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,kd_unit,pos,urut,map_real)"; 
                    
                                    $asg = $this->db->query($sql.$csql);
                                    if (!($asg)){
                                       $msg = array('pesan'=>'0');
                                        echo json_encode($msg);
                                        exit();
                                    }  else {
                                       $msg = array('pesan'=>'1');
                                        echo json_encode($msg);
                                    }
                                }                                                                 
                        } 
                
    }
    
    function hapus_ju(){
        $skpd     = $this->session->userdata('kdskpd');
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdju_blud where no_voucher='$nomor' AND kd_unit='$skpd'";
        $asg = $this->db->query($sql);
        if ($asg){
            $sql = "delete from trhju_blud where no_voucher='$nomor' AND kd_skpd='$skpd'";
            $asg = $this->db->query($sql);
            if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }

    function load_ju_psap() {
        $skpd     = $this->session->userdata('kdskpd');
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ="AND tabel='1'";
        if ($kriteria <> ''){                               
            $where="AND tabel='1' and (upper(no_voucher) like upper('%$kriteria%') or tgl_voucher like '%$kriteria%' or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhju_sap_blud WHERE kd_skpd = '$skpd' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        $result["total"] = $total->total; 
        $query1->free_result(); 
        
        $sql = " select top $rows * from trhju_sap_blud  WHERE kd_skpd = '$skpd' $where and no_voucher not in (select top $offset no_voucher from trhju_sap_blud  WHERE kd_skpd = '$skpd' $where order by tgl_voucher,no_voucher,kd_skpd) order by tgl_voucher,no_voucher,kd_skpd ";//limit $offset,$rows";
        $query1 = $this->db->query($sql);          
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $row[] = array(                        
                        'no_voucher'    => $resulte['no_voucher'],
                        'tgl_voucher'   => $resulte['tgl_voucher'],
                        'kd_skpd'       => $resulte['kd_skpd'],
                        'nm_skpd'        => $resulte['nm_skpd'],
                        'ket'           => trim($resulte['ket']),
                        'reev'           => trim($resulte['reev']),
                        'total_d'         => $resulte['total_d'],
                        'total_k'         => $resulte['total_k']                                                                            
                        );
                        $ii++;
        }
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();                        
    }
    
    function load_dju_psap(){
        $skpd  = $this->session->userdata('kdskpd');
        $nomor = $this->input->post('no');            
        $sql = "SELECT a.no_voucher,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,case when rk='D' then b.nm_rek5 else SPACE(4)+b.nm_rek5 end AS nm_rek5,b.debet,b.kredit,b.rk,b.jns,b.pos FROM trhju_sap_blud a 
        INNER JOIN trdju_sap_blud b ON a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit 
        WHERE a.no_voucher='$nomor' and a.kd_skpd='$skpd' and b.kd_unit='$skpd'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(                                
                        'no_voucher'  => $resulte['no_voucher'],                      
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_rek5'     => $resulte['kd_rek5'],
                        'nm_rek5'     => $resulte['nm_rek5'],
                        'debet'       => $resulte['debet'],
                        'kredit'      => $resulte['kredit'],
                        'rk'          => $resulte['rk'],   
                        'jns'         => $resulte['jns'],
                        'post'         => $resulte['pos']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_ju_trskpd_psap() {        
        $jurnal =$this->input->post('jurnal');
        $jenis =$this->input->post('jenis');
        $len = strlen($jenis);
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        
        $jns_beban='';
        $cgiat = '';
        
        if($jurnal!="8"){
        if ($jenis !=''){
            $jns_beban = "and left(a.jns_kegiatan,$len)='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }      
        }
                  
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();        
    }

    function load_ju_rek_psap() {     
        //$jenis = $this->uri->segment(3);
        $jenis  = $this->input->post('jenis');        
        $len    = strlen($jenis);        
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');       
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');    
        $jurnal = $this->input->post('jurnal');
       
            
        if ($rek !=''){
            //if($jenis == '7' || $jenis == '8'  ||  $jenis == '9'){
                //$notIn = " and kd_rek4 not in ($rek) " ;
            //}else{
            $notIn = " and kd_rek5 not in ($rek) " ;
            //}
        }else{
            $notIn  = "";
        }
        
        /*
        if ($jenis == '4' || $jenis == '5'  ||  $jenis == '6'){
            $sql = "SELECT kd_rek5,nm_rek5 FROM trdrka  WHERE kd_kegiatan= '$giat' AND left(kd_skpd,7) = left('$kode',7) $notIn AND ( upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5";                    
        } else {
   
            $sql = "SELECT kd_rek5,nm_rek5 FROM ms_rek5 where left(kd_rek5,$len)='$jenis' $notIn AND ( upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5";            
        }                       
        */
        
         if($jurnal=="8"){
            $sql = "SELECT a.kd_rek64 as kd_rek5,a.kd_rek5 as kd_rek13,a.nm_rek5 FROM ms_rek5 a where left(a.kd_rek5,$len)='$jenis' $notIn AND ( upper(a.kd_rek5) like upper('%$lccr%') or upper(a.nm_rek5) like upper('%$lccr%')) order by a.kd_rek5";                        
        }else{
        
        if ($jenis == '4' || $jenis == '5'  ||  $jenis == '6'){
            $sql = "select (select kd_rek64 from ms_rek5 where kd_rek5=a.kd_rek5) as kd_rek5,a.kd_rek5 as kd_rek13,a.nm_rek5 from trdrka a where a.kd_kegiatan= '$giat' AND left(a.kd_skpd,7) = left('$kode',7) $notIn AND ( upper(a.kd_rek5) like upper('%$lccr%') or upper(a.nm_rek5) like upper('%$lccr%')) order by a.kd_rek5";                    
        } else {                
            $sql = "SELECT a.kd_rek64 as kd_rek5,a.kd_rek5 as kd_rek13,a.nm_rek5 FROM ms_rek5 a where left(a.kd_rek5,$len)='$jenis' $notIn AND ( upper(a.kd_rek5) like upper('%$lccr%') or upper(a.nm_rek5) like upper('%$lccr%')) order by a.kd_rek5";            
        }     
        }
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(                          
                        'kd_rek5' => $resulte['kd_rek5'], 
                        'kd_rek13' => $resulte['kd_rek13'], 
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();             
    }
    
    function simpan_ju_psap(){
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd = $this->input->post('nmskpd');
        $ket    = $this->input->post('ket');
        $reev   = $this->input->post('reev');
        $total_d = $this->input->post('total_d');
        $total_k = $this->input->post('total_k');
        $csql    = $this->input->post('sql');
        
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('Y-m-d H:i:s');      
        $msg        = array();

        if ($tabel == 'trhju_sap_blud') {
            $sql = "delete from trhju_sap_blud where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            $sql = "delete from trdju_sap_blud where no_voucher='$nomor' and kd_unit='$skpd'";
            $asg = $this->db->query($sql);
            if ($asg){
                $sql = "insert into trhju_sap_blud(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel,reev) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total_d','$total_k','1','$reev')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        } else if ($tabel == 'trdju_sap_blud') {
            
            // Simpan Detail //                       
                $sql = "delete from trdju_sap_blud where no_voucher='$nomor' and kd_unit='$skpd'";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdju_sap_blud(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,map_real,nm_rek5,debet,kredit,rk,jns,kd_unit,pos,urut)";     
                    $asg = $this->db->query($sql.$csql);
                    
                    /*$sql7 = "UPDATE trdju_sap_blud SET trdju_sap_blud.map_real = ms_rek5.kd_rek5 FROM trdju_sap_blud INNER JOIN ms_rek5 
                               ON trdju_sap_blud.kd_rek5 = ms_rek5.kd_rek64 
                               where trdju_sap_blud.kd_unit='$skpd' and trdju_sap_blud.no_voucher='$nomor'";
                    $asg = $this->db->query($sql7); */
                       
                    if (!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                         $msg = array('pesan'=>'1');
                       echo json_encode($msg);
                    }                    
                }                                                                 
        } 
    }
    
    function hapus_ju_psap(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdju_sap_blud where no_voucher='$nomor'";
        $asg = $this->db->query($sql);
        if ($asg){
            $sql = "delete from trhju_sap_blud where no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function jur_umum(){
        $data['page_title']= 'JURNAL APBD & BLUD';
        $this->template->set('title', 'JURNAL APBD & BLUD');
        
        $id_user     = $this->session->userdata('pcUser');
        $id_group=$this->akuntansi_model->get_nama($id_user,'id_group','[user_blud]','id_user');
        
        if ($id_group=='3'){                    
        $this->template->load('template','akuntansi/jur_umum_all',$data) ;  
        }else{
        $this->template->load('template','akuntansi/jur_umum',$data) ;  
        } 
    
    } 
    
    function jur_umum_blud(){
        $data['page_title']= 'JURNAL BLUD';
        $this->template->set('title', 'JURNAL BLUD');   
        
        $id_user     = $this->session->userdata('pcUser');
        $id_group=$this->akuntansi_model->get_nama($id_user,'id_group','[user_blud]','id_user');
        
        if ($id_group=='3'){                    
        $this->template->load('template','akuntansi/jur_umum_blud_all',$data) ; 
        }else{
        $this->template->load('template','akuntansi/jur_umum_blud',$data) ;  
        } 
        
    }
    
    function buku_besar(){
    
        $data['page_title']= 'BUKU BESAR APBD & BLUD';
        $this->template->set('title', 'BUKU BESAR APBD & BLUD');   
        
        $id_user     = $this->session->userdata('pcUser');
        $id_group=$this->akuntansi_model->get_nama($id_user,'id_group','[user_blud]','id_user');
        
        if ($id_group=='3'){                    
        $this->template->load('template','akuntansi/bukubesar_all',$data) ;
        }else{
        $this->template->load('template','akuntansi/bukubesar',$data) ;
        } 
    
    }
    
    
    function buku_besar_blud(){
    
        $data['page_title']= 'BUKU BESAR BLUD';
        $this->template->set('title', 'BUKU BESAR BLUD');       
        
        $id_user     = $this->session->userdata('pcUser');
        $id_group=$this->akuntansi_model->get_nama($id_user,'id_group','[user_blud]','id_user');
        
        if ($id_group=='3'){                    
        $this->template->load('template','akuntansi/bukubesar_blud_all',$data) ; 
        }else{
        $this->template->load('template','akuntansi/bukubesar_blud',$data) ; 
        } 
        
    }
    
    
    function cetakbb_kelompok($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB
        
        $thn_ang = $this->session->userdata('pcThang');
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR APBD DAN BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5_blud','kd_rek5').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
        if (substr($rek5,0,1)=='5'){
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'";
        } else {
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'";
        }
         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = $trh4->debet;
         $awalkredit = $trh4->kredit;
                    if ((substr($rek5,0,1)=='1') or (substr($rek5,0,1)=='5')){                  
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                if (substr($rek5,0,1)=='5'){
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' 
                                           order by tgl_voucher,no_voucher");
                } else {
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' 
                                           order by tgl_voucher,no_voucher");
                }
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='1') or (substr($rek5,0,1)=='5')){                  
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok </title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    
    function rekening_blud_kelompok() {
        $lccr = $this->input->post('q');
        $skpd = $this->session->userdata('kdskpd');     
        $sql = " SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(nm_rek5,'') nm_rek5 FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd='$skpd' and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) group by kd_rek5,nm_rek5 order by kd_rek5";
 
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    }
    
    function rekening_blud_kelompok_blud_psap() {
        $lccr = $this->input->post('q');
        $skpd = $this->session->userdata('kdskpd'); 


        $sql="SELECT DISTINCT
                    isnull(a.kd_rek5, '') kd_rek5,
                    isnull(c.nm_rek5, '') nm_rek5
                FROM
                    trdju_sap_blud a
                inner join ms_rek5_blud c on c.kd_rek5=a.kd_rek5
                ORDER BY kd_rek5";    
/*        $sql = " SELECT DISTINCT isnull(a.kd_rek5,'') kd_rek5 , isnull(nm_rek5,'') nm_rek5 FROM trdju_sap_blud a 
            inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd='$skpd' --and a.kd_subkegiatan='95' 
                 and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) 
                 group by kd_rek5,nm_rek5 order by kd_rek5";*/
 
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    }
    
    function rekening_blud_kelompok_blud_apbd_psap() {
        $lccr = $this->input->post('q');
        $skpd = $this->session->userdata('kdskpd');     
        $sql = " SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(nm_rek5,'') nm_rek5 FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd='$skpd' and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) group by kd_rek5,nm_rek5 order by kd_rek5";
 
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    }
    
    function bukubesar_blud_blud(){
    
        $data['page_title']= 'CETAK BUKU BESAR BLUD';
        $this->template->set('title', 'BUKU BESAR BLUD');   
        $this->template->load('template','akuntansi/bukubesar_blud_blud',$data) ;   
    
    }
    
    function cetakbb_kelompok_blud($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB 
        
        $thn_ang = $this->session->userdata('pcThang');
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5_blud','kd_rek5').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
        if (substr($rek5,0,1)=='5'){
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak' and reev in ('0','2')";
        } else {
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak' and reev in ('0','2')";
        }
         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = $trh4->debet;
         $awalkredit = $trh4->kredit;
                    if ((substr($rek5,0,1)=='1') or (substr($rek5,0,1)=='5')){                  
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                if (substr($rek5,0,1)=='5'){
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' and reev in ('0','2') 
                                           order by tgl_voucher,no_voucher");
                } else {
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' and reev in ('0','2') 
                                           order by tgl_voucher,no_voucher");
                }
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='1') or (substr($rek5,0,1)=='5')){                  
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    

    
    function cetakbb_kelompok_blud_psap($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB    
        
        $thn_ang = $this->session->userdata('pcThang');
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek64').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
     if ((substr($rek5,0,3)=='118') or (substr($rek5,0,7)=='3130101') or (substr($rek5,0,1)=='8') or (substr($rek5,0,1)=='9')){
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'   AND YEAR(b.tgl_voucher)='$thn_ang' and a.kd_subkegiatan='95'";
        } else {
         $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'  and a.kd_subkegiatan='95'  ";
        }
         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = $trh4->debet;
         $awalkredit = $trh4->kredit;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' --and a.kd_subkegiatan='95'
                                           order by tgl_voucher,no_voucher");
                
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    

    
    function cetakbb_kelompok_blud_apbd_psap($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB   
        
        $thn_ang = $this->session->userdata('pcThang');
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR APBD & BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek64').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
     if ((substr($rek5,0,3)=='118') or (substr($rek5,0,7)=='3130101') or (substr($rek5,0,7)=='3130102')  or (substr($rek5,0,1)=='8') or (substr($rek5,0,1)=='9')){
        $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'   AND YEAR(b.tgl_voucher)='$thn_ang'";
        } else {
         $csql3 = "SELECT sum(a.debet) as debet,sum(a.kredit) as kredit FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' and b.tgl_voucher < '$dcetak'   ";
        }

         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = $trh4->debet;
         $awalkredit = $trh4->kredit;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                 
                 $oke="SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND b.kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'
                                           order by tgl_voucher,no_voucher";
                                          // echo "$oke";

                $query = $this->db->query($oke);
                
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok APBD & BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    

    
    function cetakbb_ekuitas_blud_apbd_psap($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB    
        
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1=$thn_ang-1;
        
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR APBD & BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek64').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
     //if ((substr($rek5,0,3)=='118') or (substr($rek5,0,7)=='3130101') or (substr($rek5,0,7)=='3130102')  or (substr($rek5,0,1)=='8') or (substr($rek5,0,1)=='9')){
        $csql3 = "select sum(c.saldo) saldo from(

SELECT isnull(SUM(a.kredit),0)-isnull(SUM(a.debet),0) AS saldo FROM trdju_sap_blud a INNER JOIN trhju_sap_blud b 
ON a.no_voucher = b.no_voucher and a.kd_unit=b.kd_skpd WHERE b.kd_skpd='$skpd' AND a.kd_rek5='3110101' AND YEAR(b.tgl_voucher)<'$thn_ang'
and b.tabel=1 and reev=0
union all
select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<'$thn_ang_1' and left(kd_rek5,1) in ('8') and b.kd_skpd='$skpd'
union all
select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<'$thn_ang_1' and left(kd_rek5,1) in ('9') and b.kd_skpd='$skpd'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and left(b.kd_rek5,1)='1' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd'
union all


select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)='$thn_ang_1' and left(kd_rek5,1) in ('8') and kd_skpd='$skpd'
union all
select isnull(sum(debet-kredit),0)*-1 as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)='$thn_ang_1' and left(kd_rek5,1) in ('9') and kd_skpd='$skpd'
union all


select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit 
where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd'
union all

select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a inner join trdju_sap_blud b on a.no_voucher=b.no_voucher 
and b.kd_unit=a.kd_skpd where kd_rek5='3130101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd'
)c
";
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = 0;
         $awalkredit = $trh4->saldo;
         
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' 
                                           union all
                                           select 
c.kd_unit,'3110101' kd_rek5,
case when sum(c.nilai)<0 then sum(c.nilai)*-1 else 0 end as debet,
case when sum(c.nilai)>0 then sum(c.nilai) else 0 end as kredit,
'2018-12-31' tgl_voucher,'EKUITAS PEMBALIK' ket,'z.EKUITAS-PEMBALIK-31-12-2018-'+c.kd_unit no_voucher
from(
select a.kd_unit kd_unit,isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
where year(tgl_voucher)='$thn_ang' and left(kd_rek5,1) in ('8') and kd_skpd='$skpd' group by a.kd_unit
union all
select a.kd_unit kd_unit,isnull(sum(debet-kredit),0)*-1 as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
where year(tgl_voucher)='$thn_ang' and left(kd_rek5,1) in ('9') and kd_skpd='$skpd' group by a.kd_unit
)c group by c.kd_unit
                                           order by tgl_voucher,no_voucher");  
                
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok APBD & BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    
    
    function cetakbb_ekuitas_blud_psap($dcetak='',/*$ttd='',*/$skpd='',$rek5='',$dcetak2='', $jenis=''){ //Henri_TB 
        
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1=$thn_ang-1;
        
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>BUKU BESAR APBD & BLUD</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B>'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd')).'</B></TD>
                    </TR>
                    <TR>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                        <TD align="center" ><B></B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >Rekening</TD>
                        <TD align="left" width="80%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek64').'</TD>
                     </TR>
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >TANGGAL</TD>
                        <TD width="30%" bgcolor="#CCCCCC" align="center" >URAIAN</TD>
                        <TD width="5%" bgcolor="#CCCCCC" align="center" >REF</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >SALDO</TD>
                     </TR>
                     </THEAD>';
        
     //if ((substr($rek5,0,3)=='118') or (substr($rek5,0,7)=='3130101') or (substr($rek5,0,7)=='3130102')  or (substr($rek5,0,1)=='8') or (substr($rek5,0,1)=='9')){
        $csql3 = "select sum(c.saldo) saldo from(

SELECT isnull(SUM(a.kredit),0)-isnull(SUM(a.debet),0) AS saldo FROM trdju_sap_blud a INNER JOIN trhju_sap_blud b 
ON a.no_voucher = b.no_voucher and a.kd_unit=b.kd_skpd WHERE b.kd_skpd='$skpd' AND a.kd_rek5='3110101' AND YEAR(b.tgl_voucher)<'$thn_ang'
and b.tabel=1 and reev=0 and a.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<'$thn_ang_1' and left(kd_rek5,1) in ('8') and b.kd_skpd='$skpd' and a.kd_subkegiatan='95'
union all
select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<'$thn_ang_1' and left(kd_rek5,1) in ('9') and b.kd_skpd='$skpd' and a.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and left(b.kd_rek5,1)='1' and year(a.tgl_voucher)<'$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all


select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)='$thn_ang_1' and left(kd_rek5,1) in ('8') and kd_skpd='$skpd' and a.kd_subkegiatan='95'
union all
select isnull(sum(debet-kredit),0)*-1 as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)='$thn_ang_1' and left(kd_rek5,1) in ('9') and kd_skpd='$skpd' and a.kd_subkegiatan='95'
union all


select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all
select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit 
where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
union all

select isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a inner join trdju_sap_blud b on a.no_voucher=b.no_voucher 
and b.kd_unit=a.kd_skpd where kd_rek5='3130101' and year(a.tgl_voucher)='$thn_ang_1' and kd_skpd='$skpd' and b.kd_subkegiatan='95'
)c
";
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         $awaldebet = 0;
         $awalkredit = $trh4->saldo;
         
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$awaldebet-$awalkredit;
                    }else{
                        $saldo=$awalkredit-$awaldebet;
                    } 
                    if($saldo<0){
                    $a='(';
                    $saldo1=$saldo*-1;
                    $b=')';
                    } else{
                    $a='';
                    $saldo1=$saldo;
                    $b='';  
                    }
                    $cRet .='<TR>
                                <TD width="10%" align="left" ></TD>
                                <TD width="30%" align="left" >saldo awal</TD>
                                <TD width="5%" align="left" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$a.''.number_format($saldo1,"2",",",".").''.$b.'</TD>
                             </TR>';          
                
                $idx=1;
                
                
                $query = $this->db->query("SELECT a.kd_unit,a.kd_rek5,a.debet,a.kredit,b.tgl_voucher,b.ket,b.no_voucher FROM trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher=b.no_voucher AND a.kd_unit=b.kd_skpd WHERE a.kd_rek5='$rek5' AND kd_skpd='$skpd' AND b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'  and a.kd_subkegiatan='95'
                                           union all
                                           select 
c.kd_unit,'3110101' kd_rek5,
case when sum(c.nilai)<0 then sum(c.nilai)*-1 else 0 end as debet,
case when sum(c.nilai)>0 then sum(c.nilai) else 0 end as kredit,
'2018-12-31' tgl_voucher,'EKUITAS PEMBALIK' ket,'z.EKUITAS-PEMBALIK-31-12-2018-'+c.kd_unit no_voucher
from(
select a.kd_unit kd_unit,isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
where year(tgl_voucher)='$thn_ang' and left(kd_rek5,1) in ('8') and kd_skpd='$skpd' and a.kd_subkegiatan='95' group by a.kd_unit
union all
select a.kd_unit kd_unit,isnull(sum(debet-kredit),0)*-1 as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
where year(tgl_voucher)='$thn_ang' and left(kd_rek5,1) in ('9') and kd_skpd='$skpd' and a.kd_subkegiatan='95' group by a.kd_unit
)c group by c.kd_unit
                                           order by tgl_voucher,no_voucher");  
                
                
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $tgl_voucher=$res['tgl_voucher'];
                    $ket=$res['ket'];
                    $ref=$res['no_voucher'];
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $unitt =$res['kd_unit'];
                    $idx++;
                    if($debet<0){
                        $debet1=$debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $c='';
                        $d='';  
                        $debet1=$debet;
                        }
                    if($kredit<0){
                        $kredit1=$kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $e='';
                        $f='';  
                        $kredit1=$kredit;
                        }   
                    $saldo=$saldo;
                    if ((substr($rek5,0,1)=='9') or (substr($rek5,0,1)=='5') or (substr($rek5,0,2)=='62') or (substr($rek5,0,2)=='72') or (substr($rek5,0,1)=='1')){                    
                        $saldo=$saldo+$debet-$kredit;
                    }else{
                        $saldo=$saldo+$kredit-$debet;
                    }
                    if($saldo<0){
                        $saldo1=$saldo*-1;
                        $i='(';
                        $j=')';
                        }else{
                        $saldo1=$saldo;
                        $i='';
                        $j='';  
                        }
                    $cRet .='<TR>
                                <TD width="10%" align="left" >'.$this->tukd_model->tanggal_format_indonesia($tgl_voucher).'</TD>
                                <TD width="30%" align="left" >'.$ket.'</TD>
                                <TD width="5%" align="left" >'.$ref.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($kredit1,"2",",",".").''.$f.'</TD>
                                <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                             </TR>';
                             
                    $jdebet=$jdebet+$debet;
                    $jkredit = $jkredit + $kredit;
    
                }
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="30%" align="left" >JUMLAH</TD>
                    <TD width="5%" align="left" ></TD>
                    <TD width="15%" align="right" >'.$k.''.number_format($jdebet1,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jkredit1,"2",",",".").''.$n.'</TD>
                    <TD width="15%" align="right" >'.$i.''.number_format($saldo1,"2",",",".").''.$j.'</TD>
                 </TR>';
                $cRet .='</TABLE>';              
                } else{
                
                $cRet .='</TABLE>';
                }
            
            if($jenis == 1){
            echo '<title> Buku Besar Kelompok APBD & BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }
    

    function lap_lo_konsol($cbulan="", $pilih=1){// created by henri_tb
        $cetak='2';//$ctk;
        $id         = $this->session->userdata('kdskpd');
        //$id           = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
                
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
            
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN OPERASIONAL APBD DAN BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo=" select '1' bold, '4' kode, 'PENDAPATAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '41' kode, 'PENDAPATAN JASA LAYANAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '411' kode, 'Jasa Layanan Kesehatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411')
                    union all
                    select '4' bold, '412' kode, 'Penyesuaian Pendapatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('412')
                    union all
                    select '5' bold, '4129' kode, 'Jumlah Pendapatan Jasa Layanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411', '412')
                    union all
                    select '0' bold, '41299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '42' kode, 'PENDAPATAN HIBAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '421' kode, 'Hibah Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421')
                    union all
                    select '4' bold, '422' kode, 'Hibah Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('422')
                    union all
                    select '4' bold, '423' kode, 'Hibah Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('423')
                    union all
                    select '5' bold, '4239' kode, 'Jumlah Pendapatan Hibah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421','422','423')
                    union all
                    select '0' bold, '42399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '43' kode, 'HASIL KERJASAMA DENGAN PIHAK LAIN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '431' kode, 'Hasil Kerjasama Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431')
                    union all
                    select '4' bold, '432' kode, 'Pendapatan Sewa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('432')
                    union all
                    select '4' bold, '433' kode, 'Pendapatan Kerjasama Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('433')
                    union all
                    select '5' bold, '4339' kode, 'Jumlah Pendapatan Hasil Kerjasama' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431','432','433')
                    union all
                    select '0' bold, '43399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '44' kode, 'PENDAPATAN APBD' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '441' kode, 'APBD Kota Pontianak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441')
                    union all
                    select '4' bold, '442' kode, 'APBD Provinsi Kalimantan Barat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('442')
                    union all
                    select '4' bold, '443' kode, 'APBD Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('443')
                    union all
                    select '5' bold, '4439' kode, 'Jumlah Pendapatan APBD' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441','442','443')
                    union all
                    select '0' bold, '44399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '45' kode, 'PENDAPATAN APBN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '451' kode, 'APBN - Dana Dekonsentrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451')
                    union all
                    select '4' bold, '452' kode, 'APBN - Tugas Pembantuan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('452')
                    union all
                    select '4' bold, '453' kode, 'APBN - Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('453')
                    union all
                    select '5' bold, '4539' kode, 'Jumlah Pendapatan APBN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451','452','453')
                    union all
                    select '0' bold, '45399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '453999' kode, 'LAIN-LAIN PENDAPATAN BLUD YANG SAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '461' kode, 'Hasil Penjualan Kekayaan yang Tidak Dipisahkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461')
                    union all
                    select '4' bold, '462' kode, 'Hasil Pemanfaatan Kekayaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('462')
                    union all
                    select '4' bold, '463' kode, 'Jasa Giro' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('463')
                    union all
                    select '4' bold, '464' kode, 'Pendapatan Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('464')
                    union all
                    select '4' bold, '465' kode, 'Keuntungan Selisih Nilai Tukar Rupiah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('465')
                    union all
                    select '4' bold, '466' kode, 'Komisi dan Potongan Penjualan/Pengadaan Barang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('466')
                    union all
                    select '4' bold, '467' kode, 'Hasil Investasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('467')
                    union all
                    select '4' bold, '468' kode, 'Lain-lain Pendapatan BLUD yang Sah Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('468')
                    union all
                    select '5' bold, '4689' kode, 'Jumlah Lain-lain Pendapatan yang Sah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461','462','463','464','465','466','467','468')
                    union all
                    select '5' bold, '46899' kode, 'JUMLAH PENDAPATAN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4')
                    union all
                    select '0' bold, '468999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '5' kode, 'BIAYA' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '51' kode, 'BIAYA OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '511' kode, 'BIAYA PELAYANAN' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5111' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5111')
                    union all
                    select '4' bold, '5112' kode, 'Biaya Bahan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5112')
                    union all
                    select '4' bold, '5113' kode, 'Biaya Jasa Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5113')
                    union all
                    select '4' bold, '5114' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5114')
                    union all
                    select '4' bold, '5115' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5115')
                    union all
                    select '4' bold, '5116' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5116')
                    union all
                    select '4' bold, '5117' kode, 'Biaya Pelayanan Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5117')
                    union all
                    select '5' bold, '51179' kode, 'Jumlah Biaya Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('511')
                    union all
                    select '0' bold, '51179' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '512' kode, 'BIAYA UMUM DAN ADMINISTRASI' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5121' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5121')
                    union all
                    select '4' bold, '5122' kode, 'Biaya Administrasi Kantor' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5122')
                    union all
                    select '4' bold, '5123' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5123')
                    union all
                    select '4' bold, '5124' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5124')
                    union all
                    select '4' bold, '5125' kode, 'Biaya Promosi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5125')
                    union all
                    select '4' bold, '5126' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5126')
                    union all
                    select '4' bold, '5127' kode, 'Biaya Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5127')
                    union all
                    select '4' bold, '5128' kode, 'Biaya Umum dan Administrasi Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5128')
                    union all
                    select '5' bold, '51289' kode, 'Jumlah Biaya Umum dan Administrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('512')
                    union all
                    select '5' bold, '512899' kode, 'Jumlah Biaya Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,2) in ('51')
                    union all
                    select '0' bold, '5199999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '530' kode, 'BIAYA NON-OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5301' kode, 'Biaya Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5301')
                    union all
                    select '4' bold, '5302' kode, 'Biaya Administrasi Bank' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5302')
                    union all
                    select '4' bold, '5303' kode, 'Biaya Kerugian Penjualan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5303')
                    union all
                    select '4' bold, '5304' kode, 'Biaya Kerugian Penurunan Nilai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5304')
                    union all
                    select '4' bold, '5305' kode, 'Biaya Non-Operasional Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5305')
                    union all
                    select '5' bold, '53059' kode, 'Jumlah Biaya Non-Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('530')
                    union all
                    select '5' bold, '530599' kode, 'JUMLAH BIAYA' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('5')
                    union all
                    select '0' bold, '5305999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '6' bold, '53059999' kode, 'JUMLAH SURPLUS/DEFISIT DARI OPERASI' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4','5')
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    if ($nil < 0){
                        $lo1="("; $nilaix=$nil*-1; $lo01=")";}
                    else {
                        $lo1=""; $nilaix=$nil; $lo01="";}
                    $nilai = number_format($nilaix,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lo2="("; $nilai_lalux=$nil_lalu*-1; $lo02=")";}
                    else {
                        $lo2=""; $nilai_lalux=$nil_lalu; $lo02="";}
                    $nilai_lalu = number_format($nilai_lalux,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        
                    
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO Konsol / $cbulan");
        $this->template->set('title', 'LO Konsol / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO Konsol / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    
    function lap_lo($cbulan="", $kdskpd="", $pilih=1){// created by henri_tb
        $cetak='2';//$ctk;
        //$id       = $this->session->userdata('kdskpd');
        $id         = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
        
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN OPERASIONAL APBD DAN BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo=" select '1' bold, '4' kode, 'PENDAPATAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '41' kode, 'PENDAPATAN JASA LAYANAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '411' kode, 'Jasa Layanan Kesehatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411')
                    union all
                    select '4' bold, '412' kode, 'Penyesuaian Pendapatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('412')
                    union all
                    select '5' bold, '4129' kode, 'Jumlah Pendapatan Jasa Layanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411', '412')
                    union all
                    select '0' bold, '41299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '42' kode, 'PENDAPATAN HIBAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '421' kode, 'Hibah Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421')
                    union all
                    select '4' bold, '422' kode, 'Hibah Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('422')
                    union all
                    select '4' bold, '423' kode, 'Hibah Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('423')
                    union all
                    select '5' bold, '4239' kode, 'Jumlah Pendapatan Hibah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421','422','423')
                    union all
                    select '0' bold, '42399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '43' kode, 'HASIL KERJASAMA DENGAN PIHAK LAIN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '431' kode, 'Hasil Kerjasama Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431')
                    union all
                    select '4' bold, '432' kode, 'Pendapatan Sewa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('432')
                    union all
                    select '4' bold, '433' kode, 'Pendapatan Kerjasama Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('433')
                    union all
                    select '5' bold, '4339' kode, 'Jumlah Pendapatan Hasil Kerjasama' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431','432','433')
                    union all
                    select '0' bold, '43399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '44' kode, 'PENDAPATAN APBD' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '441' kode, 'APBD Kota Pontianak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441')
                    union all
                    select '4' bold, '442' kode, 'APBD Provinsi Kalimantan Barat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('442')
                    union all
                    select '4' bold, '443' kode, 'APBD Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('443')
                    union all
                    select '5' bold, '4439' kode, 'Jumlah Pendapatan APBD' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441','442','443')
                    union all
                    select '0' bold, '44399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '45' kode, 'PENDAPATAN APBN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '451' kode, 'APBN - Dana Dekonsentrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451')
                    union all
                    select '4' bold, '452' kode, 'APBN - Tugas Pembantuan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('452')
                    union all
                    select '4' bold, '453' kode, 'APBN - Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('453')
                    union all
                    select '5' bold, '4539' kode, 'Jumlah Pendapatan APBN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451','452','453')
                    union all
                    select '0' bold, '45399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '453999' kode, 'LAIN-LAIN PENDAPATAN BLUD YANG SAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '461' kode, 'Hasil Penjualan Kekayaan yang Tidak Dipisahkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461')
                    union all
                    select '4' bold, '462' kode, 'Hasil Pemanfaatan Kekayaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('462')
                    union all
                    select '4' bold, '463' kode, 'Jasa Giro' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('463')
                    union all
                    select '4' bold, '464' kode, 'Pendapatan Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('464')
                    union all
                    select '4' bold, '465' kode, 'Keuntungan Selisih Nilai Tukar Rupiah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('465')
                    union all
                    select '4' bold, '466' kode, 'Komisi dan Potongan Penjualan/Pengadaan Barang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('466')
                    union all
                    select '4' bold, '467' kode, 'Hasil Investasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('467')
                    union all
                    select '4' bold, '468' kode, 'Lain-lain Pendapatan BLUD yang Sah Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('468')
                    union all
                    select '5' bold, '4689' kode, 'Jumlah Lain-lain Pendapatan yang Sah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461','462','463','464','465','466','467','468')
                    union all
                    select '5' bold, '46899' kode, 'JUMLAH PENDAPATAN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4')
                    union all
                    select '0' bold, '468999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '5' kode, 'BIAYA' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '51' kode, 'BIAYA OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '511' kode, 'BIAYA PELAYANAN' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5111' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5111')
                    union all
                    select '4' bold, '5112' kode, 'Biaya Bahan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5112')
                    union all
                    select '4' bold, '5113' kode, 'Biaya Jasa Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5113')
                    union all
                    select '4' bold, '5114' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5114')
                    union all
                    select '4' bold, '5115' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5115')
                    union all
                    select '4' bold, '5116' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5116')
                    union all
                    select '4' bold, '5117' kode, 'Biaya Pelayanan Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5117')
                    union all
                    select '5' bold, '51179' kode, 'Jumlah Biaya Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('511')
                    union all
                    select '0' bold, '51179' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '512' kode, 'BIAYA UMUM DAN ADMINISTRASI' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5121' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5121')
                    union all
                    select '4' bold, '5122' kode, 'Biaya Administrasi Kantor' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5122')
                    union all
                    select '4' bold, '5123' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5123')
                    union all
                    select '4' bold, '5124' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5124')
                    union all
                    select '4' bold, '5125' kode, 'Biaya Promosi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5125')
                    union all
                    select '4' bold, '5126' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5126')
                    union all
                    select '4' bold, '5127' kode, 'Biaya Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5127')
                    union all
                    select '4' bold, '5128' kode, 'Biaya Umum dan Administrasi Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5128')
                    union all
                    select '5' bold, '51289' kode, 'Jumlah Biaya Umum dan Administrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('512')
                    union all
                    select '5' bold, '512899' kode, 'Jumlah Biaya Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,2) in ('51')
                    union all
                    select '0' bold, '5199999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '530' kode, 'BIAYA NON-OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5301' kode, 'Biaya Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5301')
                    union all
                    select '4' bold, '5302' kode, 'Biaya Administrasi Bank' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5302')
                    union all
                    select '4' bold, '5303' kode, 'Biaya Kerugian Penjualan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5303')
                    union all
                    select '4' bold, '5304' kode, 'Biaya Kerugian Penurunan Nilai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5304')
                    union all
                    select '4' bold, '5305' kode, 'Biaya Non-Operasional Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5305')
                    union all
                    select '5' bold, '53059' kode, 'Jumlah Biaya Non-Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('530')
                    union all
                    select '5' bold, '530599' kode, 'JUMLAH BIAYA' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('5')
                    union all
                    select '0' bold, '5305999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '6' bold, '53059999' kode, 'JUMLAH SURPLUS/DEFISIT DARI OPERASI' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4','5')
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    if ($nil < 0){
                        $lo1="("; $nilaix=$nil*-1; $lo01=")";}
                    else {
                        $lo1=""; $nilaix=$nil; $lo01="";}
                    $nilai = number_format($nilaix,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lo2="("; $nilai_lalux=$nil_lalu*-1; $lo02=")";}
                    else {
                        $lo2=""; $nilai_lalux=$nil_lalu; $lo02="";}
                    $nilai_lalu = number_format($nilai_lalux,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO $id / $cbulan");
        $this->template->set('title', 'LO $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO $id / $cbulan</title>");
             echo $cRet;
        break;
        case 0;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    function cetak_neraca(){
        $data['page_title']= 'NERACA APBD & BLUD';
        $this->template->set('title', 'NERACA APBD & BLUD');   
        $this->template->load('template','akuntansi/cetak_neraca',$data) ; 
    }
    
    function cetak_neraca_blud(){
        $data['page_title']= 'NERACA BLUD';
        $this->template->set('title', 'NERACA BLUD');   
        $this->template->load('template','akuntansi/cetak_neraca_blud',$data) ; 
    }
    
    function cetak_lak(){
        $data['page_title']= 'LAK APBD & BLUD';
        $this->template->set('title', 'LAK APBD & BLUD');   
        $this->template->load('template','akuntansi/cetak_lak',$data) ; 
    }
    
    function cetak_lak_blud(){
        $data['page_title']= 'LAK BLUD';
        $this->template->set('title', 'LAK BLUD');   
        $this->template->load('template','akuntansi/cetak_lak_blud',$data) ; 
    }
    
    
    function cetak_lo(){
        $data['page_title']= 'LO APBD & BLUD';
        $this->template->set('title', 'LO APBD & BLUD');   
        $this->template->load('template','akuntansi/cetak_lo',$data) ; 
    }
    
    function cetak_lo_blud(){
        $data['page_title']= 'LO BLUD';
        $this->template->set('title', 'LO BLUD');   
        $this->template->load('template','akuntansi/cetak_lo_blud',$data) ; 
    }
    
    function lap_neraca_konsol($cbulan="", $pilih=1){// created by henri_tb *koreksi galih
        $cetak      ='2';//$ctk;
        $id         = $this->session->userdata('kdskpd');
        //$id           = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
            
                    if($cbulan<10){
                     $xbulan="0$cbulan";
                     }
                    else{
                    $xbulan=$cbulan;
                    }
    
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
        
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        

            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('4') and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$cbulan' and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('4') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('5') and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$cbulan' and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('5') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"5\" align=\"center\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>NERACA APBD DAN BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>PER $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
                

        $sqlmaplo="select '1' bold, '1' kode, 'ASET' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '11' kode, 'ASET LANCAR' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '111' kode, 'Kas dan Setara Kas' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('111')
                    union all
                    select '4' bold, '112' kode, 'Investasi Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('112')
                    union all
                    select '4' bold, '113' kode, 'Piutang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('113')
                    union all
                    select '4' bold, '114' kode, 'Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('118')
                    union all
                    select '4' bold, '115' kode, 'Piutang Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('114')
                    union all
                    select '4' bold, '116' kode, 'Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('115')
                    union all
                    select '4' bold, '117' kode, 'Uang Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('116')
                    union all
                    select '4' bold, '118' kode, 'Biaya Dibayar di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('117')
                    union all
                    select '5' bold, '1189' kode, 'Jumlah Aset Lancar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('11')
                    union all
                    select '0' bold, '11899' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '12' kode, 'INVESTASI JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '121' kode, 'Investasi Non-Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('121')
                    union all
                    select '4' bold, '122' kode, 'Investasi Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('122')
                    union all
                    select '5' bold, '1229' kode, 'Jumlah Investasi Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('12')
                    union all
                    select '0' bold, '12299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '13' kode, 'ASET TETAP' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '131' kode, 'Tanah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('131')
                    union all
                    select '4' bold, '132' kode, 'Peralatan dan Mesin' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('132')
                    union all
                    select '4' bold, '133' kode, 'Gedung dan Bangunan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('133')
                    union all
                    select '4' bold, '134' kode, 'Jalan, Irigasi dan Jaringan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('134')
                    union all
                    select '4' bold, '135' kode, 'Aset Tetap Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('135')
                    union all
                    select '4' bold, '136' kode, 'Konstruksi dalam Pengerjaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('136')
                    union all
                    select '5' bold, '1369' kode, 'Jumlah Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('131','132','133','134','135','136')
                    union all
                    select '4' bold, '137' kode, 'Akumulasi Penyusutan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('137')
                    union all
                    select '5' bold, '1379' kode, 'Jumlah Nilai Buku Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('13')
                    union all
                    select '0' bold, '13799' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '14' kode, 'ASET LAINNYA' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '141' kode, 'Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('141')
                    union all
                    select '4' bold, '142' kode, 'Amortisasi Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('145')
                    union all
                    select '4' bold, '143' kode, 'Aset Kemitraan dengan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('142')
                    union all
                    select '4' bold, '144' kode, 'Aset Tetap Non-Produktif' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('143')
                    union all
                    select '4' bold, '145' kode, 'Aset Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('144')
                    union all
                    select '5' bold, '1459' kode, 'Jumlah Aset Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('14')
                    union all
                    select '5' bold, '14599' kode, 'JUMLAH ASET' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,1) in ('1')
                    union all
                    select '0' bold, '145999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '2' kode, 'KEWAJIBAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '21' kode, 'KEWAJIBAN JANGKA PENDEK' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '211' kode, 'Utang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('211')
                    union all
                    select '4' bold, '212' kode, 'Utang Pajak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('212')
                    union all
                    select '4' bold, '213' kode, 'Pendapatan Diterima di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('213')
                    union all
                    select '4' bold, '214' kode, 'Uang Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('214')
                    union all
                    select '4' bold, '215' kode, 'Biaya yang Masih Harus Dibayar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('215')
                    union all
                    select '4' bold, '216' kode, 'Titipan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('216')
                    union all
                    select '4' bold, '217' kode, 'Bagian Lancar Utang Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('217')
                    union all
                    select '4' bold, '218' kode, 'Utang Bunga Pinjaman' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '4' bold, '219' kode, 'Kewajiban Jangka Pendek Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '5' bold, '2199' kode, 'Jumlah Kewajiban Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('21')
                    union all
                    select '0' bold, '21999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '22' kode, 'KEWAJIBAN JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '221' kode, 'Utang Dalam Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('221')
                    union all
                    select '4' bold, '222' kode, 'Utang Luar Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('222')
                    union all
                    select '4' bold, '223' kode, 'Pendapatan yang Ditangguhkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('223')
                    union all
                    select '5' bold, '2239' kode, 'Jumlah Kewajiban Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('22')
                    union all
                    select '0' bold, '22399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '3' kode, 'EKUITAS' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '31' kode, 'EKUITAS TIDAK TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '311' kode, 'Ekuitas Awal' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('311')
                    union all
                    select '4' bold, '312' kode, 'Akumulasi Surplus/Defisit s.d. Tahun Lalu' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('312')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    union all   
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek,
                    0 nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and LEFT(a.kd_rek5,3) in ('313')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '4' bold, '314' kode, 'Ekuitas Donasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('314')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('31')
                    union all
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '0' bold, '31499' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '32' kode, 'EKUITAS TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '321' kode, 'Ekuitas Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('321')
                    union all
                    select '4' bold, '322' kode, 'Ekuitas Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,3) in ('322')
                    union all
                    select '5' bold, '3229' kode, 'Jumlah Ekuitas Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,2) in ('32')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,1) in ('3')
                    union all
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7)  and LEFT(a.kd_rek5,1) in ('2','3')
                    union all
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    order by kode";
                        
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    $nilai      = number_format($nil,"2",",",".");
                    $nilai_lalu = number_format($nil_lalu,"2",",",".");
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA_APBD_BLUD KONSOL / $cbulan");
        $this->template->set('title', 'NERACA_APBD_BLUD KONSOL / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA_APBD_BLUD KONSOL / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    

    function lap_neraca($cbulan="", $kdskpd="", $pilih=1){// created by henri_tb *koreksi galih
        $cetak      ='2';//$ctk;
        //$id       = $this->session->userdata('kdskpd');
        $id         = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
            
                    if($cbulan<10){
                     $xbulan="0$cbulan";
                     }
                    else{
                    $xbulan=$cbulan;
                    }
    
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
        
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        

            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('4') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id'";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('4') and b.kd_skpd='$id'";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('5') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id'";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('5') and b.kd_skpd='$id'";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"5\" align=\"center\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>NERACA APBD DAN BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>PER $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";


        $sqlmaplo="select '1' bold, '1' kode, 'ASET' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '11' kode, 'ASET LANCAR' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '111' kode, 'Kas dan Setara Kas' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('111')
                    union all
                    select '4' bold, '112' kode, 'Investasi Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('112')
                    union all
                    select '4' bold, '113' kode, 'Piutang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('113')
                    union all
                    select '4' bold, '114' kode, 'Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('118')
                    union all
                    select '4' bold, '115' kode, 'Piutang Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('114')
                    union all
                    select '4' bold, '116' kode, 'Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('115')
                    union all
                    select '4' bold, '117' kode, 'Uang Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('116')
                    union all
                    select '4' bold, '118' kode, 'Biaya Dibayar di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('117')
                    union all
                    select '5' bold, '1189' kode, 'Jumlah Aset Lancar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('11')
                    union all
                    select '0' bold, '11899' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '12' kode, 'INVESTASI JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '121' kode, 'Investasi Non-Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('121')
                    union all
                    select '4' bold, '122' kode, 'Investasi Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('122')
                    union all
                    select '5' bold, '1229' kode, 'Jumlah Investasi Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('12')
                    union all
                    select '0' bold, '12299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '13' kode, 'ASET TETAP' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '131' kode, 'Tanah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('131')
                    union all
                    select '4' bold, '132' kode, 'Peralatan dan Mesin' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('132')
                    union all
                    select '4' bold, '133' kode, 'Gedung dan Bangunan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('133')
                    union all
                    select '4' bold, '134' kode, 'Jalan, Irigasi dan Jaringan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('134')
                    union all
                    select '4' bold, '135' kode, 'Aset Tetap Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('135')
                    union all
                    select '4' bold, '136' kode, 'Konstruksi dalam Pengerjaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('136')
                    union all
                    select '5' bold, '1369' kode, 'Jumlah Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('131','132','133','134','135','136')
                    union all
                    select '4' bold, '137' kode, 'Akumulasi Penyusutan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('137')
                    union all
                    select '5' bold, '1379' kode, 'Jumlah Nilai Buku Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('13')
                    union all
                    select '0' bold, '13799' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '14' kode, 'ASET LAINNYA' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '141' kode, 'Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('141')
                    union all
                    select '4' bold, '142' kode, 'Amortisasi Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('145')
                    union all
                    select '4' bold, '143' kode, 'Aset Kemitraan dengan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('142')
                    union all
                    select '4' bold, '144' kode, 'Aset Tetap Non-Produktif' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('143')
                    union all
                    select '4' bold, '145' kode, 'Aset Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('144')
                    union all
                    select '5' bold, '1459' kode, 'Jumlah Aset Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('14')
                    union all
                    select '5' bold, '14599' kode, 'JUMLAH ASET' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,1) in ('1')
                    union all
                    select '0' bold, '145999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '2' kode, 'KEWAJIBAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '21' kode, 'KEWAJIBAN JANGKA PENDEK' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '211' kode, 'Utang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('211')
                    union all
                    select '4' bold, '212' kode, 'Utang Pajak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('212')
                    union all
                    select '4' bold, '213' kode, 'Pendapatan Diterima di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('213')
                    union all
                    select '4' bold, '214' kode, 'Uang Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('214')
                    union all
                    select '4' bold, '215' kode, 'Biaya yang Masih Harus Dibayar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('215')
                    union all
                    select '4' bold, '216' kode, 'Titipan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('216')
                    union all
                    select '4' bold, '217' kode, 'Bagian Lancar Utang Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('217')
                    union all
                    select '4' bold, '218' kode, 'Utang Bunga Pinjaman' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '4' bold, '219' kode, 'Kewajiban Jangka Pendek Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '5' bold, '2199' kode, 'Jumlah Kewajiban Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('21')
                    union all
                    select '0' bold, '21999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '22' kode, 'KEWAJIBAN JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '221' kode, 'Utang Dalam Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('221')
                    union all
                    select '4' bold, '222' kode, 'Utang Luar Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('222')
                    union all
                    select '4' bold, '223' kode, 'Pendapatan yang Ditangguhkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('223')
                    union all
                    select '5' bold, '2239' kode, 'Jumlah Kewajiban Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('22')
                    union all
                    select '0' bold, '22399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '3' kode, 'EKUITAS' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '31' kode, 'EKUITAS TIDAK TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '311' kode, 'Ekuitas Awal' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('311')
                    union all
                    select '4' bold, '312' kode, 'Akumulasi Surplus/Defisit s.d. Tahun Lalu' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('312')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    union all   
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek,
                    0 nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and LEFT(a.kd_rek5,3) in ('313')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '4' bold, '314' kode, 'Ekuitas Donasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('314')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('31')
                    union all
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '0' bold, '31499' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '32' kode, 'EKUITAS TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '321' kode, 'Ekuitas Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('321')
                    union all
                    select '4' bold, '322' kode, 'Ekuitas Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,3) in ('322')
                    union all
                    select '5' bold, '3229' kode, 'Jumlah Ekuitas Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,2) in ('32')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,1) in ('3')
                    union all
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','52','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'  and LEFT(a.kd_rek5,1) in ('2','3')
                    union all
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    $nilai      = number_format($nil,"2",",",".");
                    $nilai_lalu = number_format($nil_lalu,"2",",",".");
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id'";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and b.kd_skpd='$id'";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioix= $rowttd->nm;
                    $jabatanx = $rowttd->jab;
                }   
        $oioi = strtoupper($oioix);
        $jabatan = strtoupper($jabatanx);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA_APBD_BLUD $id / $cbulan");
        $this->template->set('title', 'NERACA_APBD_BLUD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA_APBD_BLUD $id / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }

    function lap_lak($cbulan="", $kdskpd="", $pilih=""){
        $cetak='2';//$ctk;
        //$id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$kdskpd'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN ARUS KAS BLUD DAN APBD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
        
                $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, SUM(blud_apbd) nil_lalu, reev2 reev FROM map_lak_blud WHERE kode='$kdskpd' 
                            GROUP BY nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, reev2 ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
               
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $tambah     = $loquery->tambah;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                    $nil_lalu   = $loquery->nil_lalu;
                    $reev       = $loquery->reev;                       
                                        
                        
                $quelo01   = "SELECT SUM($cetak) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,$kode_1) in ($kode_2)
                and year(tgl_voucher)$kode_3 $thn_ang and month(tgl_voucher)<=$cbulan and kd_skpd='$kdskpd' and tabel<>'5' and reev IN ($reev) $tambah
                ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil1     = $quelo03->nilai;    
                    
                    $nil = $nil1;

                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$kdskpd' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK_BLUD_APBD $kdskpd / $cbulan");
        $this->template->set('title', 'LAK_BLUD_APBD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK_BLUD_APBD $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    
    function lap_lak_konsol($cbulan="", $pilih=""){
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN ARUS KAS BLUD DAN APBD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
        
                $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, SUM(blud_apbd) nil_lalu, reev2 reev FROM map_lak_blud WHERE LEFT(kode,7)=LEFT('$id',7) 
                            GROUP BY nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, reev2 ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $tambah     = $loquery->tambah;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                    $nil_lalu   = $loquery->nil_lalu;
                    $reev       = $loquery->reev;                   
                                        
                        
                $quelo01   = "SELECT SUM($cetak) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,$kode_1) in ($kode_2) and year(tgl_voucher)$kode_3 $thn_ang and month(tgl_voucher)<=$cbulan and LEFT(kd_skpd,7)=LEFT('$id',7) and tabel<>'5' and reev IN ($reev) $tambah";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai; 
                    
                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK_BLUD_APBD_Konsol $id / $cbulan");
        $this->template->set('title', 'LAK_BLUD_APBD_Konsol $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK_BLUD_APBD_Konsol $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    

    
    function lap_lak_blud($cbulan="", $kdskpd="", $pilih=""){
        $cetak='2';//$ctk;
        //$id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$kdskpd'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN ARUS KAS BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
            
        
                $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, SUM(blud) nil_lalu FROM map_lak_blud WHERE kode='$kdskpd' 
                            GROUP BY nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3 ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $tambah     = $loquery->tambah;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                    $nil_lalu   = $loquery->nil_lalu;           
                
                    
                $quelo01   = "SELECT SUM($cetak) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                WHERE left(kd_rek5,$kode_1) in ($kode_2) and year(tgl_voucher)$kode_3 $thn_ang and month(tgl_voucher)<=$cbulan and kd_skpd='$kdskpd' and tabel<>'5'  and reev IN ('2')  $tambah";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai; 
            
                    
                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$kdskpd' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK_BLUD $kdskpd / $cbulan");
        $this->template->set('title', 'LAK_BLUD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK_BLUD $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    
    function lap_lak_blud_konsol($cbulan="", $pilih=""){
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN ARUS KAS BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
        
                $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, SUM(blud) nil_lalu, reev1 reev FROM map_lak_blud WHERE LEFT(kode,7)=LEFT('$id',7) 
                            GROUP BY nor, uraian, cetak, seq, bold, tambah, kode_1, kode_2, kode_3, reev1 ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $tambah     = $loquery->tambah;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                    $nil_lalu   = $loquery->nil_lalu;
                    $reev       = $loquery->reev;                   
                                        
                        
                $quelo01   = "SELECT SUM($cetak) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,$kode_1) in ($kode_2) and year(tgl_voucher)$kode_3 $thn_ang and month(tgl_voucher)<=$cbulan and LEFT(kd_skpd,7)=LEFT('$id',7) and tabel<>'5' and reev IN ($reev) $tambah";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai; 
                    
                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK_BLUD_Konsol $id / $cbulan");
        $this->template->set('title', 'LAK_BLUD_Konsol $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK_BLUD_Konsol $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    

    
    function ctk_jurum($dcetak='',$dcetak2='',$skpd=''){
            $csql11 = " select nm_skpd from ms_skpd_blud where kd_skpd = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            $tgl=$this->tukd_model->tanggal_format_indonesia($dcetak);
            $tgl2=$this->tukd_model->tanggal_format_indonesia($dcetak2);
            $tgl=strtoupper($tgl);
            $tgl2=strtoupper($tgl2);
            
        $cRet ="";  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK
                </td>
            </tr>            
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>$lcskpd
                </td>
            </tr>
             <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>JURNAL UMUM APBD DAN BLUD
                </td>
            </tr>
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;border-bottom:solid 1px white;\"><b>PERIODE $tgl SAMPAI DENGAN $tgl2
                </td>
            </tr>
            </table>";
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"90%\" align=\"center\" border=\"2\" cellspacing=\"0\" cellpadding=\"4\">
            <thead>
            <tr>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"rowspan=\"2\"><b>Nomor<br>Bukti</td>
                <td colspan=\"5\"bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\"><b>Kode<br>Rekening</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Uraian</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>ref</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" colspan=\"2\"><b>Jumlah Rp</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>Debit</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\"><b>Kredit</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"15%\";border-bottom:solid 1px red;\"><b>1</td>
                <td align=\"center\" width=\"10%\";border-bottom:solid 1px blue;\"><b>2</td>
                <td colspan=\"5\" align=\"center\" width=\"15%\"><b>3</td>
                <td align=\"center\" width=\"42%\"><b>4</td>
                <td align=\"center\" width=\"3%\"></td>
                <td align=\"center\" width=\"10%\"><b>5</td>
                <td align=\"center\" width=\"10%\"><b>6</td>
            </tr>
            </thead>
           ";
         
         $csql1 = "select count(*) as tot FROM 
                 trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher= b.no_voucher and a.kd_unit=b.kd_skpd 
                 where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd'"; 
         $rs = $this->db->query($csql1);
         $trh = $rs->row();
         
            
/*         $csql = "SELECT b.tgl_voucher,a.no_voucher,a.kd_rek5,(c.nm_rek64 + case when (pos='0') then '' else ''end) AS nm_rek5,a.debet,a.kredit FROM 
                  trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher= b.no_voucher join (SELECT kd_rek64,nm_Rek64 from ms_rek5 group by kd_rek64,nm_Rek64) c on a.kd_rek5=c.kd_rek64
                  where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                  ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5";   
*/
        
        /* 25/10/2016
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, nm_rek5,a.debet,a.kredit,a.rk from trdju_blud a join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                  ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5";*/
        
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, nm_rek5,a.debet,a.kredit,a.rk, left(a.kd_rek5,1) akun from trdju_blud a join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                 ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5
                  ";
        
         $query = $this->db->query($csql);  
         $cnovoc = '';
         $lcno = 0;
         foreach($query->result_array() as $res){
                $lcno = $lcno + 1;
                if ($lcno==$trh->tot){
                    $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>"; 
                }else{
                        if($cnovoc==$res['no_voucher']){
                            $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";                    
                        }else{
                        $cRet .="<tr>
                                <td align=\"center\" style=\"border-bottom:none\">".$this->tukd_model->tanggal_ind($res['tgl_voucher'])."</td>
                                <td style=\"border-bottom:none\">".$res['no_voucher']."</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";
                        }
                        $cnovoc=$res['no_voucher'];
                }
                
            }
            
         $cRet .=" <tr>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                    </tr>  
         </table>
         ";

            $data['prev']=$cRet; //'JURNAL UMUM';
        echo $cRet;

            //$this->tukd_model->_mpdf('',$cRet,5,5,10,'0');    
    
    } 
  
    
    function ctk_jurum_blud_apbd_psap($dcetak='',$dcetak2='',$skpd='',$oke){

            $csql11 = " select nm_skpd from ms_skpd_blud where kd_skpd = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            $tgl=$this->tukd_model->tanggal_format_indonesia($dcetak);
            $tgl2=$this->tukd_model->tanggal_format_indonesia($dcetak2);
            $tgl=strtoupper($tgl);
            $tgl2=strtoupper($tgl2);
            
        $cRet ="";  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK
                </td>
            </tr>            
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>$lcskpd
                </td>
            </tr>
             <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>JURNAL UMUM APBD DAN BLUD
                </td>
            </tr>
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;border-bottom:solid 1px white;\"><b>PERIODE $tgl SAMPAI DENGAN $tgl2
                </td>
            </tr>
            </table>";
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"90%\" align=\"center\" border=\"2\" cellspacing=\"0\" cellpadding=\"4\">
            <thead>
            <tr>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"rowspan=\"2\"><b>Nomor<br>Bukti</td>
                <td colspan=\"5\"bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\"><b>Kode<br>Rekening</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Uraian</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>ref</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" colspan=\"2\"><b>Jumlah Rp</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>Debit</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\"><b>Kredit</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"15%\";border-bottom:solid 1px red;\"><b>1</td>
                <td align=\"center\" width=\"10%\";border-bottom:solid 1px blue;\"><b>2</td>
                <td colspan=\"5\" align=\"center\" width=\"15%\"><b>3</td>
                <td align=\"center\" width=\"42%\"><b>4</td>
                <td align=\"center\" width=\"3%\"></td>
                <td align=\"center\" width=\"10%\"><b>5</td>
                <td align=\"center\" width=\"10%\"><b>6</td>
            </tr>
            </thead>
           ";
         
         $csql1 = "select count(*) as tot FROM 
                 trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher= b.no_voucher and a.kd_unit=b.kd_skpd 
                 where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd'"; 
         $rs = $this->db->query($csql1);
         $trh = $rs->row();
         
         
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, nm_rek5,a.debet,a.kredit,a.rk, left(a.kd_rek5,1) akun from trdju_sap_blud a join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                 ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5
                  ";
        
         $query = $this->db->query($csql);  
         $cnovoc = '';
         $lcno = 0;
         foreach($query->result_array() as $res){
                $lcno = $lcno + 1;
                if ($lcno==$trh->tot){
                    $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>"; 
                }else{
                        if($cnovoc==$res['no_voucher']){
                            $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";                    
                        }else{
                        $cRet .="<tr>
                                <td align=\"center\" style=\"border-bottom:none\">".$this->tukd_model->tanggal_ind($res['tgl_voucher'])."</td>
                                <td style=\"border-bottom:none\">".$res['no_voucher']."</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";
                        }
                        $cnovoc=$res['no_voucher'];
                }
                
            }
            
         $cRet .=" <tr>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                    </tr>  
         </table>
         ";

            $data['prev']=$cRet; //'JURNAL UMUM';
            echo $cRet;
            echo "$oke";
            if($oke=0){
                echo $cRet;
            } else if($oke=1){
                $this->tukd_model->_mpdf('',$cRet,5,5,10,'0');    
            } else if($oke=2){
                  header("Content-Type: application/vnd.ms-excel");
                  header("Content-Disposition: attachment; filename= Jurnal BLUD - $skpd.xls");
                  echo $cRet;
            }
            //okeyahya
            //$this->tukd_model->_mpdf('',$cRet,5,5,10,'0');    
    
    } 
 
    
    function ctk_jurum_blud_psap($dcetak='',$dcetak2='',$skpd=''){
            $csql11 = " select nm_skpd from ms_skpd_blud where kd_skpd = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            $tgl=$this->tukd_model->tanggal_format_indonesia($dcetak);
            $tgl2=$this->tukd_model->tanggal_format_indonesia($dcetak2);
            $tgl=strtoupper($tgl);
            $tgl2=strtoupper($tgl2);
            
        $cRet ="";  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK
                </td>
            </tr>            
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>$lcskpd
                </td>
            </tr>
             <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>JURNAL UMUM BLUD
                </td>
            </tr>
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;border-bottom:solid 1px white;\"><b>PERIODE $tgl SAMPAI DENGAN $tgl2
                </td>
            </tr>
            </table>";
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"90%\" align=\"center\" border=\"2\" cellspacing=\"0\" cellpadding=\"4\">
            <thead>
            <tr>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"rowspan=\"2\"><b>Nomor<br>Bukti</td>
                <td colspan=\"5\"bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\"><b>Kode<br>Rekening</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Uraian</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>ref</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" colspan=\"2\"><b>Jumlah Rp</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>Debit</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\"><b>Kredit</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"15%\";border-bottom:solid 1px red;\"><b>1</td>
                <td align=\"center\" width=\"10%\";border-bottom:solid 1px blue;\"><b>2</td>
                <td colspan=\"5\" align=\"center\" width=\"15%\"><b>3</td>
                <td align=\"center\" width=\"42%\"><b>4</td>
                <td align=\"center\" width=\"3%\"></td>
                <td align=\"center\" width=\"10%\"><b>5</td>
                <td align=\"center\" width=\"10%\"><b>6</td>
            </tr>
            </thead>
           ";
         
         $csql1 = "select count(*) as tot FROM 
                 trdju_sap_blud a LEFT JOIN trhju_sap_blud b ON a.no_voucher= b.no_voucher and a.kd_unit=b.kd_skpd 
                 where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' and a.kd_subkegiatan='95'"; 
         $rs = $this->db->query($csql1);
         $trh = $rs->row();
         
         
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, nm_rek5,a.debet,a.kredit,a.rk, left(a.kd_rek5,1) akun from trdju_sap_blud a join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd'  and a.kd_subkegiatan='95'
                 ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5
                  ";
        
         $query = $this->db->query($csql);  
         $cnovoc = '';
         $lcno = 0;
         foreach($query->result_array() as $res){
                $lcno = $lcno + 1;
                if ($lcno==$trh->tot){
                    $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>"; 
                }else{
                        if($cnovoc==$res['no_voucher']){
                            $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";                    
                        }else{
                        $cRet .="<tr>
                                <td align=\"center\" style=\"border-bottom:none\">".$this->tukd_model->tanggal_ind($res['tgl_voucher'])."</td>
                                <td style=\"border-bottom:none\">".$res['no_voucher']."</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";
                        }
                        $cnovoc=$res['no_voucher'];
                }
                
            }
            
         $cRet .=" <tr>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                    </tr>  
         </table>
         ";

            $data['prev']=$cRet; //'JURNAL UMUM';
            echo $cRet;
            //$this->tukd_model->_mpdf('',$cRet,5,5,10,'0');    
    
    } 
 
 
 
    function lap_lo_blud_konsol($cbulan="", $pilih=1){// created by henri_tb
        $cetak='2';//$ctk;
        $id         = $this->session->userdata('kdskpd');
        //$id           = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
       
       $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
            
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN OPERASIONAL BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="select '1' bold, '4' kode, 'PENDAPATAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '41' kode, 'PENDAPATAN JASA LAYANAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '411' kode, 'Jasa Layanan Kesehatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411') and reev IN ('0','2')
                    union all
                    select '4' bold, '412' kode, 'Penyesuaian Pendapatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('412') and reev IN ('0','2')
                    union all
                    select '5' bold, '4129' kode, 'Jumlah Pendapatan Jasa Layanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411', '412') and reev IN ('0','2')
                    union all
                    select '0' bold, '41299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '42' kode, 'PENDAPATAN HIBAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '421' kode, 'Hibah Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421') and reev IN ('0','2')
                    union all
                    select '4' bold, '422' kode, 'Hibah Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('422') and reev IN ('0','2')
                    union all
                    select '4' bold, '423' kode, 'Hibah Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('423') and reev IN ('0','2')
                    union all
                    select '5' bold, '4239' kode, 'Jumlah Pendapatan Hibah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421','422','423') and reev IN ('0','2')
                    union all
                    select '0' bold, '42399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '43' kode, 'HASIL KERJASAMA DENGAN PIHAK LAIN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '431' kode, 'Hasil Kerjasama Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431') and reev IN ('0','2')
                    union all
                    select '4' bold, '432' kode, 'Pendapatan Sewa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('432') and reev IN ('0','2')
                    union all
                    select '4' bold, '433' kode, 'Pendapatan Kerjasama Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('433') and reev IN ('0','2')
                    union all
                    select '5' bold, '4339' kode, 'Jumlah Pendapatan Hasil Kerjasama' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431','432','433') and reev IN ('0','2')
                    union all
                    select '0' bold, '43399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '44' kode, 'PENDAPATAN APBD' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '441' kode, 'APBD Kota Pontianak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441') and reev IN ('0','2')
                    union all
                    select '4' bold, '442' kode, 'APBD Provinsi Kalimantan Barat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('442') and reev IN ('0','2')
                    union all
                    select '4' bold, '443' kode, 'APBD Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('443') and reev IN ('0','2')
                    union all
                    select '5' bold, '4439' kode, 'Jumlah Pendapatan APBD' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441','442','443') and reev IN ('0','2')
                    union all
                    select '0' bold, '44399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '45' kode, 'PENDAPATAN APBN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '451' kode, 'APBN - Dana Dekonsentrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451') and reev IN ('0','2')
                    union all
                    select '4' bold, '452' kode, 'APBN - Tugas Pembantuan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('452') and reev IN ('0','2')
                    union all
                    select '4' bold, '453' kode, 'APBN - Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('453') and reev IN ('0','2')
                    union all
                    select '5' bold, '4539' kode, 'Jumlah Pendapatan APBN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451','452','453') and reev IN ('0','2')
                    union all
                    select '0' bold, '45399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '453999' kode, 'LAIN-LAIN PENDAPATAN BLUD YANG SAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '461' kode, 'Hasil Penjualan Kekayaan yang Tidak Dipisahkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461') and reev IN ('0','2')
                    union all
                    select '4' bold, '462' kode, 'Hasil Pemanfaatan Kekayaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('462') and reev IN ('0','2')
                    union all
                    select '4' bold, '463' kode, 'Jasa Giro' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('463') and reev IN ('0','2')
                    union all
                    select '4' bold, '464' kode, 'Pendapatan Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('464') and reev IN ('0','2')
                    union all
                    select '4' bold, '465' kode, 'Keuntungan Selisih Nilai Tukar Rupiah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('465') and reev IN ('0','2')
                    union all
                    select '4' bold, '466' kode, 'Komisi dan Potongan Penjualan/Pengadaan Barang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('466') and reev IN ('0','2')
                    union all
                    select '4' bold, '467' kode, 'Hasil Investasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('467') and reev IN ('0','2')
                    union all
                    select '4' bold, '468' kode, 'Lain-lain Pendapatan BLUD yang Sah Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('468') and reev IN ('0','2')
                    union all
                    select '5' bold, '4689' kode, 'Jumlah Lain-lain Pendapatan yang Sah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461','462','463','464','465','466','467','468') and reev IN ('0','2')
                    union all
                    select '5' bold, '46899' kode, 'JUMLAH PENDAPATAN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4') and reev IN ('0','2')
                    union all
                    select '0' bold, '468999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '5' kode, 'BIAYA' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '51' kode, 'BIAYA OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '511' kode, 'BIAYA PELAYANAN' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5111' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5111') and reev IN ('0','2')
                    union all
                    select '4' bold, '5112' kode, 'Biaya Bahan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5112') and reev IN ('0','2')
                    union all
                    select '4' bold, '5113' kode, 'Biaya Jasa Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5113') and reev IN ('0','2')
                    union all
                    select '4' bold, '5114' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5114') and reev IN ('0','2')
                    union all
                    select '4' bold, '5115' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5115') and reev IN ('0','2')
                    union all
                    select '4' bold, '5116' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5116') and reev IN ('0','2')
                    union all
                    select '4' bold, '5117' kode, 'Biaya Pelayanan Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5117') and reev IN ('0','2')
                    union all
                    select '5' bold, '51179' kode, 'Jumlah Biaya Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('511') and reev IN ('0','2')
                    union all
                    select '0' bold, '51179' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '512' kode, 'BIAYA UMUM DAN ADMINISTRASI' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5121' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5121') and reev IN ('0','2')
                    union all
                    select '4' bold, '5122' kode, 'Biaya Administrasi Kantor' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5122') and reev IN ('0','2')
                    union all
                    select '4' bold, '5123' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5123') and reev IN ('0','2')
                    union all
                    select '4' bold, '5124' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5124') and reev IN ('0','2')
                    union all
                    select '4' bold, '5125' kode, 'Biaya Promosi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5125') and reev IN ('0','2')
                    union all
                    select '4' bold, '5126' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5126') and reev IN ('0','2')
                    union all
                    select '4' bold, '5127' kode, 'Biaya Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5127') and reev IN ('0','2')
                    union all
                    select '4' bold, '5128' kode, 'Biaya Umum dan Administrasi Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5128') and reev IN ('0','2')
                    union all
                    select '5' bold, '51289' kode, 'Jumlah Biaya Umum dan Administrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('512') and reev IN ('0','2')
                    union all
                    select '5' bold, '512899' kode, 'Jumlah Biaya Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,2) in ('51') and reev IN ('0','2')
                    union all
                    select '0' bold, '5199999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '530' kode, 'BIAYA NON-OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5301' kode, 'Biaya Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5301') and reev IN ('0','2')
                    union all
                    select '4' bold, '5302' kode, 'Biaya Administrasi Bank' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5302') and reev IN ('0','2')
                    union all
                    select '4' bold, '5303' kode, 'Biaya Kerugian Penjualan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5303') and reev IN ('0','2')
                    union all
                    select '4' bold, '5304' kode, 'Biaya Kerugian Penurunan Nilai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5304') and reev IN ('0','2')
                    union all
                    select '4' bold, '5305' kode, 'Biaya Non-Operasional Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5305') and reev IN ('0','2')
                    union all
                    select '5' bold, '53059' kode, 'Jumlah Biaya Non-Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,3) in ('530') and reev IN ('0','2')
                    union all
                    select '5' bold, '530599' kode, 'JUMLAH BIAYA' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('5') and reev IN ('0','2')
                    union all
                    select '0' bold, '5305999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '6' bold, '53059999' kode, 'JUMLAH SURPLUS/DEFISIT DARI OPERASI' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4','5') and reev IN ('0','2')
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    if ($nil < 0){
                        $lo1="("; $nilaix=$nil*-1; $lo01=")";}
                    else {
                        $lo1=""; $nilaix=$nil; $lo01="";}
                    $nilai = number_format($nilaix,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lo2="("; $nilai_lalux=$nil_lalu*-1; $lo02=")";}
                    else {
                        $lo2=""; $nilai_lalux=$nil_lalu; $lo02="";}
                    $nilai_lalu = number_format($nilai_lalux,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        
                    
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO BLUD Konsol / $cbulan");
        $this->template->set('title', 'LO BLUD Konsol / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO BLUD Konsol / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    
    
    function lap_lo_blud($cbulan="", $kdskpd="", $pilih=1){// created by henri_tb
        $cetak='2';//$ctk;
        //$id       = $this->session->userdata('kdskpd');
        $id         = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
                
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"5\" align=\"right\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>LAPORAN OPERASIONAL BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="select '1' bold, '4' kode, 'PENDAPATAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '41' kode, 'PENDAPATAN JASA LAYANAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '411' kode, 'Jasa Layanan Kesehatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411') and reev IN ('0','2')
                    union all
                    select '4' bold, '412' kode, 'Penyesuaian Pendapatan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('412') and reev IN ('0','2')
                    union all
                    select '5' bold, '4129' kode, 'Jumlah Pendapatan Jasa Layanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('411', '412') and reev IN ('0','2')
                    union all
                    select '0' bold, '41299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '42' kode, 'PENDAPATAN HIBAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '421' kode, 'Hibah Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421') and reev IN ('0','2')
                    union all
                    select '4' bold, '422' kode, 'Hibah Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('422') and reev IN ('0','2')
                    union all
                    select '4' bold, '423' kode, 'Hibah Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('423') and reev IN ('0','2')
                    union all
                    select '5' bold, '4239' kode, 'Jumlah Pendapatan Hibah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('421','422','423') and reev IN ('0','2')
                    union all
                    select '0' bold, '42399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '43' kode, 'HASIL KERJASAMA DENGAN PIHAK LAIN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '431' kode, 'Hasil Kerjasama Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431') and reev IN ('0','2')
                    union all
                    select '4' bold, '432' kode, 'Pendapatan Sewa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('432') and reev IN ('0','2')
                    union all
                    select '4' bold, '433' kode, 'Pendapatan Kerjasama Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('433') and reev IN ('0','2')
                    union all
                    select '5' bold, '4339' kode, 'Jumlah Pendapatan Hasil Kerjasama' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('431','432','433') and reev IN ('0','2')
                    union all
                    select '0' bold, '43399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '44' kode, 'PENDAPATAN APBD' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '441' kode, 'APBD Kota Pontianak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441') and reev IN ('0','2')
                    union all
                    select '4' bold, '442' kode, 'APBD Provinsi Kalimantan Barat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('442') and reev IN ('0','2')
                    union all
                    select '4' bold, '443' kode, 'APBD Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('443') and reev IN ('0','2')
                    union all
                    select '5' bold, '4439' kode, 'Jumlah Pendapatan APBD' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('441','442','443') and reev IN ('0','2')
                    union all
                    select '0' bold, '44399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '45' kode, 'PENDAPATAN APBN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '451' kode, 'APBN - Dana Dekonsentrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451') and reev IN ('0','2')
                    union all
                    select '4' bold, '452' kode, 'APBN - Tugas Pembantuan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('452') and reev IN ('0','2')
                    union all
                    select '4' bold, '453' kode, 'APBN - Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('453') and reev IN ('0','2')
                    union all
                    select '5' bold, '4539' kode, 'Jumlah Pendapatan APBN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('451','452','453') and reev IN ('0','2')
                    union all
                    select '0' bold, '45399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '453999' kode, 'LAIN-LAIN PENDAPATAN BLUD YANG SAH' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '461' kode, 'Hasil Penjualan Kekayaan yang Tidak Dipisahkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461') and reev IN ('0','2')
                    union all
                    select '4' bold, '462' kode, 'Hasil Pemanfaatan Kekayaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('462') and reev IN ('0','2')
                    union all
                    select '4' bold, '463' kode, 'Jasa Giro' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('463') and reev IN ('0','2')
                    union all
                    select '4' bold, '464' kode, 'Pendapatan Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('464') and reev IN ('0','2')
                    union all
                    select '4' bold, '465' kode, 'Keuntungan Selisih Nilai Tukar Rupiah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('465') and reev IN ('0','2')
                    union all
                    select '4' bold, '466' kode, 'Komisi dan Potongan Penjualan/Pengadaan Barang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('466') and reev IN ('0','2')
                    union all
                    select '4' bold, '467' kode, 'Hasil Investasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('467') and reev IN ('0','2')
                    union all
                    select '4' bold, '468' kode, 'Lain-lain Pendapatan BLUD yang Sah Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('468') and reev IN ('0','2')
                    union all
                    select '5' bold, '4689' kode, 'Jumlah Lain-lain Pendapatan yang Sah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('461','462','463','464','465','466','467','468') and reev IN ('0','2')
                    union all
                    select '5' bold, '46899' kode, 'JUMLAH PENDAPATAN' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4') and reev IN ('0','2')
                    union all
                    select '0' bold, '468999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '5' kode, 'BIAYA' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '51' kode, 'BIAYA OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '511' kode, 'BIAYA PELAYANAN' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5111' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5111') and reev IN ('0','2')
                    union all
                    select '4' bold, '5112' kode, 'Biaya Bahan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5112') and reev IN ('0','2')
                    union all
                    select '4' bold, '5113' kode, 'Biaya Jasa Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5113') and reev IN ('0','2')
                    union all
                    select '4' bold, '5114' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5114') and reev IN ('0','2')
                    union all
                    select '4' bold, '5115' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5115') and reev IN ('0','2')
                    union all
                    select '4' bold, '5116' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5116') and reev IN ('0','2')
                    union all
                    select '4' bold, '5117' kode, 'Biaya Pelayanan Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5117') and reev IN ('0','2')
                    union all
                    select '5' bold, '51179' kode, 'Jumlah Biaya Pelayanan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('511') and reev IN ('0','2')
                    union all
                    select '0' bold, '51179' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '512' kode, 'BIAYA UMUM DAN ADMINISTRASI' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5121' kode, 'Biaya Pegawai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5121') and reev IN ('0','2')
                    union all
                    select '4' bold, '5122' kode, 'Biaya Administrasi Kantor' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5122') and reev IN ('0','2')
                    union all
                    select '4' bold, '5123' kode, 'Biaya Pemeliharaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5123') and reev IN ('0','2')
                    union all
                    select '4' bold, '5124' kode, 'Biaya Barang dan Jasa' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5124') and reev IN ('0','2')
                    union all
                    select '4' bold, '5125' kode, 'Biaya Promosi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5125') and reev IN ('0','2')
                    union all
                    select '4' bold, '5126' kode, 'Biaya Penyusutan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5126') and reev IN ('0','2')
                    union all
                    select '4' bold, '5127' kode, 'Biaya Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5127') and reev IN ('0','2')
                    union all
                    select '4' bold, '5128' kode, 'Biaya Umum dan Administrasi Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5128') and reev IN ('0','2')
                    union all
                    select '5' bold, '51289' kode, 'Jumlah Biaya Umum dan Administrasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('512') and reev IN ('0','2')
                    union all
                    select '5' bold, '512899' kode, 'Jumlah Biaya Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,2) in ('51') and reev IN ('0','2')
                    union all
                    select '0' bold, '5199999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '530' kode, 'BIAYA NON-OPERASIONAL' nm_rek, 0 nilai, 0 nilai_l
                    union all 
                    select '4' bold, '5301' kode, 'Biaya Bunga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5301') and reev IN ('0','2')
                    union all
                    select '4' bold, '5302' kode, 'Biaya Administrasi Bank' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5302') and reev IN ('0','2')
                    union all
                    select '4' bold, '5303' kode, 'Biaya Kerugian Penjualan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5303') and reev IN ('0','2')
                    union all
                    select '4' bold, '5304' kode, 'Biaya Kerugian Penurunan Nilai' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5304') and reev IN ('0','2')
                    union all
                    select '4' bold, '5305' kode, 'Biaya Non-Operasional Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,4) in ('5305') and reev IN ('0','2')
                    union all
                    select '5' bold, '53059' kode, 'Jumlah Biaya Non-Operasional' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,3) in ('530') and reev IN ('0','2')
                    union all
                    select '5' bold, '530599' kode, 'JUMLAH BIAYA' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('5') and reev IN ('0','2')
                    union all
                    select '0' bold, '5305999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '6' bold, '53059999' kode, 'JUMLAH SURPLUS/DEFISIT DARI OPERASI' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and month(tgl_voucher)<='$cbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and LEFT(a.kd_rek5,1) in ('4','5') and reev IN ('0','2')
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    if ($nil < 0){
                        $lo1="("; $nilaix=$nil*-1; $lo01=")";}
                    else {
                        $lo1=""; $nilaix=$nil; $lo01="";}
                    $nilai = number_format($nilaix,"2",",",".");
                    
                    if ($nil_lalu < 0){
                        $lo2="("; $nilai_lalux=$nil_lalu*-1; $lo02=")";}
                    else {
                        $lo2=""; $nilai_lalux=$nil_lalu; $lo02="";}
                    $nilai_lalu = number_format($nilai_lalux,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai$lo01<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo2$nilai_lalu$lo02<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO BLUD $id / $cbulan");
        $this->template->set('title', 'LO BLUD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO BLUD $id / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }
    

    function cetak_sp3b(){
        $cRet="";
        $cRet="<table width=`100%` border=`1`><tr>sd</tr></table>";
        echo "$cRet";
    }
    
    function lap_neraca_blud_konsol($cbulan="", $pilih=1){// created by henri_tb *koreksi galih
        $cetak      ='2';//$ctk;
        $id         = $this->session->userdata('kdskpd');
        //$id           = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
        
            
                    if($cbulan<10){
                     $xbulan="0$cbulan";
                     }
                    else{
                    $xbulan=$cbulan;
                    }
    
        
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
        
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        

            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('4') and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$cbulan' and reev IN ('0','2') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('4') and reev IN ('0','2') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('5') and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$cbulan' and reev IN ('0','2') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('5') and reev IN ('0','2') and left(b.kd_skpd,7)=left('$id',7)";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"5\" align=\"center\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>NERACA BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>PER $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="select '1' bold, '1' kode, 'ASET' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '11' kode, 'ASET LANCAR' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '111' kode, 'Kas dan Setara Kas' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('111')
                    union all
                    select '4' bold, '112' kode, 'Investasi Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('112')
                    union all
                    select '4' bold, '113' kode, 'Piutang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('113')
                    union all
                    select '4' bold, '114' kode, 'Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('118')
                    union all
                    select '4' bold, '115' kode, 'Piutang Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('114')
                    union all
                    select '4' bold, '116' kode, 'Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('115')
                    union all
                    select '4' bold, '117' kode, 'Uang Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('116')
                    union all
                    select '4' bold, '118' kode, 'Biaya Dibayar di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('117')
                    union all
                    select '5' bold, '1189' kode, 'Jumlah Aset Lancar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('11')
                    union all
                    select '0' bold, '11899' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '12' kode, 'INVESTASI JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '121' kode, 'Investasi Non-Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('121')
                    union all
                    select '4' bold, '122' kode, 'Investasi Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('122')
                    union all
                    select '5' bold, '1229' kode, 'Jumlah Investasi Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('12')
                    union all
                    select '0' bold, '12299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '13' kode, 'ASET TETAP' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '131' kode, 'Tanah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('131')
                    union all
                    select '4' bold, '132' kode, 'Peralatan dan Mesin' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('132')
                    union all
                    select '4' bold, '133' kode, 'Gedung dan Bangunan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('133')
                    union all
                    select '4' bold, '134' kode, 'Jalan, Irigasi dan Jaringan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('134')
                    union all
                    select '4' bold, '135' kode, 'Aset Tetap Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('135')
                    union all
                    select '4' bold, '136' kode, 'Konstruksi dalam Pengerjaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('136')
                    union all
                    select '5' bold, '1369' kode, 'Jumlah Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('131','132','133','134','135','136')
                    union all
                    select '4' bold, '137' kode, 'Akumulasi Penyusutan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('137')
                    union all
                    select '5' bold, '1379' kode, 'Jumlah Nilai Buku Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('13')
                    union all
                    select '0' bold, '13799' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '14' kode, 'ASET LAINNYA' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '141' kode, 'Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('141')
                    union all
                    select '4' bold, '142' kode, 'Amortisasi Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('145')
                    union all
                    select '4' bold, '143' kode, 'Aset Kemitraan dengan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('142')
                    union all
                    select '4' bold, '144' kode, 'Aset Tetap Non-Produktif' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('143')
                    union all
                    select '4' bold, '145' kode, 'Aset Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('144')
                    union all
                    select '5' bold, '1459' kode, 'Jumlah Aset Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('14')
                    union all
                    select '5' bold, '14599' kode, 'JUMLAH ASET' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('1')
                    union all
                    select '0' bold, '145999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '2' kode, 'KEWAJIBAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '21' kode, 'KEWAJIBAN JANGKA PENDEK' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '211' kode, 'Utang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('211')
                    union all
                    select '4' bold, '212' kode, 'Utang Pajak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('212')
                    union all
                    select '4' bold, '213' kode, 'Pendapatan Diterima di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('213')
                    union all
                    select '4' bold, '214' kode, 'Uang Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('214')
                    union all
                    select '4' bold, '215' kode, 'Biaya yang Masih Harus Dibayar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('215')
                    union all
                    select '4' bold, '216' kode, 'Titipan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('216')
                    union all
                    select '4' bold, '217' kode, 'Bagian Lancar Utang Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('217')
                    union all
                    select '4' bold, '218' kode, 'Utang Bunga Pinjaman' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '4' bold, '219' kode, 'Kewajiban Jangka Pendek Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '5' bold, '2199' kode, 'Jumlah Kewajiban Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('21')
                    union all
                    select '0' bold, '21999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '22' kode, 'KEWAJIBAN JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '221' kode, 'Utang Dalam Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('221')
                    union all
                    select '4' bold, '222' kode, 'Utang Luar Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('222')
                    union all
                    select '4' bold, '223' kode, 'Pendapatan yang Ditangguhkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('223')
                    union all
                    select '5' bold, '2239' kode, 'Jumlah Kewajiban Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('22')
                    union all
                    select '0' bold, '22399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '3' kode, 'EKUITAS' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '31' kode, 'EKUITAS TIDAK TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '311' kode, 'Ekuitas Awal' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('311')
                    union all
                    select '4' bold, '312' kode, 'Akumulasi Surplus/Defisit s.d. Tahun Lalu' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('312')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    union all   
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek,
                    0 nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and LEFT(a.kd_rek5,3) in ('313')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '4' bold, '314' kode, 'Ekuitas Donasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('314')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('31')
                    union all
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '0' bold, '31499' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '32' kode, 'EKUITAS TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '321' kode, 'Ekuitas Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('321')
                    union all
                    select '4' bold, '322' kode, 'Ekuitas Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('322')
                    union all
                    select '5' bold, '3229' kode, 'Jumlah Ekuitas Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('32')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('3')
                    union all
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('2','3')
                    union all
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(a.kd_unit,7)=left('$id',7) and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    order by kode";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    $nilai      = number_format($nil,"2",",",".");
                    $nilai_lalu = number_format($nil_lalu,"2",",",".");
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and reev='0' and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and reev='0' and left(b.kd_skpd,7)=left('$id',7)";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA_BLUD KONSOL / $cbulan");
        $this->template->set('title', 'NERACA_BLUD KONSOL / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA_BLUD KONSOL / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }

    function lap_neraca_blud($cbulan="", $kdskpd="", $pilih=1){// created by henri_tb *koreksi galih
        $cetak      ='2';//$ctk;
        //$id       = $this->session->userdata('kdskpd');
        $id         = $kdskpd;
        $thn_ang    = $this->session->userdata('pcThang');
        $thn_ang_1  = $thn_ang-1;  
    
    
                    if($cbulan<10){
                     $xbulan="0$cbulan";
                     }
                    else{
                    $xbulan=$cbulan;
                    }
    
    
        $sqldata="SELECT provinsi, kab_kota, daerah FROM sclient_blud WHERE kd_skpd='$id'";
                 $sqlpemda=$this->db->query($sqldata);
                 foreach ($sqlpemda->result() as $row)
                {
                    $provinsi=$row->provinsi;                    
                    $kab_kota= $row->kab_kota;
                    $daerah  = $row->daerah;
                }
        
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nmskpd  = $rowdns->nm_sk;
                } 
        
        $nm_skpd = strtoupper($nmskpd); 
        

            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('4') and month(b.tgl_voucher)<=$cbulan and reev IN ('0','2') and b.kd_skpd='$id'";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('4') and reev IN ('0','2') and b.kd_skpd='$id'";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('5') and month(b.tgl_voucher)<=$cbulan and reev IN ('0','2') and b.kd_skpd='$id'";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('5') and reev IN ('0','2') and b.kd_skpd='$id'";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"5\" align=\"center\" style=\"border-right:hidden\">
                        <img src=\"".base_url()."/image/logo.png\"  width=\"85\" height=\"85\" />
                        </td>
                         <td align=\"center\"><strong>$kab_kota</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM DAERAH (BLUD)</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><h1><strong>NERACA BLUD</strong></h1></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>PER $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="select '1' bold, '1' kode, 'ASET' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '11' kode, 'ASET LANCAR' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '111' kode, 'Kas dan Setara Kas' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('111')
                    union all
                    select '4' bold, '112' kode, 'Investasi Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('112')
                    union all
                    select '4' bold, '113' kode, 'Piutang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('113')
                    union all
                    select '4' bold, '114' kode, 'Penyisihan Piutang Tak Tertagih' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('118')
                    union all
                    select '4' bold, '115' kode, 'Piutang Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('114')
                    union all
                    select '4' bold, '116' kode, 'Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('115')
                    union all
                    select '4' bold, '117' kode, 'Uang Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('116')
                    union all
                    select '4' bold, '118' kode, 'Biaya Dibayar di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('117')
                    union all
                    select '5' bold, '1189' kode, 'Jumlah Aset Lancar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('11')
                    union all
                    select '0' bold, '11899' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '12' kode, 'INVESTASI JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '121' kode, 'Investasi Non-Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('121')
                    union all
                    select '4' bold, '122' kode, 'Investasi Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('122')
                    union all
                    select '5' bold, '1229' kode, 'Jumlah Investasi Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('12')
                    union all
                    select '0' bold, '12299' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '13' kode, 'ASET TETAP' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '131' kode, 'Tanah' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('131')
                    union all
                    select '4' bold, '132' kode, 'Peralatan dan Mesin' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('132')
                    union all
                    select '4' bold, '133' kode, 'Gedung dan Bangunan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('133')
                    union all
                    select '4' bold, '134' kode, 'Jalan, Irigasi dan Jaringan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('134')
                    union all
                    select '4' bold, '135' kode, 'Aset Tetap Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('135')
                    union all
                    select '4' bold, '136' kode, 'Konstruksi dalam Pengerjaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('136')
                    union all
                    select '5' bold, '1369' kode, 'Jumlah Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('131','132','133','134','135','136')
                    union all
                    select '4' bold, '137' kode, 'Akumulasi Penyusutan Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('137')
                    union all
                    select '5' bold, '1379' kode, 'Jumlah Nilai Buku Aset Tetap' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('13')
                    union all
                    select '0' bold, '13799' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '14' kode, 'ASET LAINNYA' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '141' kode, 'Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('141')
                    union all
                    select '4' bold, '142' kode, 'Amortisasi Aset Tak Berwujud' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('145')
                    union all
                    select '4' bold, '143' kode, 'Aset Kemitraan dengan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('142')
                    union all
                    select '4' bold, '144' kode, 'Aset Tetap Non-Produktif' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id'and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('143')
                    union all
                    select '4' bold, '145' kode, 'Aset Lain-lain' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('144')
                    union all
                    select '5' bold, '1459' kode, 'Jumlah Aset Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('14')
                    union all
                    select '5' bold, '14599' kode, 'JUMLAH ASET' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then debet-kredit else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then debet-kredit else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('1')
                    union all
                    select '0' bold, '145999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '2' kode, 'KEWAJIBAN' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '21' kode, 'KEWAJIBAN JANGKA PENDEK' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '211' kode, 'Utang Usaha' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('211')
                    union all
                    select '4' bold, '212' kode, 'Utang Pajak' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('212')
                    union all
                    select '4' bold, '213' kode, 'Pendapatan Diterima di Muka' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('213')
                    union all
                    select '4' bold, '214' kode, 'Uang Persediaan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('214')
                    union all
                    select '4' bold, '215' kode, 'Biaya yang Masih Harus Dibayar' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('215')
                    union all
                    select '4' bold, '216' kode, 'Titipan Pihak Ketiga' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('216')
                    union all
                    select '4' bold, '217' kode, 'Bagian Lancar Utang Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('217')
                    union all
                    select '4' bold, '218' kode, 'Utang Bunga Pinjaman' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '4' bold, '219' kode, 'Kewajiban Jangka Pendek Lainnya' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('218')
                    union all
                    select '5' bold, '2199' kode, 'Jumlah Kewajiban Jangka Pendek' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('21')
                    union all
                    select '0' bold, '21999' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '22' kode, 'KEWAJIBAN JANGKA PANJANG' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '221' kode, 'Utang Dalam Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('221')
                    union all
                    select '4' bold, '222' kode, 'Utang Luar Negeri' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('222')
                    union all
                    select '4' bold, '223' kode, 'Pendapatan yang Ditangguhkan' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('223')
                    union all
                    select '5' bold, '2239' kode, 'Jumlah Kewajiban Jangka Panjang' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('22')
                    union all
                    select '0' bold, '22399' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '1' bold, '3' kode, 'EKUITAS' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '2' bold, '31' kode, 'EKUITAS TIDAK TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '311' kode, 'Ekuitas Awal' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('311')
                    union all
                    select '4' bold, '312' kode, 'Akumulasi Surplus/Defisit s.d. Tahun Lalu' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('312')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53'))  and reev IN ('0','2')
                    union all   
                    select '4' bold, '313' kode, 'Surplus/Defisit Tahun Berjalan' nm_rek,
                    0 nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and LEFT(a.kd_rek5,3) in ('313')  and reev IN ('0','2')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '4' bold, '314' kode, 'Ekuitas Donasi' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l  
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('314')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('31')
                    union all
                    select '5' bold, '3149' kode, 'Jumlah Ekuitas Tidak Terikat' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53')) and reev IN ('0','2')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select '0' bold, '31499' kode, '' nm_rek, 0 nilai, 0 nilai_l
                    union all
                    select '2' bold, '32' kode, 'EKUITAS TERIKAT' nm_rek, 0 nilai, 0 nilai_l 
                    union all
                    select '4' bold, '321' kode, 'Ekuitas Terikat Temporer' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('321')
                    union all
                    select '4' bold, '322' kode, 'Ekuitas Terikat Permanen' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,3) in ('322')
                    union all
                    select '5' bold, '3229' kode, 'Jumlah Ekuitas Terikat' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,2) in ('32')
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('3')
                    union all
                    select '5' bold, '32299' kode, 'JUMLAH EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53')) and reev IN ('0','2')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    union all
                    select x.bold,x.kode,x.nm_rek,sum(x.nilai) nilai,SUM(x.nilai_l) nilai_l from (
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang' and LEFT(a.kd_rek5,7)<>'3130101' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    isnull(sum(case when YEAR(tgl_voucher)<='$thn_ang_1' then kredit-debet else 0 end),0) nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and reev IN ('0','2') and LEFT(a.kd_rek5,1) in ('2','3')
                    union all
                    select '5' bold, '322999' kode, 'JUMLAH KEWAJIBAN DAN EKUITAS' nm_rek, 
                    isnull(sum(case when YEAR(tgl_voucher)='$thn_ang' and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) nilai,
                    0 nilai_l 
                    from trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where a.kd_unit='$id' and tabel<>'5' and (LEFT(a.kd_rek5,1) in ('4') or Left(a.kd_rek5,2) in ('51','53')) and reev IN ('0','2')
                    ) x
                    group by x.bold,x.kode,x.nm_rek
                    order by kode";
                    
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama       = $loquery->nm_rek;   
                //  $n          = $loquery->kode_1;
                //  $n          = ($n=="-"?"'-'":$n);
                    $nil        = $loquery->nilai;
                    $nil_lalu  = $loquery->nilai_l;
                    $nilai      = number_format($nil,"2",",",".");
                    $nilai_lalu = number_format($nil_lalu,"2",",",".");
                    
        /*$quelo01   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and reev='0' and b.kd_skpd='$id'";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_blud a inner join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(kd_rek5,3) in ($n) and year(tgl_voucher)=$thn_ang_1 and reev='0' and b.kd_skpd='$id'";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");*/
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4<b></td>
                                 </tr>";
                        break;
                    
                }              
                    
                }
        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
        $oioi = strtoupper($oioi);
        $jabatan = strtoupper($jabatan);
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> $daerah, $arraybulan[$cbulan] $thn_ang </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">  </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"></td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA_BLUD $id / $cbulan");
        $this->template->set('title', 'NERACA_BLUD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA_BLUD $id / $cbulan</title>");
             echo $cRet;
        break;
        case 4;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                 
    }

    function ctk_jurum_blud($dcetak='',$dcetak2='',$skpd='', $oke=''){
            $csql11 = " select nm_skpd from ms_skpd_blud where kd_skpd = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            $tgl=$this->tukd_model->tanggal_format_indonesia($dcetak);
            $tgl2=$this->tukd_model->tanggal_format_indonesia($dcetak2);
            $tgl=strtoupper($tgl);
            $tgl2=strtoupper($tgl2);
            
        $cRet ="";  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK
                </td>
            </tr>            
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>$lcskpd
                </td>
            </tr>
             <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;\"><b>JURNAL UMUM BLUD
                </td>
            </tr>
            <tr>
                <td colspan=\"11\" align=\"center\" style=\"border: solid 1px white;border-bottom:solid 1px white;\"><b>PERIODE $tgl SAMPAI DENGAN $tgl2
                </td>
            </tr>
            </table>";
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"90%\" align=\"center\" border=\"2\" cellspacing=\"0\" cellpadding=\"4\">
            <thead>
            <tr>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"rowspan=\"2\"><b>Nomor<br>Bukti</td>
                <td colspan=\"5\"bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\"><b>Kode<br>Rekening</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>Uraian</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" rowspan=\"2\"><b>ref</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\" colspan=\"2\"><b>Jumlah Rp</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>Debit</td>
                <td align=\"center\"bgcolor=\"#CCCCCC\"><b>Kredit</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"15%\";border-bottom:solid 1px red;\"><b>1</td>
                <td align=\"center\" width=\"10%\";border-bottom:solid 1px blue;\"><b>2</td>
                <td colspan=\"5\" align=\"center\" width=\"15%\"><b>3</td>
                <td align=\"center\" width=\"42%\"><b>4</td>
                <td align=\"center\" width=\"3%\"></td>
                <td align=\"center\" width=\"10%\"><b>5</td>
                <td align=\"center\" width=\"10%\"><b>6</td>
            </tr>
            </thead>
           ";
         
         $csql1 = "select count(*) as tot FROM 
                 trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher= b.no_voucher and a.kd_unit=b.kd_skpd 
                 where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd'"; 

         $rs = $this->db->query($csql1);
         $trh = $rs->row();
         
            
/*         $csql = "SELECT b.tgl_voucher,a.no_voucher,a.kd_rek5,(c.nm_rek64 + case when (pos='0') then '' else ''end) AS nm_rek5,a.debet,a.kredit FROM 
                  trdju_blud a LEFT JOIN trhju_blud b ON a.no_voucher= b.no_voucher join (SELECT kd_rek64,nm_Rek64 from ms_rek5 group by kd_rek64,nm_Rek64) c on a.kd_rek5=c.kd_rek64
                  where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                  ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5";   
*/
        
        /* 25/10/2016
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, nm_rek5,a.debet,a.kredit,a.rk from trdju_blud a join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd' 
                  ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5";*/
        
        $csql = "select b.tgl_voucher,a.no_voucher,a.kd_rek5, c.nm_rek5,a.debet,a.kredit,a.rk, left(a.kd_rek5,1) akun from trdju_blud a join trhju_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
        left join ms_rek5_blud c on a.kd_rek5=c.kd_rek5
                where b.tgl_voucher >= '$dcetak' and b.tgl_voucher <= '$dcetak2' and b.kd_skpd = '$skpd'
                 ORDER BY b.tgl_voucher,a.no_voucher,a.urut,a.rk,a.kd_rek5
                  ";
                
        
         $query = $this->db->query($csql);  
         $cnovoc = '';
         $lcno = 0;
         foreach($query->result_array() as $res){
                $lcno = $lcno + 1;
                if ($lcno==$trh->tot){
                    $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;border-top:none;\"></td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>"; 
                }else{
                        if($cnovoc==$res['no_voucher']){
                            $cRet .="<tr>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;border-top:none;\">&nbsp;</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";                    
                        }else{
                        $cRet .="<tr>
                                <td align=\"center\" style=\"border-bottom:none\">".$this->tukd_model->tanggal_ind($res['tgl_voucher'])."</td>
                                <td style=\"border-bottom:none\">".$res['no_voucher']."</td>
                                <td style=\"border-bottom:none;\">".substr($res['kd_rek5'],0,1)."</td>";
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],1,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,1)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],2,1)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],4,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],3,2)."</td>";}
                                if($res['akun']=='5'){
                                $cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],6,2)."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\">".substr($res['kd_rek5'],5,2)."</td>";}
                                $cRet .="<td style=\"border-bottom:none;\">".$res['nm_rek5']."</td>
                                <td style=\"border-bottom:none;\"></td>";
                                if($res['rk']=='K'){
                                    $cRet .=" <td style=\"border-bottom:none;\"></td>
                                            <td style=\"border-bottom:none;\" align=\"right\">".number_format($res['kredit'],"2",",",".")."</td>";
                                }else{$cRet .="<td style=\"border-bottom:none;\" align=\"right\">".number_format($res['debet'],"2",",",".")."</td>
                                               <td style=\"border-bottom:none;\"></td>";                                    
                                }
                       
                       $cRet .="</tr>";
                        }
                        $cnovoc=$res['no_voucher'];
                }
                
            }
            
         $cRet .=" <tr>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                        <td style=\"border-top:none\"></td>
                    </tr>  
         </table>
         ";

            $data['prev']=$cRet; //'JURNAL UMUM';

            if($oke==0){
                echo $cRet;
            }  if($oke==1){ //google
                $this->load->model('wprint');
                $this->wprint->PopUp($cRet);
            }  if($oke==2){
                  header("Content-Type: application/vnd.ms-excel");
                  header("Content-Disposition: attachment; filename= Jurnal_BLUD_$skpd.xls");
                  echo $cRet;
            }
            //$this->tukd_model->_mpdf('',$cRet,5,5,10,'0');    
    
    } 
  
    
    function cetak_neraca_blud_sap ($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        
        $cbulan<10 ? $xbulan = "0$cbulan" : $xbulan=$cbulan;

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>NERACA</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"55%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"55%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
        
        
        $sqleku = "select sum(eku) eku, sum(eku_lalu) eku_lalu, sum(utang) utang, sum(utang_lalu) utang_lalu, sum(eku+utang) sal, sum(eku_lalu+utang_lalu) sal_lalu from (
                    select isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(kd_rek5,1) in ('8','9') and a.kd_unit='$id' and a.kd_subkegiatan='95'
                    union all
                    select isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang_1' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where kd_rek5='3110101' and tabel='1' and reev='0' and a.kd_unit='$id' and a.kd_subkegiatan='95'
                    union all
                    select isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where kd_rek5='3110101' and reev in ('1','2','3','31','32','33','34','35','35','36','37','38','39','40','41','42','43','44','45') and a.kd_unit='$id'
                    union all
                    select isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(kd_rek5,5)=left('3130101',5) and a.kd_unit='$id' and a.kd_subkegiatan='95'
                    union all
                    select 0 eku, 0 eku_lalu,
                    isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) utang,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) utang_lalu 
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where LEFT(kd_rek5,1)='2' and a.kd_unit='$id' and a.kd_subkegiatan='95'
                    ) a";//Henri_TB                          

                    $hasil = $this->db->query($sqleku); 
                    foreach ($hasil->result() as $row)
                    {
                       $eku  =$row->eku;
                       $eku_lalu  =$row->eku_lalu;
                       $utang  =$row->utang;
                       $utang_lalu  =$row->utang_lalu;
                       $sal  =$row->sal;
                       $sal_lalu  =$row->sal_lalu;


                    }       
            
                    if ($eku < 0){
                        $aeku="("; $ekux=$eku*-1; $beku=")";}
                    else {
                        $aeku=""; $ekux=$eku; $beku="";}
                    $ekuz = number_format($ekux,"2",",",".");
                    
                    if ($eku_lalu < 0){
                        $aeku_lalu="("; $eku_lalux=$eku_lalu*-1; $beku_lalu=")";}
                    else {
                        $aeku_lalu=""; $eku_lalux=$eku_lalu; $beku_lalu="";}
                    $eku_laluz = number_format($eku_lalux,"2",",",".");
                    
                    if ($utang < 0){
                        $autang="("; $utangx=$utang*-1; $butang=")";}
                    else {
                        $autang=""; $utangx=$utang; $butang="";}
                    $utangz = number_format($utangx,"2",",",".");
                    
                    if ($utang_lalu < 0){
                        $autang_lalu="("; $utang_lalux=$utang_lalu*-1; $butang_lalu=")";}
                    else {
                        $autang_lalu=""; $utang_lalux=$utang_lalu; $butang_lalu="";}
                    $utang_laluz = number_format($utang_lalux,"2",",",".");
                    
                    if ($sal < 0){
                        $asal="("; $salx=$sal*-1; $bsal=")";}
                    else {
                        $asal=""; $salx=$sal; $bsal="";}
                    $salz = number_format($salx,"2",",",".");
                    
                    if ($sal_lalu < 0){
                        $asal_lalu="("; $sal_lalux=$sal_lalu*-1; $bsal_lalu=")";}
                    else {
                        $asal_lalu=""; $sal_lalux=$sal_lalu; $bsal_lalu="";}
                    $sal_laluz = number_format($sal_lalux,"2",",",".");
                    
        $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, kode_1, kode_2, kode_3 FROM map_neraca_blud ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 1;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                                        
                        
                $quelo01   = "SELECT SUM($cetak) as nilai FROM [simblud_ponti_$thn_ang_1].[dbo].[trdju_sap_blud] a inner join [simblud_ponti_$thn_ang_1].[dbo].[trhju_sap_blud] b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)<'$thn_ang' and (left(kd_rek5,3) in ($kode_1) or left(kd_rek5,5) in ($kode_2) or left(kd_rek5,7) in ($kode_3)) and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil_lalu     = $quelo03->nilai;    
                
                $quelo04   = "SELECT SUM($cetak) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and (left(kd_rek5,3) in ($kode_1) or left(kd_rek5,5) in ($kode_2) or left(kd_rek5,7) in ($kode_3)) and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil     = $quelo06->nilai;
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$aeku$ekuz$beku</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$aeku_lalu$eku_laluz$beku_lalu</td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$aeku$ekuz$beku<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$aeku_lalu$eku_laluz$beku_lalu<b></td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$asal$salz$bsal<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$asal_lalu$sal_laluz$bsal_lalu<b></td>
                                 </tr>";
                        break;  
                }              
                    
                }

        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where left(kd_skpd,7)=left('$id',7) and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;,</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'NERACA BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA SKPD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }  

    
    function cetak_neraca_blud_apbd_sap ($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        
        $cbulan<10 ? $xbulan = "0$cbulan" : $xbulan=$cbulan;

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>NERACA</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"55%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"55%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";
        
        
        $sqleku = "select sum(eku) eku, sum(eku_lalu) eku_lalu, sum(utang) utang, sum(utang_lalu) utang_lalu, sum(eku+utang) sal, sum(eku_lalu+utang_lalu) sal_lalu from (
                    select isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(kd_rek5,1) in ('8','9') and a.kd_unit='$id'
                    union all
                    select isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang_1' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where kd_rek5='3110101' and tabel='1' and reev='0' and a.kd_unit='$id'
                    union all
                    select isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where kd_rek5='3110101' and reev in ('1','2','3','31','32','33','34','35','35','36','37','38','39','40','41','42','43','44','45') and a.kd_unit='$id'
                    union all
                    select isnull(sum(case when left(kd_rek5,5)=left('31301',5) and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) eku,
                    isnull(sum(case when left(kd_rek5,5)=left('31301',5) and YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) eku_lalu,
                    0 utang, 0 utang_lalu
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where left(kd_rek5,3)=left('313',3) and a.kd_unit='$id'
                    union all
                    select 0 eku, 0 eku_lalu,
                    isnull(sum(case when left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' then kredit-debet else 0 end),0) utang,
                    isnull(sum(case when YEAR(tgl_voucher)<'$thn_ang' then kredit-debet else 0 end),0) utang_lalu 
                    from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                    where LEFT(kd_rek5,1)='2' and a.kd_unit='$id'
                    ) a";//Henri_TB                          

                    $hasil = $this->db->query($sqleku); 
                    foreach ($hasil->result() as $row)
                    {
                       $eku  =$row->eku;
                       $eku_lalu  =$row->eku_lalu;
                       $utang  =$row->utang;
                       $utang_lalu  =$row->utang_lalu;
                       $sal  =$row->sal;
                       $sal_lalu  =$row->sal_lalu;


                    }       
            
                    if ($eku < 0){
                        $aeku="("; $ekux=$eku*-1; $beku=")";}
                    else {
                        $aeku=""; $ekux=$eku; $beku="";}
                    $ekuz = number_format($ekux,"2",",",".");
                    
                    if ($eku_lalu < 0){
                        $aeku_lalu="("; $eku_lalux=$eku_lalu*-1; $beku_lalu=")";}
                    else {
                        $aeku_lalu=""; $eku_lalux=$eku_lalu; $beku_lalu="";}
                    $eku_laluz = number_format($eku_lalux,"2",",",".");
                    
                    if ($utang < 0){
                        $autang="("; $utangx=$utang*-1; $butang=")";}
                    else {
                        $autang=""; $utangx=$utang; $butang="";}
                    $utangz = number_format($utangx,"2",",",".");
                    
                    if ($utang_lalu < 0){
                        $autang_lalu="("; $utang_lalux=$utang_lalu*-1; $butang_lalu=")";}
                    else {
                        $autang_lalu=""; $utang_lalux=$utang_lalu; $butang_lalu="";}
                    $utang_laluz = number_format($utang_lalux,"2",",",".");
                    
                    if ($sal < 0){
                        $asal="("; $salx=$sal*-1; $bsal=")";}
                    else {
                        $asal=""; $salx=$sal; $bsal="";}
                    $salz = number_format($salx,"2",",",".");
                    
                    if ($sal_lalu < 0){
                        $asal_lalu="("; $sal_lalux=$sal_lalu*-1; $bsal_lalu=")";}
                    else {
                        $asal_lalu=""; $sal_lalux=$sal_lalu; $bsal_lalu="";}
                    $sal_laluz = number_format($sal_lalux,"2",",",".");
                    
        $sqlmaplo=" SELECT nor, uraian, cetak, seq, bold, kode_1, kode_2, kode_3 FROM map_neraca_blud ORDER BY seq";
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {   
                    $nor        = $loquery->nor;
                    $uraian     = $loquery->uraian;
                    $cetak      = $loquery->cetak;
                    $seq        = $loquery->seq;
                    $bold       = $loquery->bold;
                    $kode_1     = $loquery->kode_1;
                    $kode_2     = $loquery->kode_2;
                    $kode_3     = $loquery->kode_3;
                                        
                        
                $quelo01   = "SELECT SUM($cetak) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)<'$thn_ang' and (left(kd_rek5,3) in ($kode_1) or left(kd_rek5,5) in ($kode_2) or left(kd_rek5,7) in ($kode_3)) and b.kd_skpd='$id'";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil_lalu     = $quelo03->nilai;    
                
                $quelo04   = "SELECT SUM($cetak) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and (left(kd_rek5,3) in ($kode_1) or left(kd_rek5,5) in ($kode_2) or left(kd_rek5,7) in ($kode_3)) and b.kd_skpd='$id'";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil     = $quelo06->nilai;
                    
                    if ($nil_lalu < 0){
                        $lol0="("; $nil_lalux=$nil_lalu*-1; $lol00=")";}
                    else {
                        $lol0=""; $nil_lalux=$nil_lalu; $lol00="";}
                    $nilai_lalu = number_format($nil_lalux,"2",",",".");
                    
                    if ($nil < 0){
                        $lo0="("; $nilx=$nil*-1; $lo00=")";}
                    else {
                        $lo0=""; $nilx=$nil; $lo00="";}
                    $nilai = number_format($nilx,"2",",",".");
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$nilai$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lol0$nilai_lalu$lol00</td>
                                 </tr>";
                        break;  
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$nilai$lo00<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lol0$nilai_lalu$lol00<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$aeku$ekuz$beku</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$aeku_lalu$eku_laluz$beku_lalu</td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$aeku$ekuz$beku<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$aeku_lalu$eku_laluz$beku_lalu<b></td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"55%\"><b>$uraian<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$asal$salz$bsal<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$asal_lalu$sal_laluz$bsal_lalu<b></td>
                                 </tr>";
                        break;  
                }              
                    
                }

        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where left(kd_skpd,7)=left('$id',7) and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;,</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA APBD & BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'NERACA APBD & BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA SKPD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }  


    function cetak_lo_blud_sap($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        //$laporan=$lap; 
       
       // if ($cetak == '1') {
//           $skpd = '';
//           $skpd1 = '';           
//       } else {             
           $skpd = "AND kd_skpd='$id'";
           $skpd1 = "AND b.kd_skpd='$id'"; 
       //}  

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('81','82','83') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('81','82','83') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('91','92') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('91','92') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        $sqllo5="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('84') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo5= $this->db->query($sqllo5);
                    $penlo3 = $querylo5->row();
                    $pen_lo3 = $penlo3->nilai;
                    $pen_lo31= number_format($penlo3->nilai,"2",",",".");
        
        $sqllo6="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('84') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo6= $this->db->query($sqllo6);
                    $penlo4 = $querylo6->row();
                    $pen_lo_lalu4 = $penlo4->nilai;
                    $pen_lo_lalu41= number_format($penlo4->nilai,"2",",",".");
        
        $sqllo7="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('93') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo7= $this->db->query($sqllo7);
                    $bello5 = $querylo7->row();
                    $bel_lo5 = $bello5->nilai;
                    $bel_lo51= number_format($bello5->nilai,"2",",",".");
        
        $sqllo8="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('93') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo8= $this->db->query($sqllo8);
                    $bello6 = $querylo8->row();
                    $bel_lo_lalu6 = $bello6->nilai;
                    $bel_lo_lalu61= number_format($bello6->nilai,"2",",",".");      

                    $surplus_lo2 = $pen_lo3 - $bel_lo5;
                    if ($surplus_lo2 < 0){
                        $lo7="("; $surplus_lo2x=$surplus_lo2*-1; $lo8=")";}
                    else {
                        $lo7=""; $surplus_lo2x=$surplus_lo2; $lo8="";}      
                    $surplus_lo21 = number_format($surplus_lo2x,"2",",",".");
                    
                    $surplus_lo_lalu2 = $pen_lo_lalu4 - $bel_lo_lalu6;
                    if ($surplus_lo_lalu2 < 0){
                        $lo9="("; $surplus_lo_lalu2x=$surplus_lo_lalu2*-1; $lo10=")";}
                    else {
                        $lo9=""; $surplus_lo_lalu2x=$surplus_lo_lalu2; $lo10="";}                       
                    $surplus_lo_lalu21 = number_format($surplus_lo_lalu2x,"2",",",".");

                    $selisih_surplus_lo2 = $surplus_lo2 - $surplus_lo_lalu2;
                    if ($selisih_surplus_lo2 < 0){
                        $lo11="("; $selisih_surplus_lo2x=$selisih_surplus_lo2*-1; $lo12=")";}
                    else {
                        $lo11=""; $selisih_surplus_lo2x=$selisih_surplus_lo2; $lo12="";}
                    $selisih_surplus_lo21 = number_format($selisih_surplus_lo2x,"2",",",".");
                    
                    if( $surplus_lo_lalu2=='' or $surplus_lo_lalu2==0){
                    $persen3 = '0,00';
                    }else{
                    $persen3 = ($surplus_lo2/$surplus_lo_lalu2)*100;
                    $persen3 = number_format($persen3,"2",",",".");
                    }
        
        $sqllo9="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('8') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('9') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3x=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $surplus_lo3x=$surplus_lo3; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3x,"2",",",".");
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3x=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $surplus_lo_lalu3x=$surplus_lo_lalu3; $lo16="";}                      
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3x,"2",",",".");

                    $selisih_surplus_lo3 = $surplus_lo3 - $surplus_lo_lalu3;
                    if ($selisih_surplus_lo3 < 0){
                        $lo17="("; $selisih_surplus_lo3x=$selisih_surplus_lo3*-1; $lo18=")";}
                    else {
                        $lo17=""; $selisih_surplus_lo3x=$selisih_surplus_lo3; $lo18="";}
                    $selisih_surplus_lo31 = number_format($selisih_surplus_lo3x,"2",",",".");
                    
                    if( $surplus_lo_lalu3=='' or $surplus_lo_lalu3==0){
                    $persen4 = '0,00';
                    }else{
                    $persen4 = ($surplus_lo3/$surplus_lo_lalu3)*100;
                    $persen4 = number_format($persen4,"2",",",".");
                    }
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>LAPORAN OPERASIONAL </strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td> 
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                            <td  bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\" ><b>Kenaikan<br/>(Penurunan)</b></td>
                            <td  bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border:none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="SELECT seq, nor, uraian, bold, isnull(kode_1,'-') as kode_1, isnull(kode_2,'-') as kode_2, isnull(kode_3,'-') as kode_3, isnull(kode_4,'-') as kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lo_blud
                   GROUP BY seq, nor, uraian, bold, isnull(kode_1,'-') , isnull(kode_2,'-'), isnull(kode_3,'-'), isnull(kode_4,'-'), isnull(cetak,'debet-debet') ORDER BY seq";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    
                    $nama      = $loquery->uraian;   
                    $n         = $loquery->kode_1;
                    $n         = ($n=="-"?"'-'":$n);
                    $n1         = $loquery->kode_2;
                    $n1        = ($n1=="-"?"'-'":$n1);
                    $n2         = $loquery->kode_3;
                    $n2        = ($n2=="-"?"'-'":$n2);
                    $n3         = $loquery->kode_4;
                    $n3        = ($n3=="-"?"'-'":$n3);
                    $normal    = $loquery->cetak;
                    $bold      = $loquery->bold;
                    
        $quelo01   = "SELECT SUM($normal) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) and a.kd_subkegiatan='95' ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE  year(tgl_voucher)=$thn_ang_1 and b.kd_skpd='$id'  and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) and a.kd_subkegiatan='95' ";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$real_nilai1$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$real_nilai1$lo00</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1</b></td>
                                 </tr>";
                        break;
                    case 5:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo5$selisih_surplus_lo1$lo6</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen2</b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo7$surplus_lo21$lo8</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo9$surplus_lo_lalu21$lo10</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo11$selisih_surplus_lo21$lo12</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen3</b></td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo13$surplus_lo31$lo14</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo15$surplus_lo_lalu31$lo16</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo17$selisih_surplus_lo31$lo18</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen4</td>
                                 </tr>";
                        break;  
                }
                              
                    
                }

        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where left(kd_skpd,7)=left('$id',7) and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LO BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO SKPD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }
    function minim($nil=''){

            if($nil<=0){
                $kur1="("; $kur2=")";
                $oke=number_format($nil*(-1),"2",",",".");
                $jiwa="$kur1 $oke $kur2";
           } elseif($nil>0){
               $jiwa=number_format($nil,"2",",",".");
            }
           return $jiwa;
    }
    
    function persen($satu='',$dua=''){
        $persen=0;
        $persen = ($satu/$dua)*100;
        $persen = number_format($persen,"2",",",".");
        return $persen;
    }
    function cetak_lo_blud_apbd_sap($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        //$laporan=$lap; 
       
       // if ($cetak == '1') {
//           $skpd = '';
//           $skpd1 = '';           
//       } else {             
           $skpd = "AND kd_skpd='$id'";
           $skpd1 = "AND b.kd_skpd='$id'"; 
       //}  

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
            
        $sqllo1="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('81','82','83') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('81','82','83') and b.kd_skpd='$id' ";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('91','92') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('91','92') and b.kd_skpd='$id' ";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }
                    
        $sqllo5="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('84') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo5= $this->db->query($sqllo5);
                    $penlo3 = $querylo5->row();
                    $pen_lo3 = $penlo3->nilai;
                    $pen_lo31= number_format($penlo3->nilai,"2",",",".");
        
        $sqllo6="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('84') and b.kd_skpd='$id' ";
                    $querylo6= $this->db->query($sqllo6);
                    $penlo4 = $querylo6->row();
                    $pen_lo_lalu4 = $penlo4->nilai;
                    $pen_lo_lalu41= number_format($penlo4->nilai,"2",",",".");
        
        $sqllo7="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('93') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo7= $this->db->query($sqllo7);
                    $bello5 = $querylo7->row();
                    $bel_lo5 = $bello5->nilai;
                    $bel_lo51= number_format($bello5->nilai,"2",",",".");
        
        $sqllo8="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('93') and b.kd_skpd='$id' ";
                    $querylo8= $this->db->query($sqllo8);
                    $bello6 = $querylo8->row();
                    $bel_lo_lalu6 = $bello6->nilai;
                    $bel_lo_lalu61= number_format($bello6->nilai,"2",",",".");      

                    $surplus_lo2 = $pen_lo3 - $bel_lo5;
                    if ($surplus_lo2 < 0){
                        $lo7="("; $surplus_lo2x=$surplus_lo2*-1; $lo8=")";}
                    else {
                        $lo7=""; $surplus_lo2x=$surplus_lo2; $lo8="";}      
                    $surplus_lo21 = number_format($surplus_lo2x,"2",",",".");
                    
                    $surplus_lo_lalu2 = $pen_lo_lalu4 - $bel_lo_lalu6;
                    if ($surplus_lo_lalu2 < 0){
                        $lo9="("; $surplus_lo_lalu2x=$surplus_lo_lalu2*-1; $lo10=")";}
                    else {
                        $lo9=""; $surplus_lo_lalu2x=$surplus_lo_lalu2; $lo10="";}                       
                    $surplus_lo_lalu21 = number_format($surplus_lo_lalu2x,"2",",",".");

                    $selisih_surplus_lo2 = $surplus_lo2 - $surplus_lo_lalu2;
                    if ($selisih_surplus_lo2 < 0){
                        $lo11="("; $selisih_surplus_lo2x=$selisih_surplus_lo2*-1; $lo12=")";}
                    else {
                        $lo11=""; $selisih_surplus_lo2x=$selisih_surplus_lo2; $lo12="";}
                    $selisih_surplus_lo21 = number_format($selisih_surplus_lo2x,"2",",",".");
                    
                    if( $surplus_lo_lalu2=='' or $surplus_lo_lalu2==0){
                    $persen3 = '0,00';
                    }else{
                    $persen3 = ($surplus_lo2/$surplus_lo_lalu2)*100;
                    $persen3 = number_format($persen3,"2",",",".");
                    }
        
        $sqllo9="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('8') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id'";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('9') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' ";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' ";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3x=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $surplus_lo3x=$surplus_lo3; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3x,"2",",",".");
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3x=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $surplus_lo_lalu3x=$surplus_lo_lalu3; $lo16="";}                      
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3x,"2",",",".");

                    $selisih_surplus_lo3 = $surplus_lo3 - $surplus_lo_lalu3;
                    if ($selisih_surplus_lo3 < 0){
                        $lo17="("; $selisih_surplus_lo3x=$selisih_surplus_lo3*-1; $lo18=")";}
                    else {
                        $lo17=""; $selisih_surplus_lo3x=$selisih_surplus_lo3; $lo18="";}
                    $selisih_surplus_lo31 = number_format($selisih_surplus_lo3x,"2",",",".");
                    
                    if( $surplus_lo_lalu3=='' or $surplus_lo_lalu3==0){
                    $persen4 = '0,00';
                    }else{
                    $persen4 = ($surplus_lo3/$surplus_lo_lalu3)*100;
                    $persen4 = number_format($persen4,"2",",",".");
                    }
     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>LAPORAN OPERASIONAL </strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td> 
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                            <td  bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\" ><b>Kenaikan<br/>(Penurunan)</b></td>
                            <td  bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border:none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="SELECT seq, nor, uraian, bold, isnull(kode_1,'-') as kode_1, isnull(kode_2,'-') as kode_2, isnull(kode_3,'-') as kode_3, isnull(kode_4,'-') as kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lo_blud
                   GROUP BY seq, nor, uraian, bold, isnull(kode_1,'-') , isnull(kode_2,'-'), isnull(kode_3,'-'), isnull(kode_4,'-'), isnull(cetak,'debet-debet') ORDER BY seq";
                 //  echo "$sqlmaplo";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    
                    $nama      = $loquery->uraian;   
                    $n         = $loquery->kode_1;
                    $n         = ($n=="-"?"'-'":$n);
                    $n1         = $loquery->kode_2;
                    $n1        = ($n1=="-"?"'-'":$n1);
                    $n2         = $loquery->kode_3;
                    $n2        = ($n2=="-"?"'-'":$n2);
                    $n3         = $loquery->kode_4;
                    $n3        = ($n3=="-"?"'-'":$n3);
                    $normal    = $loquery->cetak;
                    $bold      = $loquery->bold;
                    
        $quelo01   = "SELECT SUM($normal) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) ";
        //echo "$quelo01";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT SUM($normal) as nilai FROM trdju_sap_blud_copy a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE  year(tgl_voucher)=$thn_ang_1 and b.kd_skpd='$id'  and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) ";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo0$real_nilai1$lo00</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$real_nilai1$lo00</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1</b></td>
                                 </tr>";
                        break;
                    case 41:
                            $ok=0; $oc=0;
                            $oke=$nil; $oc=$nil_lalu;
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$real_nilai1$lo00</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1</b></td>
                                 </tr>";
                        break;

                    case 48: 

                        $pen=0; $penl=0; 
                        $pen=$nil; $penl=$nil_lalu; 
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$real_nilai1$lo00</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1</b></td>
                                 </tr>";
                        break; 
                    case 49:
                        $beb=0; $bebl=0;
                        $beb=$nil; $bebl=$nil_lalu;

                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo0$real_nilai1$lo00</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1</b></td>
                                 </tr>";
                        break;                          
                    case 5:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$surplus_lo_lalu1$lo4</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo5$selisih_surplus_lo1$lo6</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen2</b></td>
                                 </tr>";
                        break;
                    case 51: /*Surplus / Defisit Operasional*/

                    $sur=0; $surl=0; $surt=0;
                    $sur=$pen-$beb; $surl=$penl-$bebl;
                    $surt=$sur-$surl;
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($sur)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($surl)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($surt)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>".$this->persen($sur,$surl)."</b></td>
                                 </tr>";
                        break;
                    case 6: /*JUMLAH SURPLUS / DEFISIT NON OPERASIONAL*/
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo7$surplus_lo21$lo8</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo9$surplus_lo_lalu21$lo10</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo11$selisih_surplus_lo21$lo12</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen3</b></td>
                                 </tr>";
                        break;
                    case 42: /*SURPLUS / DEFISIT-LO */
                            $lo=0; $lol=0;
                            $lo=$oke+$sur;
                            $lol=$oc+$surl;
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($lo)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($lol)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>".$this->minim($lo-$lol)."</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>".$this->persen($lo,$lol)."</b></td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo13$surplus_lo31$lo14</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo15$surplus_lo_lalu31$lo16</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo17$selisih_surplus_lo31$lo18</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen4</td>
                                 </tr>";
                        break;  
                }
                              
                    
                }

        
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where left(kd_skpd,7)=left('$id',7) and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LO BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LO BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LO SKPD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }
    

    function cetak_lak_blud_sapx($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        //$laporan=$lap; 
       
       // if ($cetak == '1') {
//           $skpd = '';
//           $skpd1 = '';           
//       } else {             
           $skpd = "AND kd_skpd='$id'";
           $skpd1 = "AND b.kd_skpd='$id'"; 
       //}  

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
            
        $sqllo1="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and jns<>'1' and left(kd_rek5,7) in ('8330103','4140302','4142001','4141804','4142002','4142003','4141801') ";
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,7) in ('8330103','4140302','4142001','4141804','4142002','4142003','4141801') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and jns<>'1' and (left(kd_rek5,3) in ('511') or left(kd_rek5,5) in ('51225','51219','51201','51202','51206','51208','51210','51211','51212','51228','51218','51204','51215','51220','51222','51223','51205') or left(kd_rek5,7) in ('5120308','5120309','5120310','5120311','5120312','5120313','5120314','5120316','5120317','5120318','5120319','5120320','5120321','5120322','5120323','5120324','5120325','5120326','5120327','5120328','5120329','5120330','5120331','5120332','5120336','5120337','5120338','5120339','5120301','5120302','5120303','5120305','5120306','5120307') ) ";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="SELECT sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and (left(kd_rek5,3) in ('511') or left(kd_rek5,5) in ('51225','51219','51201','51202','51206','51208','51210','51211','51212','51228','51218','51204','51215','51220','51222','51223','51205') or left(kd_rek5,7) in ('5120308','5120309','5120310','5120311','5120312','5120313','5120314','5120316','5120317','5120318','5120319','5120320','5120321','5120322','5120323','5120324','5120325','5120326','5120327','5120328','5120329','5120330','5120331','5120332','5120336','5120337','5120338','5120339','5120301','5120302','5120303','5120305','5120306','5120307') ) and a.kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }

//created  prof ali
            
        $sqllo11="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and jns<>'1'  and (left(kd_rek5,7) in ('4140101','4140102','4140103','4140104','4140105','4140201') or left(kd_rek5,3) in ('717')) ";
                    $querylo1= $this->db->query($sqllo11);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo21="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and (left(kd_rek5,8) in ('4140101','4140102','4140103','4140104','4140105','4140201') or left(kd_rek5,3) in ('717')) and a.kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo21);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo31="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and jns<>'1' and left(kd_rek5,3) in ('521','522','523','524','525','526','722','725') ";
                    $querylo3= $this->db->query($sqllo31);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo41="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('521','522','523','524','525','526','722','725') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo41);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_inves = $pen_lo - $bel_lo;
                    if ($surplus_lo_inves < 0){
                        $lo19="("; $surplus_lox_inv=$surplus_lo_inves*-1; $lo29=")";}
                    else {
                        $lo19=""; $surplus_lox_inv=$surplus_lo_inves; $lo29="";}        
                    $surplus_inv_lo1 = number_format($surplus_lox_inv,"2",",",".");
                    
                    $surplus_lo_lalu_inves = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_inves < 0){
                        $lo39="("; $surplus_lo_lalux_inv=$surplus_lo_lalu_inves*-1; $lo49=")";}
                    else {
                        $lo39=""; $surplus_lo_lalux_inv=$surplus_lo_lalu_inves; $lo49="";}                      
                    $surplus_inv_lo_lalu1 = number_format($surplus_lo_lalux_inv,"2",",",".");


//created  prof ali
            
        $sqllo12="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and left(kd_rek5,3) in ('714','716') and a.kd_subkegiatan='95' ";
                    $querylo1= $this->db->query($sqllo12);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo22="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and left(kd_rek5,3) in ('714','716') and a.kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo22);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo32="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,3) in ('723','726') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1'  and a.kd_subkegiatan='95'";
                    $querylo3= $this->db->query($sqllo32);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo42="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('723','726') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo42);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_pendan = $pen_lo - $bel_lo;
                    if ($surplus_lo_pendan < 0){
                        $lo15="("; $surplus_lox_pendn=$surplus_lo_pendan*-1; $lo25=")";}
                    else {
                        $lo15=""; $surplus_lox_pendn=$surplus_lo_pendan; $lo25="";}     
                    $surplus_pendn_lo1 = number_format($surplus_lox_pendn,"2",",",".");
                    
                    $surplus_lo_lalu_pendan = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_pendan < 0){
                        $lo35="("; $surplus_lo_lalux_pendn=$surplus_lo_lalu_pendan*-1; $lo45=")";}
                    else {
                        $lo35=""; $surplus_lo_lalux_pendn=$surplus_lo_lalu_pendan; $lo45="";}                       
                    $surplus_pendn_lo_lalu1 = number_format($surplus_lo_lalux_pendn,"2",",",".");
    
//created  prof ali
            
        $sqllo14="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and left(kd_rek5,3) in ('211') and a.kd_subkegiatan='95' ";
                    $querylo1= $this->db->query($sqllo14);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo24="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and left(kd_rek5,3) in ('211') and a.kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo24);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo34="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,3) in ('211') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and a.kd_subkegiatan='95' ";
                    $querylo3= $this->db->query($sqllo34);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo44="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('211') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo44);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_transit = $pen_lo - $bel_lo;
                    if ($surplus_lo_transit < 0){
                        $lo18="("; $surplus_lox_tran=$surplus_lo_transit*-1; $lo28=")";}
                    else {
                        $lo18=""; $surplus_lox_tran=$surplus_lo_transit; $lo28="";}     
                    $surplus_tran_lo1 = number_format($surplus_lox_tran,"2",",",".");
                    
                    $surplus_lo_lalu_transit = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_transit < 0){
                        $lo38="("; $surplus_lo_lalux_tran=$surplus_lo_lalu_transit*-1; $lo48=")";}
                    else {
                        $lo38=""; $surplus_lo_lalux_tran=$surplus_lo_lalu_transit; $lo48="";}                       
                    $surplus_tran_lo_lalu1 = number_format($surplus_lo_lalux_tran,"2",",",".");

//prof ali                  
//pajak  
     
        
        $sqllo101="select sum(b.nilai) as nilai from trhtrmpot_blud a inner join trdtrmpot_blud b on a.kd_skpd=b.kd_skpd and a.no_bukti=b.no_bukti where a.kd_skpd='$id' and year(tgl_bukti)=$thn_ang ";
                    $querylo12= $this->db->query($sqllo101);
                    $bello10 = $querylo12->row();
                    $trm_pajak = $bello10->nilai;
                    
                    if ($trm_pajak < 0){
                        $trm12="("; $trm_pajakx=$trm_pajak*-1; $trm22=")";}
                    else {
                        $trm12=""; $trm_pajakx=$trm_pajak; $trm22="";}      
                    $trm_pajak31 = number_format($trm_pajakx,"2",",",".");
                    
        
        $sqllo101="select sum(b.nilai) as nilai from trhstrpot_blud a inner join trdstrpot_blud b on a.kd_skpd=b.kd_skpd and a.no_bukti=b.no_bukti where a.kd_skpd='$id' and year(tgl_bukti)=$thn_ang ";
                    $querylo12= $this->db->query($sqllo101);
                    $bello10 = $querylo12->row();
                    $str_pajak = $bello10->nilai;
                    
                    if ($str_pajak < 0){
                        $str12="("; $str_pajakx=$str_pajak*-1; $str22=")";}
                    else {
                        $str12=""; $str_pajakx=$str_pajak; $str22="";}      
                    $str_pajak31 = number_format($str_pajakx,"2",",",".");                    
     
                $pajak_akhir    = $trm_pajak - $str_pajak;
     
                    if ($pajak_akhir < 0){
                        $lo111="("; $pajak_akhirx=$pajak_akhir*-1; $lo222=")";}
                    else {
                        $lo111=""; $pajak_akhirx=$pajak_akhir; $lo222="";}      
                    $pajak_akhir31 = number_format($pajak_akhirx,"2",",",".");

    
//created  prof ali
                    $kenaik_surplus_lo =  $surplus_lo + $surplus_lo_pendan + $surplus_lo_inves + $surplus_lo_transit + $pajak_akhir;
                         
                    if ($kenaik_surplus_lo < 0){
                        $lo144="("; $kenaik_surplus_lox=$kenaik_surplus_lo*-1; $lo244=")";}
                    else {
                        $lo144=""; $kenaik_surplus_lox=$kenaik_surplus_lo; $lo244="";}      
                    $kenaik_surplus_lo1 = number_format($kenaik_surplus_lox,"2",",",".");
                        
        $kenaik_surplus_lo_lalu =  $surplus_lo_lalu + $surplus_lo_lalu_inves + $surplus_lo_lalu_pendan + $surplus_lo_lalu_transit;
                    
                    if ($kenaik_surplus_lo_lalu < 0){
                        $lo34="("; $kenaik_surplus_lo_lalux=$kenaik_surplus_lo_lalu*-1; $lo44=")";}
                    else {
                        $lo34=""; $kenaik_surplus_lo_lalux=$kenaik_surplus_lo_lalu; $lo44="";}      
                    $kenaik_surplus_lo_lalu1 = number_format($kenaik_surplus_lo_lalux,"2",",",".");
                    
                    
        $sqllo5="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('84') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1'  and a.kd_subkegiatan='95'";
                    $querylo5= $this->db->query($sqllo5);
                    $penlo3 = $querylo5->row();
                    $pen_lo3 = $penlo3->nilai;
                    $pen_lo31= number_format($penlo3->nilai,"2",",",".");
        
        $sqllo6="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('84') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo6= $this->db->query($sqllo6);
                    $penlo4 = $querylo6->row();
                    $pen_lo_lalu4 = $penlo4->nilai;
                    $pen_lo_lalu41= number_format($penlo4->nilai,"2",",",".");
        
        $sqllo7="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('93') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and a.kd_subkegiatan='95' ";
                    $querylo7= $this->db->query($sqllo7);
                    $bello5 = $querylo7->row();
                    $bel_lo5 = $bello5->nilai;
                    $bel_lo51= number_format($bello5->nilai,"2",",",".");
        
        $sqllo8="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('93') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo8= $this->db->query($sqllo8);
                    $bello6 = $querylo8->row();
                    $bel_lo_lalu6 = $bello6->nilai;
                    $bel_lo_lalu61= number_format($bello6->nilai,"2",",",".");      

                    $surplus_lo2 = $pen_lo3 - $bel_lo5;
                    if ($surplus_lo2 < 0){
                        $lo7="("; $surplus_lo2x=$surplus_lo2*-1; $lo8=")";}
                    else {
                        $lo7=""; $surplus_lo2x=$surplus_lo2; $lo8="";}      
                    $surplus_lo21 = number_format($surplus_lo2x,"2",",",".");
                    
                    $surplus_lo_lalu2 = $pen_lo_lalu4 - $bel_lo_lalu6;
                    if ($surplus_lo_lalu2 < 0){
                        $lo9="("; $surplus_lo_lalu2x=$surplus_lo_lalu2*-1; $lo10=")";}
                    else {
                        $lo9=""; $surplus_lo_lalu2x=$surplus_lo_lalu2; $lo10="";}                       
                    $surplus_lo_lalu21 = number_format($surplus_lo_lalu2x,"2",",",".");

        
        $sqllo9="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('8') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and a.kd_subkegiatan='95' ";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('9') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and a.kd_subkegiatan='95' ";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3x=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $surplus_lo3x=$surplus_lo3; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3x,"2",",",".");
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3x=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $surplus_lo_lalu3x=$surplus_lo_lalu3; $lo16="";}                      
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3x,"2",",",".");

//prof ali                  
     
     
        
        $sqllo100="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and tgl_voucher<='2018-01-02' and left(kd_rek5,3) in ('111') and b.kd_skpd='$id' and b.tabel='1' and a.kd_subkegiatan='95' ";
                    $querylo12= $this->db->query($sqllo100);
                    $bello10 = $querylo12->row();
                    $kas_lo = $bello10->nilai;
                    
                    if ($kas_lo < 0){
                        $lo12="("; $kas_lox=$kas_lo*-1; $lo22=")";}
                    else {
                        $lo12=""; $kas_lox=$kas_lo; $lo22="";}      
                    $kas_lo31 = number_format($kas_lox,"2",",",".");
                    
                $akhir_kas_blud = $kenaik_surplus_lo + $kas_lo;
     
                    if ($akhir_kas_blud < 0){
                        $lo111="("; $akhir_kas_bludx=$akhir_kas_blud*-1; $lo222=")";}
                    else {
                        $lo111=""; $akhir_kas_bludx=$akhir_kas_blud; $lo222="";}        
                    $akhir_kas_blud31 = number_format($akhir_kas_bludx,"2",",",".");


     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>LAPORAN ARUS KAS </strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td> 
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border:none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                        
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>
                        ";

        $sqlmaplo="SELECT seq, nor, uraian, bold, isnull(kode_1,'-') as kode_1, isnull(kode_2,'-') as kode_2, isnull(kode_3,'-') as kode_3, isnull(kode_4,'-') as kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lak_blud_sap
                   GROUP BY seq, nor, uraian, bold, isnull(kode_1,'-') , isnull(kode_2,'-'), isnull(kode_3,'-'), isnull(kode_4,'-'), isnull(cetak,'debet-debet') ORDER BY seq";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    
                    $nama      = $loquery->uraian;   
                    $n         = $loquery->kode_1;
                    $n         = ($n=="-"?"'-'":$n);
                    $n1         = $loquery->kode_2;
                    $n1        = ($n1=="-"?"'-'":$n1);
                    $n2         = $loquery->kode_3;
                    $n2        = ($n2=="-"?"'-'":$n2);
                    $n3         = $loquery->kode_4;
                    $n3        = ($n3=="-"?"'-'":$n3);
                    $normal    = $loquery->cetak;
                    $bold      = $loquery->bold;
                    
        $quelo01   = "SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and jns<>'1' and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
                    
        $quelo04   = "SELECT sum(thn_blud_m1) as nilai from map_lak_blud_sap ";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                  
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 5:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo7$surplus_lo21$lo8</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo13$surplus_lo31$lo14</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo19$surplus_inv_lo1$lo29</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 9:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo15$surplus_pendn_lo1$lo25</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 10:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$pajak_akhir31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 11:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo144$kenaik_surplus_lo1$lo244</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 12:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo12$kas_lo31$lo22</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 13:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$akhir_kas_blud31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 14:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$trm12$trm_pajak31$trm12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 15:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$trm12$trm_pajak31$trm12</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 16:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$trm12$str_pajak31$trm12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 17:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$trm12$str_pajak31$trm12</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                }
                              
                      
                }

      
        $cRet .= " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LAK BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK BLUD UPTD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }
    

    function cetak_lak_blud_sap($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;  
        //$laporan=$lap; 
       
       // if ($cetak == '1') {
//           $skpd = '';
//           $skpd1 = '';           
//       } else {             
           $skpd = "AND kd_skpd='$id'";
           $skpd1 = "AND b.kd_skpd='$id'"; 
       //}  

       $y123=")";
       $x123="(";       
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd);     
       // INSERT DATA
       
       $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd_blud a INNER JOIN ms_urusan_blud b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                } 
     
// created by henri_tb
            
        $sqllo1="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id'  and left(kd_rek5,7) in ('8330103','4140302','4142001','4141804','4142002','4142003','4141801') and jns='2' ";
       // echo($sqllo1)
                    $querylo1= $this->db->query($sqllo1);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo2="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,7) in ('8330103','4140302','4142001','4141804','4142002','4142003','4141801') and b.kd_skpd='$id' and kd_subkegiatan='95'";
                    $querylo2= $this->db->query($sqllo2);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo3="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and (left(kd_rek5,3) in ('511') or left(kd_rek5,5) in ('51201','51202','51203','51205','51206','51207','51210','51211','51212','51214','51219','51220','51223','51225','51226','51227','51230','51231','51218','51204','51215')) and jns='2' ";
                    $querylo3= $this->db->query($sqllo3);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo4="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and (left(kd_rek5,3) in ('511') or left(kd_rek5,5) in ('51201','51202','51203','51205','51206','51207','51210','51211','51212','51214','51219','51220','51223','51225','51226','51227','51230','51231','51218','51204','51215') )  and kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo4);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo = $pen_lo - $bel_lo;
                    if ($surplus_lo < 0){
                        $lo1="("; $surplus_lox=$surplus_lo*-1; $lo2=")";}
                    else {
                        $lo1=""; $surplus_lox=$surplus_lo; $lo2="";}        
                    $surplus_lo1 = number_format($surplus_lox,"2",",",".");
                    
                    $surplus_lo_lalu = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu < 0){
                        $lo3="("; $surplus_lo_lalux=$surplus_lo_lalu*-1; $lo4=")";}
                    else {
                        $lo3=""; $surplus_lo_lalux=$surplus_lo_lalu; $lo4="";}                      
                    $surplus_lo_lalu1 = number_format($surplus_lo_lalux,"2",",",".");

                    $selisih_surplus_lo = $surplus_lo - $surplus_lo_lalu;
                    if ($selisih_surplus_lo < 0){
                        $lo5="("; $selisih_surplus_lox=$selisih_surplus_lo*-1; $lo6=")";}
                    else {
                        $lo5=""; $selisih_surplus_lox=$selisih_surplus_lo; $lo6="";}
                    $selisih_surplus_lo1 = number_format($selisih_surplus_lox,"2",",",".");
                    
                    if( $surplus_lo_lalu=='' or $surplus_lo_lalu==0){
                    $persen2 = '0,00';
                    }else{
                    $persen2 = ($surplus_lo/$surplus_lo_lalu)*100;
                    $persen2 = number_format($persen2,"2",",",".");
                    }

//created  prof ali
            
        $sqllo11="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id'  and (left(kd_rek5,7) in ('4140101','4140102','4140103','4140104','4140105','4140201') or left(kd_rek5,3) in ('717')) and jns='2'";
                    $querylo1= $this->db->query($sqllo11);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo21="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and (left(kd_rek5,8) in ('4140101','4140102','4140103','4140104','4140105','4140201') or left(kd_rek5,3) in ('717')) and kd_subkegiatan='95'  ";
                    $querylo2= $this->db->query($sqllo21);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo31="SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and left(kd_rek5,3) in ('521','522','523','524','525','526','722','725') and jns='2' ";
                    $querylo3= $this->db->query($sqllo31);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo41="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('521','522','523','524','525','526','722','725') and b.kd_skpd='$id' and kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo41);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_inves = $pen_lo - $bel_lo;
                    if ($surplus_lo_inves < 0){
                        $lo19="("; $surplus_lox_inv=$surplus_lo_inves*-1; $lo29=")";}
                    else {
                        $lo19=""; $surplus_lox_inv=$surplus_lo_inves; $lo29="";}        
                    $surplus_inv_lo1 = number_format($surplus_lox_inv,"2",",",".");
                    
                    $surplus_lo_lalu_inves = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_inves < 0){
                        $lo39="("; $surplus_lo_lalux_inv=$surplus_lo_lalu_inves*-1; $lo49=")";}
                    else {
                        $lo39=""; $surplus_lo_lalux_inv=$surplus_lo_lalu_inves; $lo49="";}                      
                    $surplus_inv_lo_lalu1 = number_format($surplus_lo_lalux_inv,"2",",",".");


//created  prof ali
            
        $sqllo12="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and left(kd_rek5,3) in ('714','716')  and kd_subkegiatan='95'";
                    $querylo1= $this->db->query($sqllo12);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo22="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and left(kd_rek5,3) in ('714','716') and kd_subkegiatan='95' ";
                    $querylo2= $this->db->query($sqllo22);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo32="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,3) in ('723','726') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and kd_subkegiatan='95'  ";
                    $querylo3= $this->db->query($sqllo32);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo42="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('723','726') and b.kd_skpd='$id'  and kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo42);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_pendan = $pen_lo - $bel_lo;
                    if ($surplus_lo_pendan < 0){
                        $lo15="("; $surplus_lox_pendn=$surplus_lo_pendan*-1; $lo25=")";}
                    else {
                        $lo15=""; $surplus_lox_pendn=$surplus_lo_pendan; $lo25="";}     
                    $surplus_pendn_lo1 = number_format($surplus_lox_pendn,"2",",",".");
                    
                    $surplus_lo_lalu_pendan = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_pendan < 0){
                        $lo35="("; $surplus_lo_lalux_pendn=$surplus_lo_lalu_pendan*-1; $lo45=")";}
                    else {
                        $lo35=""; $surplus_lo_lalux_pendn=$surplus_lo_lalu_pendan; $lo45="";}                       
                    $surplus_pendn_lo_lalu1 = number_format($surplus_lo_lalux_pendn,"2",",",".");
    
//created  prof ali
            
        $sqllo14="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and left(kd_rek5,3) in ('211')  and kd_subkegiatan='95'";
                    $querylo1= $this->db->query($sqllo14);
                    $penlo = $querylo1->row();
                    $pen_lo = $penlo->nilai;
                    $pen_lo1= number_format($penlo->nilai,"2",",",".");
        
        $sqllo24="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1  and b.kd_skpd='$id' and left(kd_rek5,3) in ('211') and kd_subkegiatan='95'";
                    $querylo2= $this->db->query($sqllo24);
                    $penlo2 = $querylo2->row();
                    $pen_lo_lalu = $penlo2->nilai;
                    $pen_lo_lalu1= number_format($penlo2->nilai,"2",",",".");
        
        $sqllo34="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,3) in ('211') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and kd_subkegiatan='95'  ";
                    $querylo3= $this->db->query($sqllo34);
                    $bello = $querylo3->row();
                    $bel_lo = $bello->nilai;
                    $bel_lo1= number_format($bello->nilai,"2",",",".");
        
        $sqllo44="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,3) in ('211') and b.kd_skpd='$id' and kd_subkegiatan='95' ";
                    $querylo4= $this->db->query($sqllo44);
                    $bello2 = $querylo4->row();
                    $bel_lo_lalu = $bello2->nilai;
                    $bel_lo_lalu1= number_format($bello2->nilai,"2",",",".");       

                    $surplus_lo_transit = $pen_lo - $bel_lo;
                    if ($surplus_lo_transit < 0){
                        $lo18="("; $surplus_lox_tran=$surplus_lo_transit*-1; $lo28=")";}
                    else {
                        $lo18=""; $surplus_lox_tran=$surplus_lo_transit; $lo28="";}     
                    $surplus_tran_lo1 = number_format($surplus_lox_tran,"2",",",".");
                    
                    $surplus_lo_lalu_transit = $pen_lo_lalu - $bel_lo_lalu;
                    if ($surplus_lo_lalu_transit < 0){
                        $lo38="("; $surplus_lo_lalux_tran=$surplus_lo_lalu_transit*-1; $lo48=")";}
                    else {
                        $lo38=""; $surplus_lo_lalux_tran=$surplus_lo_lalu_transit; $lo48="";}                       
                    $surplus_tran_lo_lalu1 = number_format($surplus_lo_lalux_tran,"2",",",".");

//prof ali                  
//pajak  
     
        
        $sqllo101="
        select sum(x.nilai) nilai from (
        select sum(b.nilai) as nilai from trhtrmpot_blud a inner join trdtrmpot_blud b on a.kd_skpd=b.kd_skpd and a.no_bukti=b.no_bukti where a.kd_skpd='$id' and year(tgl_bukti)=$thn_ang
                            ) x         ";
                    $querylo12= $this->db->query($sqllo101);
                    $bello10 = $querylo12->row();
                    $trm_pajak = $bello10->nilai;
                    
                    if ($trm_pajak < 0){
                        $trm12="("; $trm_pajakx=$trm_pajak*-1; $trm22=")";}
                    else {
                        $trm12=""; $trm_pajakx=$trm_pajak; $trm22="";}      
                    $trm_pajak31 = number_format($trm_pajakx,"2",",",".");
                    
        
        $sqllo101="select sum(x.nilai) nilai from (
        select sum(b.nilai) as nilai from trhstrpot_blud a inner join trdstrpot_blud b on a.kd_skpd=b.kd_skpd and a.no_bukti=b.no_bukti where a.kd_skpd='$id' and year(tgl_bukti)=$thn_ang
        ) x ";
                    $querylo12= $this->db->query($sqllo101);
                    $bello10 = $querylo12->row();
                    $str_pajak = $bello10->nilai;
                    
                    if ($str_pajak < 0){
                        $str12="("; $str_pajakx=$str_pajak*-1; $str22=")";}
                    else {
                        $str12=""; $str_pajakx=$str_pajak; $str22="";}      
                    $str_pajak31 = number_format($str_pajakx,"2",",",".");                    
     

//Transfer masuk                    

                    
        
        $sqllo103="select isnull(sum(b.debet),0) nilai from trhju_sap_blud a inner join trdju_sap_blud b on a.kd_skpd=b.kd_unit and a.no_voucher=b.no_voucher where a.kd_skpd='$id' and a.tabel='1' and a.map_real='99' and year(a.tgl_voucher)='$thn_ang'  and kd_subkegiatan='95'";
                    $querylo12= $this->db->query($sqllo103);
                    $bello10 = $querylo12->row();
                    $in_trf = $bello10->nilai;
                    
                    if ($in_trf < 0){
                        $in14="("; $in_trfx=$in_trf*-1; $in23=")";}
                    else {
                        $in14=""; $in_trfx=$in_trf; $in23="";}      
                    $in_trf31 = number_format($in_trfx,"2",",",".");                    
     
     
        $sqllo104="select isnull(sum(b.kredit),0) nilai from trhju_sap_blud a inner join trdju_sap_blud b on a.kd_skpd=b.kd_unit and a.no_voucher=b.no_voucher where a.kd_skpd='$id' and a.tabel='1' and a.map_real='98' and year(a.tgl_voucher)='$thn_ang'  and kd_subkegiatan='95'";
                    $querylo15= $this->db->query($sqllo104);
                    $bello10 = $querylo15->row();
                    $out_trf = $bello10->nilai;
                    
                    if ($out_trf < 0){
                        $out14="("; $out_trfx=$out_trf*-1; $out23=")";}
                    else {
                        $out14=""; $out_trfx=$out_trf; $out23="";}      
                    $out_trf31 = number_format($out_trfx,"2",",",".");   
     
                $trf    = $in_trf - $out_trf;
     
                 
                
                $in_pajak_akhir = ($trm_pajak+$in_trf) ;
     
                    if ($in_pajak_akhir < 0){
                        $lo111="("; $in_pajak_akhirx=$in_pajak_akhir*-1; $lo222=")";}
                    else {
                        $lo111=""; $in_pajak_akhirx=$in_pajak_akhir; $lo222="";}        
                    $in_pajak_akhir31 = number_format($in_pajak_akhirx,"2",",",".");     
                
                $out_pajak_akhir    = ($str_pajak+$out_trf) ;
     
                    if ($out_pajak_akhir < 0){
                        $lo111="("; $out_pajak_akhirx=$out_pajak_akhir*-1; $lo222=")";}
                    else {
                        $lo111=""; $out_pajak_akhirx=$out_pajak_akhir; $lo222="";}      
                    $out_pajak_akhir31 = number_format($out_pajak_akhirx,"2",",",".");  
                
                $pajak_akhir    = ($trm_pajak+$in_trf) - ($str_pajak+$out_trf);
     
                    if ($pajak_akhir < 0){
                        $lo111="("; $pajak_akhirx=$pajak_akhir*-1; $lo222=")";}
                    else {
                        $lo111=""; $pajak_akhirx=$pajak_akhir; $lo222="";}      
                    $pajak_akhir31 = number_format($pajak_akhirx,"2",",",".");  
    
//created  prof ali
                    $kenaik_surplus_lo =  $surplus_lo + $surplus_lo_pendan + $surplus_lo_inves + $surplus_lo_transit + $pajak_akhir;
                         
                    if ($kenaik_surplus_lo < 0){
                        $lo144="("; $kenaik_surplus_lox=$kenaik_surplus_lo*-1; $lo244=")";}
                    else {
                        $lo144=""; $kenaik_surplus_lox=$kenaik_surplus_lo; $lo244="";}      
                    $kenaik_surplus_lo1 = number_format($kenaik_surplus_lox,"2",",",".");
                        
        $kenaik_surplus_lo_lalu =  $surplus_lo_lalu + $surplus_lo_lalu_inves + $surplus_lo_lalu_pendan + $surplus_lo_lalu_transit;
                    
                    if ($kenaik_surplus_lo_lalu < 0){
                        $lo34="("; $kenaik_surplus_lo_lalux=$kenaik_surplus_lo_lalu*-1; $lo44=")";}
                    else {
                        $lo34=""; $kenaik_surplus_lo_lalux=$kenaik_surplus_lo_lalu; $lo44="";}      
                    $kenaik_surplus_lo_lalu1 = number_format($kenaik_surplus_lo_lalux,"2",",",".");
                    
                    
        $sqllo5="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('84') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1' and kd_subkegiatan='95' ";
                    $querylo5= $this->db->query($sqllo5);
                    $penlo3 = $querylo5->row();
                    $pen_lo3 = $penlo3->nilai;
                    $pen_lo31= number_format($penlo3->nilai,"2",",",".");
        
        $sqllo6="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('84') and b.kd_skpd='$id'  and kd_subkegiatan='95' ";
                    $querylo6= $this->db->query($sqllo6);
                    $penlo4 = $querylo6->row();
                    $pen_lo_lalu4 = $penlo4->nilai;
                    $pen_lo_lalu41= number_format($penlo4->nilai,"2",",",".");
        
        $sqllo7="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,2) in ('93') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1'  and kd_subkegiatan='95' ";
                    $querylo7= $this->db->query($sqllo7);
                    $bello5 = $querylo7->row();
                    $bel_lo5 = $bello5->nilai;
                    $bel_lo51= number_format($bello5->nilai,"2",",",".");
        
        $sqllo8="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,2) in ('93') and b.kd_skpd='$id'  and kd_subkegiatan='95'";
                    $querylo8= $this->db->query($sqllo8);
                    $bello6 = $querylo8->row();
                    $bel_lo_lalu6 = $bello6->nilai;
                    $bel_lo_lalu61= number_format($bello6->nilai,"2",",",".");      

                    $surplus_lo2 = $pen_lo3 - $bel_lo5;
                    if ($surplus_lo2 < 0){
                        $lo7="("; $surplus_lo2x=$surplus_lo2*-1; $lo8=")";}
                    else {
                        $lo7=""; $surplus_lo2x=$surplus_lo2; $lo8="";}      
                    $surplus_lo21 = number_format($surplus_lo2x,"2",",",".");
                    
                    $surplus_lo_lalu2 = $pen_lo_lalu4 - $bel_lo_lalu6;
                    if ($surplus_lo_lalu2 < 0){
                        $lo9="("; $surplus_lo_lalu2x=$surplus_lo_lalu2*-1; $lo10=")";}
                    else {
                        $lo9=""; $surplus_lo_lalu2x=$surplus_lo_lalu2; $lo10="";}                       
                    $surplus_lo_lalu21 = number_format($surplus_lo_lalu2x,"2",",",".");

        
        $sqllo9="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('8') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1'  and kd_subkegiatan='95'";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select sum(kredit-debet) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id'  and kd_subkegiatan='95'";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(kd_rek5,1) in ('9') and month(b.tgl_voucher)<=$cbulan and b.kd_skpd='$id' and b.tabel<>'1'   and kd_subkegiatan='95'";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id'   and kd_subkegiatan='95'";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3x=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $surplus_lo3x=$surplus_lo3; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3x,"2",",",".");
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3x=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $surplus_lo_lalu3x=$surplus_lo_lalu3; $lo16="";}                      
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3x,"2",",",".");

//prof ali                  
     
     
        
        $sqllo100="select sum(debet-kredit) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where tgl_voucher<='$thn_ang-01-01' and left(kd_rek5,3) in ('111') and b.kd_skpd='$id' and b.tabel='1'   and kd_subkegiatan='95'";
                    $querylo12= $this->db->query($sqllo100);
                    $bello10 = $querylo12->row();
                    $kas_lo = $bello10->nilai;
                    
                    if ($kas_lo < 0){
                        $lo12="("; $kas_lox=$kas_lo*-1; $lo22=")";}
                    else {
                        $lo12=""; $kas_lox=$kas_lo; $lo22="";}      
                    $kas_lo31 = number_format($kas_lox,"2",",",".");
                    
                $akhir_kas_blud = $kenaik_surplus_lo + $kas_lo;
     
                    if ($akhir_kas_blud < 0){
                        $lo111="("; $akhir_kas_bludx=$akhir_kas_blud*-1; $lo222=")";}
                    else {
                        $lo111=""; $akhir_kas_bludx=$akhir_kas_blud; $lo222="";}        
                    $akhir_kas_blud31 = number_format($akhir_kas_bludx,"2",",",".");


     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>LAPORAN ARUS KAS </strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp;</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td> 
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"5\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>$thn_ang_1</b></td>
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border:none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"5\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                        
                         </tr>
                     </tfoot>
                   
                     <tr>
                            <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"5\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>
                        ";

        $sqlmaplo="SELECT seq, nor, uraian, bold, isnull(kode_1,'-') as kode_1, isnull(kode_2,'-') as kode_2, isnull(kode_3,'-') as kode_3, isnull(kode_4,'-') as kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lak_blud_sap
                   GROUP BY seq, nor, uraian, bold, isnull(kode_1,'-') , isnull(kode_2,'-'), isnull(kode_3,'-'), isnull(kode_4,'-'), isnull(cetak,'debet-debet') ORDER BY seq";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    
                    $nama      = $loquery->uraian;   
                    $n         = $loquery->kode_1;
                    $n         = ($n=="-"?"'-'":$n);
                    $n1         = $loquery->kode_2;
                    $n1        = ($n1=="-"?"'-'":$n1);
                    $n2         = $loquery->kode_3;
                    $n2        = ($n2=="-"?"'-'":$n2);
                    $n3         = $loquery->kode_4;
                    $n3        = ($n3=="-"?"'-'":$n3);
                    $normal    = $loquery->cetak;
                    $bold      = $loquery->bold;
                    
        $quelo01   = "SELECT SUM(real_spj) as nilai FROM data_realisasi_pemkot WHERE  kd_skpd='$id' and (left(kd_rek5,3) in ($n) or left(kd_rek5,5) in ($n1) or left(kd_rek5,7) in ($n2) or left(kd_rek5,7) in ($n3)) and jns='2'";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai;
                    $nilai    = number_format($quelo03->nilai,"2",",",".");
        
        if($id=="1.02.01.01"){
            $kolom = "a1_02_01_01_b";
        }else if($id=="1.02.01.21"){
            $kolom = "a1_02_01_21_b";
        }else if($id=="1.02.01.22"){
            $kolom = "a1_02_01_22_b";
        }else if($id=="1.02.01.23"){
            $kolom = "a1_02_01_23_b";
        }else if($id=="1.02.01.24"){
            $kolom = "a1_02_01_24_b";
        }else if($id=="1.02.01.25"){
            $kolom = "a1_02_01_25_b";
        }else if($id=="1.02.01.26"){
            $kolom = "a1_02_01_26_b";
        }else{
            $kolom = "SELECT sum(thn_blud_m1) as nilai from map_lak_blud_sap";
        }
        
        $quelo04   = "SELECT sum($kolom) as nilai from map_lak_blud_sap where nor=".$loquery->nor."";
        echo "$quelo04";
                    $quelo05 = $this->db->query($quelo04);
                    $quelo06 = $quelo05->row();
                    $nil_lalu     = $quelo06->nilai;
                    $nilai_lalu    = number_format($quelo06->nilai,"2",",",".");
                    
                    $real_nilai = $nil - $nil_lalu;
                    if ($real_nilai < 0){
                        $lo0="("; $real_nilaix=$real_nilai*-1; $lo00=")";}
                    else {
                        $lo0=""; $real_nilaix=$real_nilai; $lo00="";}
                    $real_nilai1 = number_format($real_nilaix,"2",",",".");
                    
                    if( $nil_lalu=='' or $nil_lalu==0){
                    $persen1 = '0,00';
                    }else{
                    $persen1 = ($nil/$nil_lalu)*100;
                    $persen1 = number_format($persen1,"2",",",".");
                    }
                    $no       = $no + 1;
                  
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 5:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$surplus_lo1$lo2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo7$surplus_lo21$lo8</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo13$surplus_lo31$lo14</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo19$surplus_inv_lo1$lo29</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 9:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo15$surplus_pendn_lo1$lo25</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 10:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$pajak_akhir31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 11:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo144$kenaik_surplus_lo1$lo244</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 12:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo12$kas_lo31$lo22</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 13:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$akhir_kas_blud31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 14:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$trm12$trm_pajak31$trm12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 15:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$in_pajak_akhir31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 16:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$trm12$str_pajak31$trm12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 17:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo111$out_pajak_akhir31$lo222</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$nilai_lalu</b></td>
                                 </tr>";
                        break;
                    case 18:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$in14$in_trf31$in23</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                    case 19:
                         $cRet    .= "<tr>
                                     <td width=\"8%\" align=\"center\" style=\"border:none;\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"3%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$out14$out_trf31$out23</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_lalu</td>
                                 </tr>";
                        break;
                }
                              
                      
                }

      
        $cRet .= " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LAK APBD & BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LAK BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LAK BLUD UPTD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
                 
    }
    

    
 
    
function cetak_lak_blud_apbd_sap_lama($bln='',$pilih=''){ 
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $id     = $this->session->userdata('kdskpd');
        $idx = str_replace('.','_',$this->session->userdata('kdskpd'));
        $thn_ini = $this->session->userdata('pcThang');
        $thn_lalu= $thn_ini-1;
        $sql="SELECT TOP 1 nm_skpd from ms_skpd_blud where kd_skpd='$id'";
        $exe=$this->db->query($sql)->row();
        $opd=$exe->nm_skpd;
        $oke="a$idx";
        $bulan=$this->bulanx($bln);

    $ctk="<table width='100%' style='border-collapse:collapse' border='0' cellspacing='0px' cellpadding='0px'>
         
            <tr style='text-align: center'>               
                <td style='padding:15px; text-align: center;'><strong>PEMERINTAH KOTA PONTIANAK<br>BADAN LAYANAN UMUM $opd <br>LAPORAN ARUS KAS <br> UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $bulan $thn_ini DAN $thn_lalu </td>
                
            </tr>
            </table>";

     $ctk.="<table width='100%' style='border-collapse:collapse' border='1' cellspacing='0px' cellpadding='0px'>
         
            <tr bgcolor='#CCCCCC' style='text-align: center'>               
                <td width='5%' style='padding:15px; text-align: center'><strong>NO</td>
                <td width='55%' style='text-align: center'><strong>URAIAN</td>
                <td width='20%' style='text-align: center'><strong>$thn_ini</td>
                <td width='20%' style='text-align: center'><strong>$thn_lalu</td>
            </tr>
          ";
        $sqlmaplo="SELECT $oke lalu, seq, nor, uraian, bold, isnull(kode_1,0) kode_1 , kode_2 , kode_3 , kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lak_blud_sap
                   GROUP BY seq, nor, uraian, bold, kode_1 , kode_2 , kode_3 , kode_4, isnull(cetak,'debet-debet'),$oke ORDER BY seq";
      
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 1;                                  
                $arsmsuk=0; $arskeluar=0; $total1=0;
                $arsmsuk2=0; $arskeluar2=0; $total12=0;
                $arsmsuk3=0; $arskeluar3=0; $total13=0; $total14=0;
                foreach ($querymaplo->result() as $a)
                {     

                    $nama      = $a->uraian;   
                    $n1        = $a->kode_1;
                    $n2        = $a->kode_2;
                    $n3        = $a->kode_3;
                    $n4        = $a->kode_4;
                    $normal    = $a->cetak;
                    $bold      = $a->bold;
                    $lalu      = number_format($a->lalu,"2",",",".");
                    $seq       = $a->seq;


                    $quelo01   = "SELECT sum(nilai_real) nilai_real from lak_blud($bln,$thn_ini) where ((left(kd_rek5,3) in ($n1))  or (left(kd_rek5,5) in ($n2)) or (kd_rek5 in ($n3)) or (kd_rek5 in ($n4)))  and kd_skpd='$id' ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai_real;
                    $nilai    = number_format($quelo03->nilai_real,"2",",",".");

                    switch ($bold) {
                        case 0:
                            $spasi="<b>";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;                        
                        case 1:
                            $spasi="<b>";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;
                        case 2:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;
                        case 3:
                            $spasi="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>
                            ";
                            break;
                        case 39:

                                $spasi="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";                                
    

                            break;
                        case 4:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";                 
                        case 23:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk=$nil;
                            break;
                        case 24:
                            $arskeluar=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 7: /* Arus Kas Bersih dari Aktivitas Operasi*/
                            $total1=$arsmsuk - $arskeluar;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>".number_format($total1,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break; 
                        case 91:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk2=$nil;
                            break;
                        case 92:
                            $arskeluar2=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 93:   /* Arus Kas Bersih dari Aktivitas Investasi*/
                            $total12=$arsmsuk2 - $arskeluar2;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($total12,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;                              
                        case 74:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk3=$nil;
                            break;
                        case 75:
                            $arskeluar3=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 76:
                            $total13=$arsmsuk3 - $arskeluar3;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($total13,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 99:
                            $total14=number_format($total1+$total12+$total13,"2",",",".");
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> $total14</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 67:
                            $sql="select $oke halu from map_lak_blud_sap where nor='75'";
                            $exe=$this->db->query($sql)->row();
                            $sxe=$exe->halu;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($sxe,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 45:
                            $tot75=
                            $tot75=$sxe+$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($tot75,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;                            
                    }

            $ctk.=" <tr>
                <td width='5%' style='text-align:center'; padding:10px>$no </td>
                <td width='55%'>$spasi $nama </td>
                $tbl
            </tr>";
            $no++;
                }
            $ctk.="</table>";

     $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $ctk .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        switch($pilih) {       
        case 1;
            echo ("<title>LAK APBD & BLUD UPTD $bulan</title>");
             echo $ctk;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            echo $ctk;

        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= LAK.doc");
            echo $ctk;
        break;
         case 0;
              $this->tukd_model->_mpdf('',$ctk,10,10,10,'0');
         break;
        } 
        
   
   
  /* $this->tukd_model->_mpdf('',$ctk,10,10,10,'0');*/
}
    

    
function cetak_lak_blud_apbd_sap($bln='',$pilih=''){ 
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $id     = $this->session->userdata('kdskpd');
        $idx = str_replace('.','_',$this->session->userdata('kdskpd'));
        $thn_ini = $this->session->userdata('pcThang');
        $thn_lalu= $thn_ini-1;
        $sql="SELECT TOP 1 nm_skpd from ms_skpd_blud where kd_skpd='$id'";
        $exe=$this->db->query($sql)->row();
        $opd=$exe->nm_skpd;
        $oke="a$idx";
        $bulan=$this->bulanx($bln);

    $ctk="<table width='100%' style='border-collapse:collapse' border='0' cellspacing='0px' cellpadding='0px'>
         
            <tr style='text-align: center'>               
                <td style='padding:15px; text-align: center;'><strong>PEMERINTAH KOTA PONTIANAK<br>BADAN LAYANAN UMUM $opd <br>LAPORAN ARUS KAS <br> UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $bulan $thn_ini DAN $thn_lalu </td>
                
            </tr>
            </table>";

     $ctk.="<table width='100%' style='border-collapse:collapse' border='1' cellspacing='0px' cellpadding='0px'>
         
            <tr bgcolor='#CCCCCC' style='text-align: center'>               
                <td width='5%' style='padding:15px; text-align: center'><strong>NO</td>
                <td width='55%' style='text-align: center'><strong>URAIAN</td>
                <td width='20%' style='text-align: center'><strong>$thn_ini</td>
                <td width='20%' style='text-align: center'><strong>$thn_lalu</td>
            </tr>
          ";
        $sqlmaplo="SELECT $oke lalu, seq, nor, uraian, bold, isnull(kode_1,0) kode_1 , kode_2 , kode_3 , kode_4, isnull(cetak,'debet-debet') as cetak FROM map_lak_blud_sap
                   GROUP BY seq, nor, uraian, bold, kode_1 , kode_2 , kode_3 , kode_4, isnull(cetak,'debet-debet'),$oke ORDER BY seq";
      
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 1;                                  
                $arsmsuk=0; $arskeluar=0; $total1=0;
                $arsmsuk2=0; $arskeluar2=0; $total12=0;
                $arsmsuk3=0; $arskeluar3=0; $total13=0; $total14=0;
                foreach ($querymaplo->result() as $a)
                {     

                    $nama      = $a->uraian;   
                    $n1        = $a->kode_1;
                    $n2        = $a->kode_2;
                    $n3        = $a->kode_3;
                    $n4        = $a->kode_4;
                    $normal    = $a->cetak;
                    $bold      = $a->bold;
                    $lalu      = number_format($a->lalu,"2",",",".");
                    $seq       = $a->seq;


                    $quelo01   = "SELECT sum(nilai_real) nilai_real from lak_blud($bln,$thn_ini) where ((left(kd_rek5,3) in ($n1))  or (left(kd_rek5,5) in ($n2)) or (kd_rek5 in ($n3)) or (kd_rek5 in ($n4)))  and kd_skpd='$id' ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nil     = $quelo03->nilai_real;
                    $nilai    = number_format($quelo03->nilai_real,"2",",",".");

                    switch ($bold) {
                        case 0:
                            $spasi="<b>";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;                        
                        case 1:
                            $spasi="<b>";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;
                        case 2:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> </td>
                                  <td width='20%' style='text-align:right'> </td>
                            ";                            
                            break;
                        case 3:
                            if($seq=='312' && $id=='1.02.01.01'){
                                $arma=0;
                                $spasi="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> ".$this->minim($arma)."</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";
                            } else{
                                $spasi="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";                                
                            }

                            break;
                        case 4:
                          if(($seq=='315' || $seq='345') && $id=='1.02.01.01'){
                                $arma1=0+$nil;
                                $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> ".$this->minim($arma1)."</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";
                            } else{
                                $arma1=0;
                                $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";                                
                            }

                            break;
                        case 41:
                                $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                                $tbl="<td width='20%' style='text-align:right'> $nilai</td>
                                      <td width='20%' style='text-align:right'> $lalu</td>
                                ";      
                            break;               
                        case 23: /*No 8. Seq 40. Jumlah Arus Masuk Kas*/
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk=$nil;
                            break;
                        case 24: /*No 19. Seq 95. Jumlah Arus Keluar Kas*/
                            $arskeluar=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 7: /*No 21. Seq 105. Arus Kas Bersih dari Aktivitas Operasi*/
                            $total1=$arsmsuk - $arskeluar;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>".number_format($total1,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break; 
                        case 91: /*No 32 Seq 160. Jumlah Arus Masuk Kas */
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk2=$nil;
                            break;
                        case 92: /*No 42 Seq 210. Jumlah Arus Keluar Kas */
                            $arskeluar2=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 93:   /* 44 220 Arus Kas Bersih dari Aktivitas Investasi*/
                            $total12=$arsmsuk2 - $arskeluar2;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($total12,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;                              
                        case 74:
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            $arsmsuk3=$nil;
                            break;
                        case 75: /*No 50. Seq. 250 Jumlah Arus Keluar Kas */
                            $arskeluar3=$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'>$nilai</td>
                                  <td width='20%' style='text-align:right'>$lalu</td>";
                            break;
                        case 76: /*58 290 Arus Kas Bersih dari Aktivitas Pendanaan */
                            $total13=$arsmsuk3 - $arskeluar3;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($total13,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 99: /*73 355 Kenaikan / Penurunan Kas BLUD*/
                            $total14=number_format($total1+$total12+$total13+$arma1,"2",",",".");
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> $total14</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 67: /*74 360 Saldo Awal Kas Setara Kas BLUD*/
                            $sql="select $oke halu from map_lak_blud_sap where nor='75'";
                            $exe=$this->db->query($sql)->row();
                            $sxe=$exe->halu;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($sxe,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;
                        case 45: /*75 365 Saldo Akhir Kas Setara Kas BLUD*/
                            $tot75=
                            $tot75=$sxe+$nil;
                            $spasi="<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                            $tbl="<td width='20%' style='text-align:right'> ".number_format($tot75,"2",",",".")."</td>
                                  <td width='20%' style='text-align:right'> $lalu</td>";
                            break;                            
                    }

            $ctk.=" <tr>
                <td width='5%' style='text-align:center'; padding:10px>$no </td>
                <td width='55%'>$spasi $nama </td>
                $tbl
            </tr>";
            $no++;
                }
            $ctk.="</table>";

     $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $ctk .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        switch($pilih) {       
        case 1;
            echo ("<title>LAK APBD & BLUD UPTD $bulan</title>");
             echo $ctk;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            echo $ctk;

        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= LAK.doc");
            echo $ctk;
        break;
         case 0;
              $this->tukd_model->_mpdf('',$ctk,10,10,10,'0');
         break;
        } 
        
   
   
  /* $this->tukd_model->_mpdf('',$ctk,10,10,10,'0');*/
}
 
  function cetak_lra_blud_sap($cbulan="", $pilih=1){ 
    $id  = $this->session->userdata('kdskpd');
    $thn = $this->session->userdata('pcThang');
    $sqlanggaran1="select case when statu=1 and status_ubah=1 and $cbulan>=month(tgl_dpa_ubah) then '2' 
                       when statu=1 and status_ubah=1 and  $cbulan<month(tgl_dpa_ubah) then '1'
                       when statu=1 and status_ubah=0 and $cbulan>=month(tgl_dpa) then '1'
                       else '1' end as anggaran from trhrka_blud where kd_skpd='$id'";
    
    $sqlanggaran=$this->db->query($sqlanggaran1);
    foreach ($sqlanggaran->result() as $rowttd)
        {
            $anggaran=$rowttd->anggaran;
        }

    $ag_tox=$anggaran;
        
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $apbd = $this->uri->segment(7);
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        
        $sqlttd1="SELECT nama as nm, nip as nip, jabatan as jab, pangkat FROM ms_ttd_blud where nip='$ttd1' AND kode ='PA' and left(kd_skpd,7) = left('$id',7)";
         $sqlttd=$this->db->query($sqlttd1);
         foreach ($sqlttd->result() as $rowttd)
        {
            $nip=$rowttd->nip;                    
            $namax= $rowttd->nm;
            $jabatan  = $rowttd->jab;
            $pangkat  = $rowttd->pangkat;
        }
        

    //function cetak_lra(){ created by henri si bre
    
       $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id' ";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $nmskpd  = $rowsc->nm_skpd;
                } 
        
        $nm_skpd    = strtoupper ($nmskpd);
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
     $modtahun= $thn%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>                         
                    </tr>               
                    <tr>
                         <td align=\"center\"><strong>LAPORAN REALISASI ANGGARAN</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\">&nbsp;</td>
                    </tr>
                  </table>";        
        
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                      
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>ANGGARAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>REALISASI</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>LEBIH</br>(KURANG)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" ><b>%</b></td>   
                        </tr>
      
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                        </tr>";
 
                if($apbd=="blud"){
                    $exe="lra_blud";
                    $map="map_lra_blud";
                    $nil_lra_blud=0;
                } else {
                    $exe="lra_blud_apbd";
                    $map="map_lra_blud_apbd";
                    $nil_lra_blud_apbd=0;
                }          
               
                $sql4="SELECT nor, uraian, cetak,   bold, kode_1, kode_2, kode_3, kode_4, kode_5, thn_m1 FROM $map ORDER BY seq";
                // echo $sql4; die;
                $query4 = $this->db->query($sql4);
                $no     = 0;  
                $tot=0;                                
                $oke=1;
                foreach ($query4->result() as $row4)
                {
                    
                    $nor       = $row4->nor;   
                    $nama      = $row4->uraian;     
                    $bold      = $row4->bold;
                    $real_lalu = number_format($row4->thn_m1,"2",",",".");
                    $cetak     = $row4->cetak;
                    $n         = $row4->kode_1;
                    $n2        = str_replace("'","",$row4->kode_2);
                    // echo $n2; die;
                    $n3        = $row4->kode_3;
                    $n4        = $row4->kode_4;
                    $n5        = $row4->kode_5; 

                    //anggaran//realisasi//bersatu
                    $sql5   = " SELECT SUM(b.nilai_ang) as anggaran, SUM(b.nilai_real) as nilai FROM $exe($cbulan,$ag_tox,$thn) b WHERE kd_skpd='$id' and ((left(b.kd_rek5,7) in ($n) or left(kd_rek5,5) in ($n2)) or left(kd_rek5,3) in ($n3)) ";
                     
                    $query5 = $this->db->query($sql5); 
                    if(!$query5){
                        continue;
                    }
                    $trh    = $query5->row();
                    $nil    = $trh->nilai;
                    $angnil = $trh->anggaran;


                
                    $oke++;
                    if ($angnil < 0){
                        $x11="("; $angnilx=$angnil*-1; $y11=")";}
                    else {
                        $x11=""; $angnilx=$angnil; $y11="";}
                    
                    if ($nil < 0){
                        $x12="("; $nilx=$nil*-1; $y12=")";}
                    else {
                        $x12=""; $nilx=$nil; $y12="";}
                    
                    $real_s = $angnil - $nil;
                    if ($real_s < 0){
                        $x1="("; $real_sx=$real_s*-1; $y1=")";}
                    else {
                        $x1=""; $real_sx=$real_s; $y1="";}
                    $selisih = number_format($real_sx,"2",",",".");
                    if ($nil==0){
                        $tmp=1;
                    }else{
                        $tmp=$nil;
                    }

                    $nilai    = number_format($nilx,"2",",",".");
                    $angnilai = number_format($angnilx,"2",",",".");
                    $per1     = ($angnil!=0)?($nil / $angnil) * 100:0; 
                    $persen1  = number_format($per1,"2",",",".");
                    $no       = $no + 1;

                    switch ($row4->bold) {
                        case 0:
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\"></td>
                                    </tr>";
                            break;
                        case 1:
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\"><b>$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\"></td>
                                    </tr>";
                            break;

                        case 2:
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\"><i>$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\"></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\"></td>
                                    </tr>";
                            break;

                        case 4:
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\"><b>&nbsp;&nbsp;&nbsp;$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\">$persen1</td>
                                    </tr>";
                            break;

                        case 41:                     
                                $nil_p    = $trh->nilai;
                                $angnil_p = $trh->anggaran;

                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\"><b>&nbsp;&nbsp;&nbsp;$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\">$persen1</td>
                                    </tr>";
                            break;
                        case 3:
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\">$persen1</td>
                                    </tr>";

                        break;
                        case 6: /*jumlah belanja*/
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\">$persen1</td>
                                    </tr>";

                        break;
                        case 7: /*surplus*/
                                $sur=0; $surl=0;
                                $surl= $nil_p-$nil;
                                $sur= $angnil_p-$angnil;
                                $surx=$sur-$surl;  
                            $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black; text-align='right'; border-left: none;border-right: none;\" width=\"40%\"><b>$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">".$this->minim($sur)."</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\">".$this->minim($surl)."</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"15%\" align=\"right\">".$this->minim($surx)."</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;\" width=\"10%\" align=\"right\">".$this->persen($sur,$surl)."</td>
                                    </tr>";

                        break;
                
                    }
                
                }


         $cRet .=       " </table>";
        $data['prev']= $cRet;
         $cRet         .= "</table>";
         
         
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $namax </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        $data['prev'] = $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LRA $apbd $id / $cbulan");
        $this->template->set('title', 'LRA $apbd $id / $cbulan');        
        switch($pilih) {  
        case 0;
           $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
  /*           $this->load->model('wprint');
             $this->wprint->PopUp($cRet);*/
        case 1;
             echo ("<title>LRA $apbd $cbulan</title>");
             echo $cRet;
        break;
        case 2;        

            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            echo $cRet;
            
;
        break;
        case 3;     
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            echo $cRet;
        break;
        } 
    }    
     function cetak_lra_blud_sap_konsol($cbulan="", $pilih=1){
    $id  = $this->session->userdata('kdskpd');
    $thn = $this->session->userdata('pcThang');
    $sqlanggaran1="select case when statu=1 and status_ubah=1 and $cbulan>=month(tgl_dpa_ubah) then '2' 
                       when statu=1 and status_ubah=1 and  $cbulan<month(tgl_dpa_ubah) then '1'
                       when statu=1 and status_ubah=0 and $cbulan>=month(tgl_dpa) then '1'
                       else '1' end as anggaran from trhrka_blud where kd_skpd='$id'";
    
    $sqlanggaran=$this->db->query($sqlanggaran1);
    foreach ($sqlanggaran->result() as $rowttd)
        {
            $anggaran=$rowttd->anggaran;
        }

    $ag_tox=$anggaran;
        
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $$ag_tox = $this->uri->segment(7);
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        
        $sqlttd1="SELECT nama as nm, nip as nip, jabatan as jab, pangkat FROM ms_ttd_blud where nip='$ttd1'  and left(kd_skpd,7) = left('$id',7)";


         $sqlttd=$this->db->query($sqlttd1);
         foreach ($sqlttd->result() as $rowttd)
        {
            $nip=$rowttd->nip;                    
            $namax= $rowttd->nm;
            $jabatan  = $rowttd->jab;
            $pangkat  = $rowttd->pangkat;
        }
        

    //function cetak_lra(){ created by henri si bre
    
       $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id' ";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $nmskpd  = $rowsc->nm_skpd;
                } 
        
        $nm_skpd    = strtoupper ($nmskpd);
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
     $modtahun= $thn%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>                         
                    </tr>               
                    <tr>
                         <td align=\"center\"><strong>LAPORAN REALISASI ANGGARAN</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\">&nbsp;</td>
                    </tr>
                  </table>";        
        
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"7\"bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>ANGGARAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>REALISASI</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>LEBIH</br>(KURANG)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"7\"style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"7\"style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                        </tr>";
 
                              
               
                $sql4="SELECT nor, uraian, cetak,   bold, kode_1, kode_2, kode_3, kode_4, kode_5, thn_m1 FROM map_lra_blud_copy ORDER BY seq";
                $query4 = $this->db->query($sql4);
                $no     = 0;  
                $tot=0;                                
                $oke=1;
                foreach ($query4->result() as $row4)
                {
                    
                    $nor       = $row4->nor;   
                    $nama      = $row4->uraian;
               
                    $bold      = $row4->bold;
                    $real_lalu = number_format($row4->thn_m1,"2",",",".");
                    $cetak     = $row4->cetak;
                    $n         = $row4->kode_1;
                    $n2        = $row4->kode_2;
                    $n3        = $row4->kode_3;
                    $n4        = $row4->kode_4;
                    $n5        = $row4->kode_5; 


                    //anggaran//realisasi//bersatu
                    $sql5   = " SELECT SUM(b.nilai_ang) as anggaran, SUM(b.nilai_real) as nilai FROM data_realisasi_keg4_blud($cbulan,$ag_tox,$thn) b WHERE (left(b.kd_rek5,7) in ($n)) ";

                    $query5 = $this->db->query($sql5);
                    $trh    = $query5->row();
                    $nil    = $trh->nilai;
                    $angnil = $trh->anggaran;


                    $oke++;
                    if ($angnil < 0){
                        $x11="("; $angnilx=$angnil*-1; $y11=")";}
                    else {
                        $x11=""; $angnilx=$angnil; $y11="";}
                    
                    if ($nil < 0){
                        $x12="("; $nilx=$nil*-1; $y12=")";}
                    else {
                        $x12=""; $nilx=$nil; $y12="";}
                    
                    $real_s = $angnil - $nil;
                    if ($real_s < 0){
                        $x1="("; $real_sx=$real_s*-1; $y1=")";}
                    else {
                        $x1=""; $real_sx=$real_s; $y1="";}
                    $selisih = number_format($real_sx,"2",",",".");
                    if ($trh->nilai==0){
                        $tmp=1;
                    }else{
                        $tmp=$trh->nilai;
                    }
                    $nilai    = number_format($nilx,"2",",",".");
                    $angnilai = number_format($angnilx,"2",",",".");
                    $per1     = ($angnil!=0)?($nil / $angnil) * 100:0; 
                    $persen1  = number_format($per1,"2",",",".");
                    $no       = $no + 1;


                    switch ($row4->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"7\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"7\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;                  
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"6\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;                      
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                }
                }



         $cRet .=       " </table>";
        $data['prev']= $cRet;
         $cRet         .= "</table>";
         
         
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $namax </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        $data['prev'] = $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LRA BLUD $id / $cbulan");
        $this->template->set('title', 'LRA BLUD $id / $cbulan');        
        switch($pilih) {  
        case 0;
             $this->load->model('wprint');
             $this->wprint->PopUp($cRet);
        case 1;
             echo ("<title>LRA BLUD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        

            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            echo $cRet;
            
;
        break;
        case 3;     
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            echo $cRet;
        break;
        } 
    }
       
    function cetak_lra_blud_apbd_sap($cbulan="", $pilih=1){
    $id  = $this->session->userdata('kdskpd');
    $thn = $this->session->userdata('pcThang');
    $sqlanggaran1="select case when statu=1 and status_ubah=1 and $cbulan>=month(tgl_dpa_ubah) then '2' 
                       when statu=1 and status_ubah=1 and  $cbulan<month(tgl_dpa_ubah) then '1'
                       when statu=1 and status_ubah=0 and $cbulan>=month(tgl_dpa) then '1'
                       else '1' end as anggaran from trhrka_blud where kd_skpd='$id'";
    
    $sqlanggaran=$this->db->query($sqlanggaran1);
    foreach ($sqlanggaran->result() as $rowttd)
        {
            $anggaran=$rowttd->anggaran;
        }

    $ag_tox=$anggaran;
        
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        //$ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        
        $sqlttd1="SELECT nama as nm, nip as nip, jabatan as jab, pangkat FROM ms_ttd_blud where nip='$ttd1' AND kode ='PA' and left(kd_skpd,7) = left('$id',7)";
         $sqlttd=$this->db->query($sqlttd1);
         foreach ($sqlttd->result() as $rowttd)
        {
            $nip=$rowttd->nip;                    
            $namax= $rowttd->nm;
            $jabatan  = $rowttd->jab;
            $pangkat  = $rowttd->pangkat;
        }
        

    //function cetak_lra(){ created by henri si bre
    
       $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id' ";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $nmskpd  = $rowsc->nm_skpd;
                } 
        
        $nm_skpd    = strtoupper ($nmskpd);
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
     $modtahun= $thn%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>BADAN LAYANAN UMUM $nm_skpd</strong></td>                         
                    </tr>               
                    <tr>
                         <td align=\"center\"><strong>LAPORAN REALISASI ANGGARAN</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\">&nbsp;</td>
                    </tr>
                  </table>";        
        
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"7\"bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>ANGGARAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>REALISASI</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>LEBIH</br>(KURANG)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"7\"style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"7\"style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                        </tr>";
 
                $sql5   = " SELECT SUM(b.nilai_ang) as anggaran, SUM(kredit-debet) as nilai FROM data_realisasi_keg4_blud_apbd($cbulan,$ag_tox,$thn) b 
                WHERE kd_skpd='$id' and (left(b.kd_rek5,1) in ('4')) ";
                    $angnil4='0';
                    $query5 = $this->db->query($sql5);
                    $trh    = $query5->row();
                    $angnil4 = $trh->anggaran;
                    $nil4    = $trh->nilai;
                    
                      
                    
                    $sql5   = " SELECT SUM(b.nilai_ang) as anggaran, SUM(debet-kredit) as nilai FROM data_realisasi_keg4_blud_apbd($cbulan,$ag_tox,$thn) b 
                WHERE kd_skpd='$id' and (left(b.kd_rek5,1) in ('5')) ";
                    $angnil5='0';
                    $query5 = $this->db->query($sql5);
                    $trh    = $query5->row();
                    $angnil5 = $trh->anggaran;
                    $nil5    = $trh->nilai;
                    
                    $angnil_jml     = $angnil4 - $angnil5;
                    $nil_jml        = $nil4 -   $nil5;
                    
                    if ($angnil_jml < 0){
                        $x13="("; $angnil_jmlx=$angnil_jml*-1; $y13=")";}
                    else {
                        $x13=""; $angnil_jmlx=$angnil_jml; $y13="";}
                    
                    if ($nil_jml < 0){
                        $x14="("; $nil_jmlx=$nil_jml*-1; $y14=")";}
                    else {
                        $x14=""; $nil_jmlx=$nil_jml; $y14="";}
                    
                    $real_sjml = $angnil_jml - $nil_jml;
                    if ($real_sjml < 0){
                        $x2="("; $real_sjmlx=$real_sjml*-1; $y2=")";}
                    else {
                        $x2=""; $real_sjmlx=$real_sjml; $y2="";}
                    $selisih_jml = number_format($real_sjmlx,"2",",",".");
                    
                    
                    $nilai_jml    = number_format($nil_jmlx,"2",",",".");
                    $angnilai_jml = number_format($angnil_jmlx,"2",",",".");
                    $per1_jml     = ($angnil_jml!=0)?($nil_jml / $angnil_jml) * 100:0; 
                    $persen1_jml  = number_format($per1_jml,"2",",",".");                      
               
                $sql4="SELECT nor, uraian, cetak, seq, bold, kode_1, kode_2, kode_3, thn_m1 FROM map_lra_blud ORDER BY seq";
                $query4 = $this->db->query($sql4);
                $no     = 0;                                  
               
                foreach ($query4->result() as $row4)
                {
                    
                    $nor       = $row4->nor;   
                    $nama      = $row4->uraian;
                    $seq       = $row4->seq;
                    $bold      = $row4->bold;
                    $real_lalu = number_format($row4->thn_m1,"2",",",".");
                    $cetak     = $row4->cetak;
                    $n         = $row4->kode_1;
                    $n2        = $row4->kode_2;
                    $n3        = $row4->kode_3;
        
                    $sql5   = " SELECT SUM(b.nilai_ang) as anggaran, SUM($cetak) as nilai FROM data_realisasi_keg4_blud_apbd($cbulan,$ag_tox,$thn) b WHERE kd_skpd='$id' and (left(b.kd_rek5,3) in ($n) or left(b.kd_rek5,5) in ($n2) or left(b.kd_rek5,7) in ($n3)) ";
                    
                    $query5 = $this->db->query($sql5);
                    $trh    = $query5->row();
                    $angnil = $trh->anggaran;
                    $nil    = $trh->nilai;
                    
                    
                    if ($angnil < 0){
                        $x11="("; $angnilx=$angnil*-1; $y11=")";}
                    else {
                        $x11=""; $angnilx=$angnil; $y11="";}
                    
                    if ($nil < 0){
                        $x12="("; $nilx=$nil*-1; $y12=")";}
                    else {
                        $x12=""; $nilx=$nil; $y12="";}
                    
                    $real_s = $angnil - $nil;
                    if ($real_s < 0){
                        $x1="("; $real_sx=$real_s*-1; $y1=")";}
                    else {
                        $x1=""; $real_sx=$real_s; $y1="";}
                    $selisih = number_format($real_sx,"2",",",".");
                    if ($trh->nilai==0){
                        $tmp=1;
                    }else{
                        $tmp=$trh->nilai;
                    }
                    $nilai    = number_format($nilx,"2",",",".");
                    $angnilai = number_format($angnilx,"2",",",".");
                    $per1     = ($angnil!=0)?($nil / $angnil) * 100:0; 
                    $persen1  = number_format($per1,"2",",",".");
                    $no       = $no + 1;
                    switch ($row4->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td colspan =\"7\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td colspan =\"7\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;                  
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"6\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$nor</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x11$angnilai$y11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x12$nilai$y12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$persen1</td>
                                 </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x11$angnilai$y11<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x12$nilai$y12<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"><b>$x1$selisih$y1<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1<b></td>
                                 </tr>";
                        break;                      
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x11$angnilai$y11<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x12$nilai$y12<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"><b>$x1$selisih$y1<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1<b></td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\"style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x11$angnilai$y11<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x12$nilai$y12<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"><b>$x1$selisih$y1<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1<b></td>
                                 </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x13$angnilai_jml$y13<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x14$nilai_jml$y14<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"><b>$x2$selisih_jml$y2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1_jml<b></td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$nor<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"40%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x13$angnilai_jml$y13<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$x14$nilai_jml$y14<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"><b>$x2$selisih_jml$y2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"><b>$persen1_jml<b></td>
                                 </tr>";
                        break;
                }
                }
         $cRet .=       " </table>";
        $data['prev']= $cRet;
         $cRet         .= "</table>";
         
         
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $namax </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";
        $data['prev'] = $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LRA APBD & BLUD $id / $cbulan");
        $this->template->set('title', 'LRA APBD &BLUD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LRA APBD & BLUD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
    }
    

   function cetak_lpsal_blud_sap($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;                  
  
     
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd); 
  
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
         
            <tr>
                <td align=\"center\" colspan=\"4\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK<br>BADAN LAYANAN UMUM $nm_skpd<br>LAPORAN PERUBAHAN SALDO ANGGARAN LEBIH<br>31 DESEMBER $thn_ang DAN $thn_ang_1 </b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"4\" style=\"font-size:14px;border: solid 1px white;\">&nbsp;</td>
            </tr>            
            
            <tr>
                <td align=\"left\"  style=\"font-size:14px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
      
            <tr>
                <td align=\"center\" width=\"5%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>NO</b></td>
                <td align=\"center\" width=\"65%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>URAIAN</b></td>
                <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>$thn_ang</b></td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>$thn_ang_1</b></td>            
            </tr>";
  

                    $sql = "SELECT nor,uraian,thn_m1,isnull(kode_1,'-') as kode_1,isnull(kode_2,'-') as kode_2 FROM map_lpsal_blud 
                    group by nor,uraian,thn_blud_m1,isnull(kode_1,'-'),isnull(kode_2,'-') 
                    ORDER BY nor";

                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row)
                    {                      
                       $kd_rek   =$row->nor ;
                       $nama     =$row->uraian;
                       $nilai_1    =$row->thn_blud_m1;
                        $n              = $row->kode_1;
                        $n              = ($n=="-"?"'-'":$n);
                        $n2                 = $row->kode_2;
                        $n2             = ($n2=="-"?"'-'":$n2);
                       
                       
                        
                    $quelo01   = "SELECT  SUM(a.kredit-a.debet) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<='$cbulan' 
                    and b.kd_skpd='$id'  and (left(kd_rek5,1) in ($n2)  ) and a.kd_subkegiatan='95' ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nilai_2     = $quelo03->nilai;
                    
                        if ($nilai_1 < 0)
                        {
                            $a = "(";
                            $nilai_1 = $nilai_1 * -1;
                            $b = ")";
                        } else
                        {
                            $a = "";
                            $nilai_1 = $nilai_1;
                            $b = "";
                        }
                        
                        if ($nilai_2 < 0)
                        {
                            $c = "(";
                            $nilai_2 = $nilai_2 * -1;
                            $d = ")";
                        } else
                        {
                            $c = "";
                            $nilai_2 = $nilai_2;
                            $d = "";
                        }
                        
                               switch ($kd_rek)
                                {
                                    case 1:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                    case 2:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                     case 3:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b." </b></td>
                                                     </tr>";                                            
                                    break;
                                    case 4:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                    case 5:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break;
                                    case 8:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break;  
                                    default:  
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp; &nbsp; &nbsp; &nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">".$a."".number_format($nilai_1,2,',','.')."".$b." </td>
                                                     </tr>";                      
                                }                        
                    }
                 
           $cRet .="<tr>
                    <td align=\"center\" width=\"5%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\" >&nbsp;</td>
                    <td align=\"center\" width=\"65%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td>
                    <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td> 
                    <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td>            
                    </tr>                   
                    ";                                       
        $cRet .='</table><br/>';                
      
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LPSAL BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LPSAL BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LPSAL BLUD UPTD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
    }
    
    
   function cetak_lpsal_blud_apbd_sap($cbulan="", $pilih=1){
        //$id = $skpd;
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);
        $cetak='2';//$ctk;
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1;                  
  
     
        $sqlsc="SELECT nm_skpd FROM ms_skpd_blud where kd_skpd='$id'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $nmskpd     = $rowsc->nm_skpd;
                } 
        $nm_skpd = strtoupper($nmskpd); 
  
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
         
            <tr>
                <td align=\"center\" colspan=\"4\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KOTA PONTIANAK<br>BADAN LAYANAN UMUM $nm_skpd<br>LAPORAN PERUBAHAN SALDO ANGGARAN LEBIH<br>31 DESEMBER $thn_ang DAN $thn_ang_1 </b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"4\" style=\"font-size:14px;border: solid 1px white;\">&nbsp;</td>
            </tr>            
            
            <tr>
                <td align=\"left\"  style=\"font-size:14px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
      
            <tr>
                <td align=\"center\" width=\"5%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>NO</b></td>
                <td align=\"center\" width=\"65%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>URAIAN</b></td>
                <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>$thn_ang</b></td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:solid 1px black;\" bgcolor=\"#CCCCCC\"><b>$thn_ang_1</b></td>            
            </tr>";
  

                    $sql = "SELECT nor,uraian,thn_m1,isnull(kode_1,'-') as kode_1,isnull(kode_2,'-') as kode_2,a1_02_01_01,a1_02_01_21,a1_02_01_22,a1_02_01_23,a1_02_01_24,a1_02_01_25,a1_02_01_26,a1_02_01_02,a1_02_01_03,a1_02_01_04,a1_02_01_05,a1_02_01_06,a1_02_01_07,a1_02_01_08,a1_02_01_09,a1_02_01_10,a1_02_01_11,a1_02_01_12,a1_02_01_13,a1_02_01_14,a1_02_01_15,a1_02_01_16,a1_02_01_17,a1_02_01_18,a1_02_01_19,a1_02_01_20  FROM map_lpsal_blud 
                    group by nor,uraian,thn_m1,isnull(kode_1,'-'),isnull(kode_2,'-') ,a1_02_01_01,a1_02_01_21,a1_02_01_22,a1_02_01_23,a1_02_01_24,a1_02_01_25,a1_02_01_26,a1_02_01_02,a1_02_01_03,a1_02_01_04,a1_02_01_05,a1_02_01_06,a1_02_01_07,a1_02_01_08,a1_02_01_09,a1_02_01_10,a1_02_01_11,a1_02_01_12,a1_02_01_13,a1_02_01_14,a1_02_01_15,a1_02_01_16,a1_02_01_17,a1_02_01_18,a1_02_01_19,a1_02_01_20
                    ORDER BY nor";
                   //echo " $sql";
                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row)
                    {                      
                       $kd_rek   =$row->nor ;
                       $nama     =$row->uraian;
                       //$nilai_1    =$row->thn_m1;
                        $n              = $row->kode_1;
                        $n              = ($n=="-"?"'-'":$n);
                        $n2                 = $row->kode_2;
                        $n2             = ($n2=="-"?"'-'":$n2);
                    
                    if($id=='1.02.01.01'){
                        $nilai_1 = $row->a1_02_01_01;
                        $kolom = 'a1_02_01_01';
                        
                    }else if($id=='1.02.01.21'){
                        $nilai_1 = $row->a1_02_01_21;
                        $kolom = 'a1_02_01_21';
                        
                    }else if($id=='1.02.01.22'){
                        $nilai_1 = $row->a1_02_01_22;
                        $kolom = 'a1_02_01_22';
                        
                    }else if($id=='1.02.01.23'){
                        $nilai_1 = $row->a1_02_01_23;
                        $kolom = 'a1_02_01_23';
                    
                    }else if($id=='1.02.01.24'){
                        $nilai_1 = $row->a1_02_01_24;
                        $kolom = 'a1_02_01_24';
                    
                    }else if($id=='1.02.01.25'){
                        $nilai_1 = $row->a1_02_01_25;
                        $kolom = 'a1_02_01_25';
                    
                    }else if($id=='1.02.01.26'){
                        $nilai_1 = $row->a1_02_01_26;
                        $kolom = 'a1_02_01_26';

                    }else if($id=='1.02.01.02'){
                        $nilai_1 = $row->a1_02_01_02;
                        $kolom = 'a1_02_01_02'; 

                    }else if($id=='1.02.01.03'){
                        $nilai_1 = $row->a1_02_01_03;
                        $kolom = 'a1_02_01_03';

                    }else if($id=='1.02.01.04'){
                        $nilai_1 = $row->a1_02_01_04;
                        $kolom = 'a1_02_01_04';

                    }else if($id=='1.02.01.05'){
                        $nilai_1 = $row->a1_02_01_05;
                        $kolom = 'a1_02_01_05';

                    }else if($id=='1.02.01.06'){
                        $nilai_1 = $row->a1_02_01_06;
                        $kolom = 'a1_02_01_06';   

                    }else if($id=='1.02.01.07'){
                        $nilai_1 = $row->a1_02_01_07;
                        $kolom = 'a1_02_01_07';

                    }else if($id=='1.02.01.08'){
                        $nilai_1 = $row->a1_02_01_08;
                        $kolom = 'a1_02_01_08';

                    }else if($id=='1.02.01.09'){
                        $nilai_1 = $row->a1_02_01_09;
                        $kolom = 'a1_02_01_09';

                    }else if($id=='1.02.01.10'){
                        $nilai_1 = $row->a1_02_01_10;
                        $kolom = 'a1_02_01_10';

                    }else if($id=='1.02.01.11'){
                        $nilai_1 = $row->a1_02_01_11;
                        $kolom = 'a1_02_01_11';

                    }else if($id=='1.02.01.12'){
                        $nilai_1 = $row->a1_02_01_12;
                        $kolom = 'a1_02_01_12';

                    }else if($id=='1.02.01.13'){
                        $nilai_1 = $row->a1_02_01_13;
                        $kolom = 'a1_02_01_13';

                    }else if($id=='1.02.01.14'){
                        $nilai_1 = $row->a1_02_01_14;
                        $kolom = 'a1_02_01_14';

                    }else if($id=='1.02.01.15'){
                        $nilai_1 = $row->a1_02_01_15;
                        $kolom = 'a1_02_01_15';

                    }else if($id=='1.02.01.16'){
                        $nilai_1 = $row->a1_02_01_16;
                        $kolom = 'a1_02_01_16';

                    }else if($id=='1.02.01.17'){
                        $nilai_1 = $row->a1_02_01_17;
                        $kolom = 'a1_02_01_17';

                    }else if($id=='1.02.01.18'){
                        $nilai_1 = $row->a1_02_01_18;
                        $kolom = 'a1_02_01_18';

                    }else if($id=='1.02.01.19'){
                        $nilai_1 = $row->a1_02_01_19;
                        $kolom = 'a1_02_01_19';

                    }else if($id=='1.02.01.20'){
                        $nilai_1 = $row->a1_02_01_20;
                        $kolom = 'a1_02_01_20';                                                     
                    }
                    else{
                        $nilai_1 = $row->thn_m1;
                        $kolom = 'thn_m1';
                    }   
                       
                        
                    $awal01   = "SELECT  SUM($kolom) as nilai_awal FROM map_lpsal_blud where nor='8' ";
                    $awal011 = $this->db->query($awal01);
                    $awal0111 = $awal011->row();
                    $nilai_3     = $awal0111->nilai_awal;
                    $nilai_4     = $nilai_3*-1;
                    
                    $quelo01   = "SELECT  SUM(a.kredit-a.debet) as nilai FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd WHERE year(tgl_voucher)=$thn_ang and month(b.tgl_voucher)<='$cbulan' 
                    and b.kd_skpd='$id'  and (left(kd_rek5,1) in ($n2)  ) ";
                    $quelo02 = $this->db->query($quelo01);
                    $quelo03 = $quelo02->row();
                    $nilai_2     = $quelo03->nilai;
                    
                    
                    
                        if ($nilai_1 < 0)
                        {
                            $a = "(";
                            $nilai_1 = $nilai_1 * -1;
                            $b = ")";
                        } else
                        {
                            $a = "";
                            $nilai_1 = $nilai_1;
                            $b = "";
                        }
                        
                        if ($nilai_2 < 0)
                        {
                            $c = "(";
                            $nilai_2 = $nilai_2 * -1;
                            $d = ")";
                        } else
                        {
                            $c = "";
                            $nilai_2 = $nilai_2;
                            $d = "";
                        }
                        
                        if ($nilai_3 < 0)
                        {
                            $e = "(";
                            $nilai_3 = $nilai_3 * -1;
                            $f = ")";
                        } else
                        {
                            $e = "";
                            $nilai_3 = $nilai_3;
                            $f = "";
                        }
                        
                                                if ($nilai_3 < 0)
                        {
                            $g = "(";
                            $nilai_4 = $nilai_4 * -1;
                            $h = ")";
                        } else
                        {
                            $g = "";
                            $nilai_4 = $nilai_4;
                            $h = "";
                        }
                        
                               switch ($kd_rek)
                                {
                                    case 1:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$e."".number_format($nilai_3,2,',','.')."".$f."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                    case 2:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$g."".number_format($nilai_4,2,',','.')."".$h."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                     case 3:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b." </b></td>
                                                     </tr>";                                            
                                    break;
                                    case 4:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break; 
                                    case 5:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break;
                                    case 8:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$c."".number_format($nilai_2,2,',','.')."".$d."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$a."".number_format($nilai_1,2,',','.')."".$b."</b></td>
                                                     </tr>";                                            
                                    break;  
                                    default:  
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp; &nbsp; &nbsp; &nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">".$a."".number_format($nilai_1,2,',','.')."".$b." </td>
                                                     </tr>";                      
                                }                        
                    }
                 
           $cRet .="<tr>
                    <td align=\"center\" width=\"5%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\" >&nbsp;</td>
                    <td align=\"center\" width=\"65%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td>
                    <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td> 
                    <td align=\"center\" width=\"15%\" style=\"font-size:14px;border-bottom:solid 1px black;border-top:none\">&nbsp;</td>            
                    </tr>                   
                    ";                                       
        $cRet .='</table><br/>';                
      
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";

        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("LPSAL BLUD UPTD $id / $cbulan");
        $this->template->set('title', 'LPSAL BLUD UPTD $id / $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>LPSAL BLUD UPTD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
              $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
         break;
        } 
        
    }
    
    
    function ctk_lpe_blud_sap($cbulan="", $pilih=1){
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);        
        $id = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $id1     = $this->session->userdata('kdskpd');
        $nmskpd = $this->tukd_model->get_nama($id1,'nm_skpd','ms_skpd_blud','kd_skpd');
        $nmskpd =strtoupper($nmskpd);
        $thn_ang_1= $thn_ang-1;   
        $cbulan<10 ? $xbulan = "0$cbulan" : $xbulan=$cbulan;
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient_blud";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                
        $skpd = "AND kd_skpd='$id1'";
        $skpd1 = "AND b.kd_skpd='$id1'"; 

// UPDATE LPE TAHUN LALU
                    
            $sqllo10="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $querylo10= $this->db->query($sqllo10);
                    $pen8 = $querylo10->row();
                    $pen_lalu8 = $pen8->nilai;
                    $pen_lalu81= number_format($pen8->nilai,"2",",",".");
        
            $sqllo12="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' and a.kd_subkegiatan='95'";
                    $querylo12= $this->db->query($sqllo12);
                    $bel10 = $querylo12->row();
                    $bel_lalu10 = $bel10->nilai;
                    $bel_lalu101= number_format($bel10->nilai,"2",",",".");

            $sql_lalu = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//aba
                            
                    $hasil = $this->db->query($sql_lalu); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $lpe_ll1  =$row001->thn_m1;
                    }
                        
            $sqllpe_lalu1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd ='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $lpe_ll2  =$row002->thn_m1;
                    }                   

            $sqllpe_lalu2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $lpe_ll3  =$row003->thn_m1;
                    }
                    
            
            $query3 = $this->db->query(" SELECT isnull(SUM(a.debet),0) AS debet, isnull(SUM(a.kredit),0) AS kredit FROM trdju_sap_blud a INNER JOIN trhju_sap_blud b 
            ON a.no_voucher = b.no_voucher and a.kd_unit=b.kd_skpd WHERE b.kd_skpd='$id' AND a.kd_rek5='3110101' AND YEAR(b.tgl_voucher)<'$thn_ang'
            and b.tabel=1 and reev=0 and a.kd_subkegiatan='95'");  
            foreach($query3->result_array() as $res2){
                 $debet=$res2['debet'];
                 $kredit=$res2['kredit'];
                                 
             }
             
        $real=$kredit-$debet+$pen_lalu8+$bel_lalu10+$lpe_ll1+$lpe_ll2+$lpe_ll3;

        //      created by henri_tb
        $sqllo9="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and left(kd_rek5,1) in ('8') and b.kd_skpd='$id'  and a.kd_subkegiatan='95'";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' and a.kd_subkegiatan='95' ";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    
                    $selisih_surplus_lo3 = $surplus_lo3 - $surplus_lo_lalu3;

            $sql_lalu = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd ='$id' and b.kd_subkegiatan='95' ";//aba
                            
                    $hasil = $this->db->query($sql_lalu); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $lpe_lalu1  =$row001->thn_m1;
                    }
                        
            $sqllpe_lalu1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd= '$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $lpe_lalu2  =$row002->thn_m1;
                    }                   

            $sqllpe_lalu2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $lpe_lalu3  =$row003->thn_m1;
                    }
                    
            $sqlrkpp2 = "select isnull(sum(b.kredit)-sum(b.debet),0) as nilai from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where left(b.kd_rek5,3) in ('313') and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $rkpp2 = $this->db->query($sqlrkpp2); 
                    $rkpp12 = $rkpp2->row();
                    $rkpp_lalu2 = $rkpp12->nilai;
                    $rkpp_lalu12 = number_format($rkpp12->nilai,"2",",",".");

        $sal_awal   = $real + $surplus_lo_lalu3 + $lpe_lalu1 + $lpe_lalu2 + $lpe_lalu3 + $rkpp_lalu2;
/*      
        $sql51 = "SELECT SUM(real_spj) as nilai FROM realisasi WHERE left(kd_rek5,1)='9'";
        $query51 = $this->db->query($sql51);
        $jmlb = $query51->row();
        $jmlbelanja = $jmlb->nilai;
        $jmlbelanja1 = number_format($jmlb->nilai, "2", ".", ",");
        $sql523 = "SELECT SUM(real_spj) as nilai FROM realisasi WHERE left(kd_rek5,3)='923'";
        $query523 = $this->db->query($sql523);
        $jmlbm = $query523->row();
        $jmlbmbelanja = $jmlbm->nilai;
        $jmlbmbelanja1 = number_format($jmlbmbelanja, "2", ".", ",");
        $sql61 = "SELECT SUM(real_spj) as nilai FROM realisasi WHERE left(kd_rek5,2)='71'";
        $query61 = $this->db->query($sql61);
        $jmlpm = $query61->row();
        $jmlpmasuk = $jmlpm->nilai;
        $sql62 = "SELECT SUM(real_spj) as nilai FROM realisasi WHERE left(kd_rek5,2)='72'";
        $query62 = $this->db->query($sql62);
        $jmlpk = $query62->row();
        $jmlpkeluar = $jmlpk->nilai;
        $surplus = $jmlpendapatan - $jmlbelanja;
*/                      
            $sql = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//aba
                            
                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $nilaiDR  =$row001->thn_m1;
                    }
                        
            $sqllpe1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $nilailpe1  =$row002->thn_m1;
                    }                   

            $sqllpe2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $nilailpe2  =$row003->thn_m1;
                    }
                          
            $sqlrkpp3 = "select isnull(sum(b.kredit)-sum(b.debet),0) as nilai from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where left(b.kd_rek5,3) in ('313') and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' and b.kd_subkegiatan='95' ";//Henri_TB
                            
                    $rkpp3 = $this->db->query($sqlrkpp3); 
                    $rkpp13 = $rkpp3->row();
                    $rkpp = $rkpp13->nilai ;

                    $rkpp1 = number_format($rkpp13->nilai,"2",",","."); 
                            
/*        $biaya_net = $jmlpmasuk - $jmlpkeluar;        
        $silpa = ($jmlpendapatan + $jmlpmasuk) - ($jmlbelanja + $jmlpkeluar);
        if ($silpa < 0)
        {
            $a = "(";
            $silpa1 = $silpa * -1;
            $b = ")";
        } else
        {
            $a = "";
            $silpa1 = $silpa;
            $b = "";
        }
*/
        $sal_akhir=$sal_awal+$surplus_lo3+$nilaiDR+$nilailpe1+$nilailpe2+$rkpp;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $lo16="";}                        
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3,"2",",",".");
                    
                    if ($selisih_surplus_lo3 < 0){
                        $lo17="("; $selisih_surplus_lo3=$selisih_surplus_lo3*-1; $lo18=")";}
                    else {
                        $lo17=""; $lo18="";}
                    $selisih_surplus_lo31 = number_format($selisih_surplus_lo3,"2",",",".");

                    if ($lpe_lalu1 < 0){
                        $lalu1="("; $lpe_lalu1=$lpe_lalu1*-1; $lalu2=")";}
                    else {
                        $lalu1=""; $lpe_lalu1; $lalu2="";}              

                    if ($lpe_lalu2 < 0){
                        $lalu3="("; $lpe_lalu2=$lpe_lalu2*-1; $lalu4=")";}
                    else {
                        $lalu3=""; $lpe_lalu2; $lalu4="";}

                    if ($lpe_lalu3 < 0){
                        $lalu5="("; $lpe_lalu3=$lpe_lalu3*-1; $lalu6=")";}
                    else {
                        $lalu5=""; $lpe_lalu3; $lalu6="";}
                        
                    if ($nilaiDR < 0){
                        $l000="("; $nilaiDR=$nilaiDR*-1; $p000=")";}
                    else {
                        $l000=""; $nilaiDR; $p000="";}      

                    if ($nilailpe1 < 0){
                        $l001="("; $nilailpe1=$nilailpe1*-1; $p001=")";}
                    else {
                        $l001=""; $nilailpe1; $p001="";}

                    if ($nilailpe2 < 0){
                        $l002="("; $nilailpe2=$nilailpe2*-1; $p002=")";}
                    else {
                        $l002=""; $nilailpe2; $p002="";}

                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3,"2",",",".");
                    
                    if ($rkpp_lalu2 < 0)
                    {
                        $pp1 = "("; $rkpp_lalu2 = $rkpp_lalu2 * -1; $pp2 = ")";
                    } else
                    {
                        $pp1 = ""; $rkpp_lalu2; $pp2 = "";
                    }

                    if ($rkpp < 0)
                    {
                        $pp3 = "("; $rkpp = $rkpp * -1; $pp4 = ")";
                    } else
                    {
                        $pp3 = ""; $rkpp; $pp4 = "";
                    }
                    
                    if ($sal_akhir < 0)
                    {
                        $c = "("; $sal_akhir = $sal_akhir * -1; $d = ")";
                    } else
                    {
                        $c = ""; $sal_akhir; $d = "";
                    }

                    if ($sal_awal < 0)
                    {
                        $c1 = "("; $sal_awal = $sal_awal * -1; $d1 = ")";
                    } else
                    {
                        $c1 = ""; $sal_awal; $d1 = "";
                    }

                    if ($real < 0)
                    {
                        $cx = "("; $real = $real * -1; $dx = ")";
                    } else
                    {
                        $cx = ""; $real; $dx = "";
                    }
        
         $modtahun= $thn_ang%4;
         
         if ($modtahun = 0){
            $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
                else {
            $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
         
         $arraybulan=explode(".",$nilaibulan);
        
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
         
            <tr>
                <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>BADAN LAYANAN UMUM $nmskpd</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>LAPORAN PERUBAHAN EKUITAS</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
            </tr>
              <tr>
                <td align=\"center\">&nbsp;</td>
            </tr>   
        </table>";        
        
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">    
                    <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td  bgcolor=\"#CCCCCC\" width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>$thn_ang_1</b></td> 
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                          
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"65%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>";
                
                
                     $sql = "SELECT nor,parent,uraian,thn_blud_m1 FROM map_lpe_skpd  ORDER BY seq";
                            
                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row)
                    {
                      
                       $kd_rek   =$row->nor ;
                       $parent   =$row->parent;
                       $nama     =$row->uraian;
                       $nilai_1    =$row->thn_blud_m1;
                       
                       
/*        if ($nilai_1 < 0)
        {
            $tx = "(";
            $nilai_1 = $nilai_1 * -1;
            $ty = ")";
        } else
        {
            $tx = "";
            $ty = "";
        }
*/
                               switch ($kd_rek)
                                {
                                    case 1:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c1".number_format($sal_awal,"2",",",".")."$d1</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$cx".number_format($real,"2",",",".")."$dx</b></td>
                                                     </tr>";
                                            
                                    break; 
                                    case 2:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$lo13".number_format($surplus_lo3,"2",",",".")."$lo14</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$lo15".number_format($surplus_lo_lalu3,"2",",",".")."$lo16</b></td>
                                                     </tr>";
                                            
                                    break; 
                                     case 3:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                     </tr>";
                                            
                                    break; 
                                    case 4: 
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l001".number_format($nilailpe1,"2",",",".")."$p001</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu1".number_format($lpe_lalu2,"2",",",".")."$lalu2</td>
                                                     </tr>";
                                    break;
                                    case 5:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l000".number_format($nilaiDR,"2",",",".")."$p000</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu3".number_format($lpe_lalu1,"2",",",".")."$lalu4</td>
                                                     </tr>";
                                    break;
                                    case 6:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l002".number_format($nilailpe2,"2",",",".")."$p002</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu5".number_format($lpe_lalu3,"2",",",".")."$lalu6</td>
                                                     </tr>";
                                    break;
                                    case 7:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$pp3".number_format($rkpp,"2",",",".")."$d</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$pp1".number_format($rkpp_lalu2,"2",",",".")."$d1</b></td>
                                                     </tr>";
                                    break;
                                    case 8:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c".number_format($sal_akhir,"2",",",".")."$d</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c1".number_format($sal_awal,"2",",",".")."$d1</b></td>
                                                     </tr>";
                                } 
                       
                    }
 
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";                                        

        $cRet .='</table>';
                 
         $data['prev']= $cRet;  
         $data['sikap'] = 'preview';
         $judul = ("LPE UPTD BLUD $id / $cbulan");
        $this->template->set('title', 'LPE SKPD $id / $cbulan');  
         switch ($pilih)
        {
            case 1;
                echo ("<title>LPE UPTD BLUD $cbulan</title>");
                echo $cRet;
                break;
            case 0;
               $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                echo $cRet;
               break;
            case 2;
                header("Cache-Control: no-cache, no-store, must-revalidate");
                header("Content-Type: application/vnd.ms-excel");
                header("Content-Disposition: attachment; filename= $judul.xls");

                $this->load->view('anggaran/rka/perkadaII', $data);
                break;
            case 3;
                header("Cache-Control: no-cache, no-store, must-revalidate");
                header("Content-Type: application/vnd.ms-word");
                header("Content-Disposition: attachment; filename= $judul.doc");
                $this->load->view('anggaran/rka/perkadaII', $data);
                break;
        }

    }   
    
    
    function ctk_lpe_blud_apbd_sap($cbulan="", $pilih=1){
        $tanggalttd = $this->uri->segment(5);
        $ttd1 = str_replace('a',' ',$this->uri->segment(6));
        $ttd2 = str_replace('a',' ',$this->uri->segment(7));
        $ctgl_ttd = $this->tukd_model->tanggal_format_indonesia($tanggalttd);        
        $id = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $id1     = $this->session->userdata('kdskpd');
        $nmskpd = $this->tukd_model->get_nama($id1,'nm_skpd','ms_skpd_blud','kd_skpd');
        $nmskpd =strtoupper($nmskpd);
        $thn_ang_1= $thn_ang-1;   
        $cbulan<10 ? $xbulan = "0$cbulan" : $xbulan=$cbulan;
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient_blud";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                
        $skpd = "AND kd_skpd='$id1'";
        $skpd1 = "AND b.kd_skpd='$id1'"; 

// UPDATE LPE TAHUN LALU
                    
            $sqllo10="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id'";
                    $querylo10= $this->db->query($sqllo10);
                    $pen8 = $querylo10->row();
                    $pen_lalu8 = $pen8->nilai;
                    $pen_lalu81= number_format($pen8->nilai,"2",",",".");
        
            $sqllo12="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)<$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id'";
                    $querylo12= $this->db->query($sqllo12);
                    $bel10 = $querylo12->row();
                    $bel_lalu10 = $bel10->nilai;
                    $bel_lalu101= number_format($bel10->nilai,"2",",",".");

            $sql_lalu = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd='$id' ";//aba
                            
                    $hasil = $this->db->query($sql_lalu); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $lpe_ll1  =$row001->thn_m1;
                    }
                        
            $sqllpe_lalu1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd ='$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $lpe_ll2  =$row002->thn_m1;
                    }                   

            $sqllpe_lalu2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)<$thn_ang_1 and a.kd_skpd='$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $lpe_ll3  =$row003->thn_m1;
                    }
                    
            
            $query3 = $this->db->query(" SELECT isnull(SUM(a.debet),0) AS debet, isnull(SUM(a.kredit),0) AS kredit FROM trdju_sap_blud a INNER JOIN trhju_sap_blud b 
            ON a.no_voucher = b.no_voucher and a.kd_unit=b.kd_skpd WHERE b.kd_skpd='$id' AND a.kd_rek5='3110101' AND YEAR(b.tgl_voucher)<'$thn_ang'
            and b.tabel=1 and reev=0");  
            foreach($query3->result_array() as $res2){
                 $debet=$res2['debet'];
                 $kredit=$res2['kredit'];
                                 
             }
             
        $real=$kredit-$debet+$pen_lalu8+$bel_lalu10+$lpe_ll1+$lpe_ll2+$lpe_ll3;

        //      created by henri_tb
        $sqllo9="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' ";
                    $querylo9= $this->db->query($sqllo9);
                    $penlo7 = $querylo9->row();
                    $pen_lo7 = $penlo7->nilai;
                    $pen_lo71= number_format($penlo7->nilai,"2",",",".");
        
        $sqllo10="select isnull(sum(kredit-debet),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('8') and b.kd_skpd='$id' ";
                    $querylo10= $this->db->query($sqllo10);
                    $penlo8 = $querylo10->row();
                    $pen_lo_lalu8 = $penlo8->nilai;
                    $pen_lo_lalu81= number_format($penlo8->nilai,"2",",",".");
        
        $sqllo11="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' ";
                    $querylo11= $this->db->query($sqllo11);
                    $bello9 = $querylo11->row();
                    $bel_lo9 = $bello9->nilai;
                    $bel_lo91= number_format($bello9->nilai,"2",",",".");
        
        $sqllo12="select isnull(sum(debet-kredit),0) as nilai from trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd where year(tgl_voucher)=$thn_ang_1 and left(kd_rek5,1) in ('9') and b.kd_skpd='$id' ";
                    $querylo12= $this->db->query($sqllo12);
                    $bello10 = $querylo12->row();
                    $bel_lo_lalu10 = $bello10->nilai;
                    $bel_lo_lalu101= number_format($bello10->nilai,"2",",",".");        

                    $surplus_lo3 = $pen_lo7 - $bel_lo9;
                    
                    $surplus_lo_lalu3 = $pen_lo_lalu8 - $bel_lo_lalu10;
                    
                    $selisih_surplus_lo3 = $surplus_lo3 - $surplus_lo_lalu3;

            $sql_lalu = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd ='$id' ";//aba
                            
                    $hasil = $this->db->query($sql_lalu); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $lpe_lalu1  =$row001->thn_m1;
                    }
                        
            $sqllpe_lalu1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd= '$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $lpe_lalu2  =$row002->thn_m1;
                    }                   

            $sqllpe_lalu2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd='$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe_lalu2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $lpe_lalu3  =$row003->thn_m1;
                    }
                    
            $sqlrkpp2 = "select isnull(sum(b.kredit)-sum(b.debet),0) as nilai from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where left(b.kd_rek5,5) in ('31301') and year(a.tgl_voucher)=$thn_ang_1 and a.kd_skpd='$id' ";//Henri_TB
                            
                    $rkpp2 = $this->db->query($sqlrkpp2); 
                    $rkpp12 = $rkpp2->row();
                    $rkpp_lalu2 = $rkpp12->nilai;
                    $rkpp_lalu12 = number_format($rkpp12->nilai,"2",",",".");

        $sal_awal   = $real + $surplus_lo_lalu3 + $lpe_lalu1 + $lpe_lalu2 + $lpe_lalu3 + $rkpp_lalu2;
                    
            $sql = "select 5 nor,'SELISIH REVALUASI ASET TETAP' uraian,3 parent,25 seq,'413'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('1','37') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' ";//aba
                            
                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row001)
                    {
                       $kd_rek   =$row001->nor ;
                       $parent   =$row001->parent;
                       $nama     =$row001->uraian;
                       $nilaiDR  =$row001->thn_m1;
                    }
                        
            $sqllpe1 = "select 4 nor,'KOREKSI NILAI PERSEDIAAN' uraian,3 parent,20 seq,'412'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('2','35') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe1); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row002)
                    {
                       $kd_rek   =$row002->nor ;
                       $parent   =$row002->parent;
                       $nama     =$row002->uraian;
                       $nilailpe1  =$row002->thn_m1;
                    }                   

            $sqllpe2 = "select 6 nor,'LAIN LAIN' uraian,3 parent,30 seq,'414'kode_1,isnull(sum(kredit-debet),0) thn_m1 from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where  reev in ('3','31','32','33','34','36','38','39','40','41','42','43','44','45') and kd_rek5='3110101' and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' ";//Henri_TB
                            
                    $hasil = $this->db->query($sqllpe2); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row003)
                    {
                       $kd_rek   =$row003->nor ;
                       $parent   =$row003->parent;
                       $nama     =$row003->uraian;
                       $nilailpe2  =$row003->thn_m1;
                    }
                          
            $sqlrkpp3 = "select isnull(sum(b.kredit)-sum(b.debet),0) as nilai from trhju_sap_blud a
                    inner join trdju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_skpd=b.kd_unit where left(b.kd_rek5,5) in ('31301') and year(a.tgl_voucher)=$thn_ang and left(CONVERT(char(15),tgl_voucher, 112),6)<='$thn_ang$xbulan' and a.kd_skpd='$id' ";//Henri_TB
                            
                    $rkpp3 = $this->db->query($sqlrkpp3); 
                    $rkpp13 = $rkpp3->row();
                    $rkpp = $rkpp13->nilai ;
                    $rkpp1 = number_format($rkpp13->nilai,"2",",","."); 
                            
/*        $biaya_net = $jmlpmasuk - $jmlpkeluar;        
        $silpa = ($jmlpendapatan + $jmlpmasuk) - ($jmlbelanja + $jmlpkeluar);
        if ($silpa < 0)
        {
            $a = "(";
            $silpa1 = $silpa * -1;
            $b = ")";
        } else
        {
            $a = "";
            $silpa1 = $silpa;
            $b = "";
        }
*/
        $sal_akhir=$sal_awal+$surplus_lo3+$nilaiDR+$nilailpe1+$nilailpe2+$rkpp;
                    if ($surplus_lo_lalu3 < 0){
                        $lo15="("; $surplus_lo_lalu3=$surplus_lo_lalu3*-1; $lo16=")";}
                    else {
                        $lo15=""; $lo16="";}                        
                    $surplus_lo_lalu31 = number_format($surplus_lo_lalu3,"2",",",".");
                    
                    if ($selisih_surplus_lo3 < 0){
                        $lo17="("; $selisih_surplus_lo3=$selisih_surplus_lo3*-1; $lo18=")";}
                    else {
                        $lo17=""; $lo18="";}
                    $selisih_surplus_lo31 = number_format($selisih_surplus_lo3,"2",",",".");

                    if ($lpe_lalu1 < 0){
                        $lalu1="("; $lpe_lalu1=$lpe_lalu1*-1; $lalu2=")";}
                    else {
                        $lalu1=""; $lpe_lalu1; $lalu2="";}              

                    if ($lpe_lalu2 < 0){
                        $lalu3="("; $lpe_lalu2=$lpe_lalu2*-1; $lalu4=")";}
                    else {
                        $lalu3=""; $lpe_lalu2; $lalu4="";}

                    if ($lpe_lalu3 < 0){
                        $lalu5="("; $lpe_lalu3=$lpe_lalu3*-1; $lalu6=")";}
                    else {
                        $lalu5=""; $lpe_lalu3; $lalu6="";}
                        
                    if ($nilaiDR < 0){
                        $l000="("; $nilaiDR=$nilaiDR*-1; $p000=")";}
                    else {
                        $l000=""; $nilaiDR; $p000="";}      

                    if ($nilailpe1 < 0){
                        $l001="("; $nilailpe1=$nilailpe1*-1; $p001=")";}
                    else {
                        $l001=""; $nilailpe1; $p001="";}

                    if ($nilailpe2 < 0){
                        $l002="("; $nilailpe2=$nilailpe2*-1; $p002=")";}
                    else {
                        $l002=""; $nilailpe2; $p002="";}

                    if ($surplus_lo3 < 0){
                        $lo13="("; $surplus_lo3=$surplus_lo3*-1; $lo14=")";}
                    else {
                        $lo13=""; $lo14="";}        
                    $surplus_lo31 = number_format($surplus_lo3,"2",",",".");
                    
                    if ($rkpp_lalu2 < 0)
                    {
                        $pp1 = "("; $rkpp_lalu2 = $rkpp_lalu2 * -1; $pp2 = ")";
                    } else
                    {
                        $pp1 = ""; $rkpp_lalu2; $pp2 = "";
                    }
                   
                    
                    if ($sal_akhir < 0)
                    {
                        $c = "("; $sal_akhir = $sal_akhir * -1; $d = ")";
                    } else
                    {
                        $c = ""; $sal_akhir; $d = "";
                    }

                    if ($sal_awal < 0)
                    {
                        $c1 = "("; $sal_awal = $sal_awal * -1; $d1 = ")";
                    } else
                    {
                        $c1 = ""; $sal_awal; $d1 = "";
                    }

                    if ($real < 0)
                    {
                        $cx = "("; $real = $real * -1; $dx = ")";
                    } else
                    {
                        $cx = ""; $real; $dx = "";
                    }
        
         $modtahun= $thn_ang%4;
         
         if ($modtahun = 0){
            $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
                else {
            $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
         
         $arraybulan=explode(".",$nilaibulan);
        
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
         
            <tr>
                <td align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>BADAN LAYANAN UMUM $nmskpd</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>LAPORAN PERUBAHAN EKUITAS</strong></td>
            </tr>
            <tr>
                <td align=\"center\"><strong>UNTUK TAHUN YANG BERAKHIR SAMPAI DENGAN $arraybulan[$cbulan] $thn_ang DAN $thn_ang_1</strong></td>
            </tr>
              <tr>
                <td align=\"center\">&nbsp;</td>
            </tr>   
        </table>";        
        
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">    
                    <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td  bgcolor=\"#CCCCCC\" width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>$thn_ang</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>$thn_ang_1</b></td> 
                        </tr>
                        
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                          
                         </tr>
                     </tfoot>
                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"65%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>";
                
                     $idx = str_replace('.','_',$this->session->userdata('kdskpd'));

                     $sql = "SELECT *, a$idx lalu FROM map_lpe_skpd  ORDER BY seq";
                            
                    $hasil = $this->db->query($sql); 
                    $nawal = 0 ;
                    foreach ($hasil->result() as $row)
                    {
                      
                       $kd_rek   =$row->nor ;
                       $lalu   =$row->lalu ;
                       $parent   =$row->parent;
                       $nama     =$row->uraian;
                       $nilai_1    =$row->thn_m1;
                       
                       
                               switch ($kd_rek)
                                {
                                    case 1:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c1".number_format($sal_awal,"2",",",".")."$d1</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$cx".number_format($lalu,"2",",",".")."$dx</b></td>
                                                     </tr>";
                                            
                                    break; 
                                    case 2:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$lo13".number_format($surplus_lo3,"2",",",".")."$lo14</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$lo15".number_format($lalu,"2",",",".")."$lo16</b></td>
                                                     </tr>";
                                            
                                    break; 
                                     case 3:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"></td>
                                                     </tr>";
                                            
                                    break; 
                                    case 4: 
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l001".number_format($nilailpe1,"2",",",".")."$p001</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu1".number_format($lalu,"2",",",".")."$lalu2</td>
                                                     </tr>";
                                    break;
                                    case 5:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l000".number_format($nilaiDR,"2",",",".")."$p000</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu3".number_format($lalu,"2",",",".")."$lalu4</td>
                                                     </tr>";
                                    break;
                                    case 6:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\">$kd_rek</td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nama</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$l002".number_format($nilailpe2,"2",",",".")."$p002</td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\">$lalu5".number_format($lalu,"2",",",".")."$lalu6</td>
                                                     </tr>";
                                    break;
                                    case 7:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>".$this->minim($rkpp)."</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$pp1".number_format($lalu,"2",",",".")."$d1</b></td>
                                                     </tr>";
                                    break;
                                    case 8:
                                            $cRet .="<tr>
                                                      <td valign=\"top\"  width=\"5%\" align=\"center\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$kd_rek</b></td>
                                                      <td valign=\"top\"  width=\"65%\"  align=\"left\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$nama</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c".number_format($sal_akhir,"2",",",".")."$d</b></td>
                                                      <td valign=\"top\"  width=\"15%\" align=\"right\" style=\"font-size:14px;border-bottom:none;border-top:none\"><b>$c1".number_format($sal_awal,"2",",",".")."$d1</b></td>
                                                      </tr>";
                                } 
                       
                    }
 
        $cRet .=       " </table>";
        
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_blud where kd_skpd='$id' and kode='PA' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd</td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> $oioi </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\">&nbsp;</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip </td>
         </tr>
         </table>
         ";                                        

        $cRet .='</table>';
                 
         $data['prev']= $cRet;  
         $data['sikap'] = 'preview';
         $judul = ("LPE UPTD BLUD $id / $cbulan");
        $this->template->set('title', 'LPE SKPD $id / $cbulan');  
         switch ($pilih)
        {
            case 1;
            echo $cRet;
              // $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
                break;
            case 0;
            echo $cRet;
               //$this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
             
               break;
            case 2;
 
                header("Content-Type: application/vnd.ms-excel");
                header("Content-Disposition: attachment; filename= $judul.xls");
                            echo $cRet;
            case 3;
                header("Cache-Control: no-cache, no-store, must-revalidate");
                header("Content-Type: application/vnd.ms-word");
                header("Content-Disposition: attachment; filename= $judul.doc");
                $this->load->view('anggaran/rka/perkadaII', $data);
                break;
        }

    }   
        
    
function cetakneraca_saldo_blud_skpd($dcetak='',$ttd='',$skpd='',$dcetak2='', $jenis=''){ 
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1=$thn_ang-1;
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>NERACA SALDO </B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >SKPD</TD>
                        <TD align="left" width="80%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd').'</TD>
                     </TR>                   
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >KODE</TD>
                        <TD width="50%" bgcolor="#CCCCCC" align="center" >NAMA REKENING</TD>                        
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>                       
                     </TR>
                     </THEAD>';           
                
                $idx=1;
                

                $saldo_debet1=0;
                $saldo_debet=0;
                $saldo_kredit1=0;
                $saldo_kredit=0;


                $query = $this->db->query("select distinct z.kd_rek5,ltrim(z.nm_rek5) as nm_rek5,
                isnull(sum(z.debet),0) as debet,isnull(sum(z.kredit),0) as kredit from (             
                SELECT DISTINCT isnull(a.kd_rek5,'') kd_rek5 , isnull(c.nm_rek64,'') nm_rek5,sum(debet) as debet,sum(kredit) as kredit 
                FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd
                inner join ms_rek5 c on a.kd_rek5=c.kd_rek64 
                 where kd_skpd= '$skpd' and kd_subkegiatan in ('95') and year(b.tgl_voucher)='$thn_ang' and  b.tabel<>'1' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'
                 group by a.kd_rek5,c.nm_rek64                   
                 ) z
                 group by z.kd_rek5,ltrim(z.nm_rek5)
                 order by z.kd_rek5
                 ");  
                 
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $kd_rek5=$res['kd_rek5'];
                    $nm_rek5=$res['nm_rek5'];               
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $idx++;
                            
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $saldo_debet=$debet-$kredit;
                        
                    }else{
                        $saldo_kredit=$kredit-$debet;
                        
                    }
                    
                    if($saldo_debet<0){
                        $saldo_debet1=$saldo_debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $saldo_debet1=$saldo_debet;
                        $c='';
                        $d='';  
                        }
                   
                    if($saldo_kredit<0){
                        $saldo_kredit1=$saldo_kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $saldo_kredit1=$saldo_kredit;
                        $e='';
                        $f='';  
                        }
                    
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($saldo_debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" ></TD>                        
                             </TR>';                    
                    //$jdebet=$jdebet+$saldo_debet1;
                    
                    }else{
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($saldo_kredit1,"2",",",".").''.$f.'</TD>                       
                             </TR>';
                    //$jkredit = $jkredit + $saldo_kredit1;
    
                    }    
                             
                    
                }
                             
                } 

                $query = $this->db->query("select isnull(sum(z.debet),0) as nil_debet,isnull(sum(z.kredit),0) as nil_kredit from (           
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and kd_subkegiatan in ('95') and year(b.tgl_voucher)='$thn_ang' and b.tabel<>'1' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'  
                 ) z
                 ");  
                 
                foreach($query->result_array() as $res){
                                                
                    $jmldebet=$res['nil_debet'];
                    $jmlkredit=$res['nil_kredit'];
                    $idx++;             
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="50%" align="center" >JUMLAH</TD>             
                    <TD width="15%" align="right" >'.$k.''.number_format($jmldebet,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jmlkredit,"2",",",".").''.$n.'</TD>                   
                 </TR>';
                $cRet .='</TABLE>'; 
                }
             
             $ttd=str_replace("a"," ",$ttd);
             $sqlsc="SELECT nama,jabatan,pangkat FROM ms_ttd_blud where nip='$ttd' AND kode='PA'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd = $rowttd->nama;
                    $jabatan = $rowttd->jabatan;
                    $pangkat = $rowttd->pangkat;
                    $nip = 'NIP. '.$ttd;
                } 
             
             $cRet .="<table style=\"border-collapse:collapse;font-family:Arial;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\"></td>
                </tr>
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">Pontianak, 31 Desember 2016<br>$jabatan<br><br><br><br><br><b><u>$nama_ttd</u></b><br>$pangkat<br>$nip
                    </td>
                </tr>
                </table>";
             
            if($jenis == 1){
            echo '<title> Neraca Saldo BLUD</title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
    }

    
function cetakneraca_saldo_blud_sap($dcetak='',$ttd='',$skpd='',$dcetak2='', $jenis=''){ 
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1=$thn_ang-1;
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>NERACA SALDO </B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >SKPD</TD>
                        <TD align="left" width="80%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd').'</TD>
                     </TR>                   
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >KODE</TD>
                        <TD width="50%" bgcolor="#CCCCCC" align="center" >NAMA REKENING</TD>                        
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>                       
                     </TR>
                     </THEAD>';           
                
                $idx=1;
                

                $saldo_debet1=0;
                $saldo_debet=0;
                $saldo_kredit1=0;
                $saldo_kredit=0;

                $mbuhah="select distinct z.kd_rek5,ltrim(a.nm_rek64) nm_rek5,isnull(sum(z.debet),0) as debet,isnull(sum(z.kredit),0) as kredit from (
                SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(ltrim(nm_rek5),'') nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and LEFT(kd_rek5,1) in ('1','2','3') and kd_rek5<>'3110101' and a.kd_subkegiatan='95'
                 group by kd_rek5,nm_rek5
                 union all
                select '3110101' kd_rek5,'Ekuitas' nm_rek5,0 as debet,sum(q.kredit)-sum(q.debet) as kredit from (
                SELECT DISTINCT '' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and kd_rek5='3110101' and a.kd_subkegiatan='95'
                 group by kd_rek5,nm_rek5
                 union all
                SELECT DISTINCT '3110101' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='9' and a.kd_subkegiatan='95'
                 group by kd_rek5,nm_rek5
                 union all
                SELECT DISTINCT '3110101' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='8' and a.kd_subkegiatan='95'
                 group by kd_rek5,nm_rek5                    
                ) q     
                 union all               
                SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(ltrim(nm_rek5),'') nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' and a.kd_subkegiatan='95'
                 group by kd_rek5,ltrim(nm_rek5)                 
                 ) z
                 inner join
                 ms_rek5 a
                 on a.kd_rek64=z.kd_rek5
                 group by z.kd_rek5,a.nm_rek64
                 order by z.kd_rek5
                 ";
               //  echo "$mbuhah";
                $query = $this->db->query($mbuhah);  
                 
                if ($query->num_rows() > 0){
                $jdebet=0;
                $jkredit=0;
                foreach($query->result_array() as $res){
                                        
                    $kd_rek5=$res['kd_rek5'];
                    $nm_rek5=$res['nm_rek5'];               
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $idx++;
                            
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $saldo_debet=$debet-$kredit;
                        
                    }else{
                        $saldo_kredit=$kredit-$debet;
                        
                    }
                    
                    if($saldo_debet<0){
                        $saldo_debet1=$saldo_debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $saldo_debet1=$saldo_debet;
                        $c='';
                        $d='';  
                        }
                   
                    if($saldo_kredit<0){
                        $saldo_kredit1=$saldo_kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $saldo_kredit1=$saldo_kredit;
                        $e='';
                        $f='';  
                        }
                    
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($saldo_debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" ></TD>                        
                             </TR>';                    
                    //$jdebet=$jdebet+$saldo_debet1;
                    
                    }else{
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($saldo_kredit1,"2",",",".").''.$f.'</TD>                       
                             </TR>';
                    //$jkredit = $jkredit + $saldo_kredit1;
    
                    }    
                             
                    
                }
                             
                } 

$query = $this->db->query("select isnull(sum(z.debet),0) as nil_debet,isnull(sum(z.kredit),0) as nil_kredit from (
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and LEFT(kd_rek5,1) in ('1','2','3') and kd_rek5<>'3110101' and a.kd_subkegiatan='95'
                 union all
                select  0 as debet,sum(q.kredit)-sum(q.debet) as kredit from (
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and kd_rek5='3110101' and a.kd_subkegiatan='95'
                 union all
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='9' and a.kd_subkegiatan='95'
                 union all
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='8' and a.kd_subkegiatan='95'      
                ) q     
                 union all               
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2' and a.kd_subkegiatan='95'    
                 ) z
                 ");  
                 
                foreach($query->result_array() as $res){
                                                
                    $jmldebet=$res['nil_debet'];
                    $jmlkredit=$res['nil_kredit'];
                    $idx++;             
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="50%" align="center" >JUMLAH</TD>             
                    <TD width="15%" align="right" >'.$k.''.number_format($jmldebet,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jmlkredit,"2",",",".").''.$n.'</TD>                   
                 </TR>';
                $cRet .='</TABLE>'; 
                }
             
             $ttd=str_replace("a"," ",$ttd);
             $sqlsc="SELECT nama,jabatan,pangkat FROM ms_ttd_blud where nip='$ttd' AND kode='PA'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd = $rowttd->nama;
                    $jabatan = $rowttd->jabatan;
                    $pangkat = $rowttd->pangkat;
                    $nip = 'NIP. '.$ttd;
                } 
             
             $cRet .="<table style=\"border-collapse:collapse;font-family:Arial;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\"></td>
                </tr>
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">Pontianak, 31 Desember 2018<br>$jabatan<br><br><br><br><br><b><u>$nama_ttd</u></b><br>$pangkat<br>$nip
                    </td>
                </tr>
                </table>";
             
            if($jenis == 1){
            echo '<title> Neraca Saldo </title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }

            if($jenis == 3){ //yahya
                header("Content-Type: application/vnd.ms-excel");
                header("Content-Disposition: attachment; filename= $skpd-Neraca_Saldo_Blud.xls");
                echo $cRet;
            }
    }
    

function cetakneraca_saldo_blud_apbd_sap($dcetak='',$ttd='',$skpd='',$dcetak2='', $jenis=''){ 
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1=$thn_ang-1;
            $cRet ='<TABLE width="100%">
                    <TR>
                        <TD align="center" ><B>NERACA SALDO </B></TD>
                    </TR>
                    </TABLE>';

            $cRet .='<TABLE width="100%">
                     <TR>
                        <TD align="left" width="20%" >SKPD</TD>
                        <TD align="left" width="80%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd_blud','kd_skpd').'</TD>
                     </TR>                   
                     <TR>
                        <TD align="left" width="20%" >Periode</TD>
                        <TD align="left" width="80%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
                     </TR>
                     </TABLE>';

            $cRet .='<TABLE style="border-collapse:collapse;" width="100%" align="center" border="1" cellspacing="0" cellpadding="4">
                     <THEAD>
                     <TR>
                        <TD width="10%"  bgcolor="#CCCCCC" align="center" >KODE</TD>
                        <TD width="50%" bgcolor="#CCCCCC" align="center" >NAMA REKENING</TD>                        
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >DEBET</TD>
                        <TD width="15%" bgcolor="#CCCCCC" align="center" >KREDIT</TD>                       
                     </TR>
                     </THEAD>';           
                
                $idx=1;
                

                $saldo_debet1=0;
                $saldo_debet=0;
                $saldo_kredit1=0;
                $saldo_kredit=0;


                $query = $this->db->query("select distinct z.kd_rek5,ltrim(a.nm_rek64) nm_rek5,isnull(sum(z.debet),0) as debet,isnull(sum(z.kredit),0) as kredit from (
                SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(ltrim(nm_rek5),'') nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and LEFT(kd_rek5,1) in ('1','2')
                 group by kd_rek5,nm_rek5
                 union all
                select '3110101' kd_rek5,'Ekuitas' nm_rek5,0 as debet,sum(q.kredit)-sum(q.debet) as kredit from (
                SELECT DISTINCT '' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and kd_rek5='3110101' 
                 group by kd_rek5,nm_rek5
                 union all
                SELECT DISTINCT '3110101' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='9' 
                 group by kd_rek5,nm_rek5
                 union all
                SELECT DISTINCT '3110101' as kd_rek5 , 'Ekuitas' as nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='8' 
                 group by kd_rek5,nm_rek5                    
                ) q     
                 union all               
                SELECT DISTINCT isnull(kd_rek5,'') kd_rek5 , isnull(ltrim(nm_rek5),'') nm_rek5,sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'
                 group by kd_rek5,ltrim(nm_rek5)                 
                 ) z
                 inner join
                 ms_rek5 a
                 on a.kd_rek64=z.kd_rek5
                 group by z.kd_rek5,a.nm_rek64
                 order by z.kd_rek5
                 ");  
                 
                if ($query->num_rows() > 0){
                $debet=0;
                $kredit=0;
                foreach($query->result_array() as $res){
                                        
                    $kd_rek5=$res['kd_rek5'];
                    $nm_rek5=$res['nm_rek5'];               
                    $debet=$res['debet'];
                    $kredit=$res['kredit'];
                    $idx++;
                            
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $saldo_debet=$debet-$kredit;
                        
                    }else{
                        $saldo_kredit=$kredit-$debet;
                        
                    }
                    
                    if($saldo_debet<0){
                        $saldo_debet1=$saldo_debet*-1;
                        $c='(';
                        $d=')';
                        }else{
                        $saldo_debet1=$saldo_debet;
                        $c='';
                        $d='';  
                        }
                   
                    if($saldo_kredit<0){
                        $saldo_kredit1=$saldo_kredit*-1;
                        $e='(';
                        $f=')';
                        }else{
                        $saldo_kredit1=$saldo_kredit;
                        $e='';
                        $f='';  
                        }
                    
                    if ((substr($kd_rek5,0,1)=='9') or (substr($kd_rek5,0,1)=='5') or (substr($kd_rek5,0,2)=='62') or (substr($kd_rek5,0,2)=='72') or (substr($kd_rek5,0,1)=='1')){                 
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" >'.$c.''.number_format($saldo_debet1,"2",",",".").''.$d.'</TD>
                                <TD width="15%" align="right" ></TD>                        
                             </TR>';                    
                    //$jdebet=$jdebet+$saldo_debet1;
                    
                    }else{
                        $cRet .='<TR>
                                <TD width="10%" align="left" >'.$kd_rek5.'</TD>
                                <TD width="50%" align="left" >'.$nm_rek5.'</TD>
                                <TD width="15%" align="right" ></TD>
                                <TD width="15%" align="right" >'.$e.''.number_format($saldo_kredit1,"2",",",".").''.$f.'</TD>                       
                             </TR>';
                    //$jkredit = $jkredit + $saldo_kredit1;
    
                    }    
                             
                    
                }
                             
                } 

                $jdebet=0;
                $jkredit=0;
$query = $this->db->query("select isnull(sum(z.debet),0) as nil_debet,isnull(sum(z.kredit),0) as nil_kredit from (
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and LEFT(kd_rek5,1) in ('1','2') 
                 union all
                select  0 as debet,sum(q.kredit)-sum(q.debet) as kredit from (
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and kd_rek5='3110101' 
                 union all
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='9' 
                 union all
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 month(b.tgl_voucher)<='12' and YEAR(b.tgl_voucher)<='$thn_ang_1' and left(kd_rek5,1)='8'        
                ) q     
                 union all               
                SELECT sum(debet) as debet,sum(kredit) as kredit FROM trdju_sap_blud a inner join trhju_sap_blud b on a.no_voucher=b.no_voucher and a.kd_unit=b.kd_skpd 
                 where kd_skpd= '$skpd' and
                 b.tgl_voucher>='$dcetak' AND b.tgl_voucher<='$dcetak2'      
                 ) z
                 ");  
                 
                foreach($query->result_array() as $res){
                                                
                    $jmldebet=$res['nil_debet'];
                    $jmlkredit=$res['nil_kredit'];
                    $idx++;             
                if($jdebet<0){
                        $jdebet1=$jdebet*-1;
                        $k='(';
                        $l=')';
                        }else{
                        $jdebet1=$jdebet;
                        $k='';
                        $l='';  
                        }
                if($jkredit<0){
                        $jkredit1=$jkredit*-1;
                        $m='(';
                        $n=')';
                        }else{
                        $jkredit1=$jkredit;
                        $m='';
                        $n='';  
                        }
                
                $cRet .='<TR>
                    <TD width="10%" align="left" ></TD>
                    <TD width="50%" align="center" >JUMLAH</TD>             
                    <TD width="15%" align="right" >'.$k.''.number_format($jmldebet,"2",",",".").''.$l.'</TD>
                    <TD width="15%" align="right" >'.$m.''.number_format($jmlkredit,"2",",",".").''.$n.'</TD>                   
                 </TR>';
                $cRet .='</TABLE>'; 
                }
             
             $ttd=str_replace("a"," ",$ttd);
             $sqlsc="SELECT nama,jabatan,pangkat FROM ms_ttd_blud where nip='$ttd' AND kode='PA'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd = $rowttd->nama;
                    $jabatan = $rowttd->jabatan;
                    $pangkat = $rowttd->pangkat;
                    $nip = 'NIP. '.$ttd;
                } 
             
             $cRet .="<table style=\"border-collapse:collapse;font-family:Arial;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\"></td>
                </tr>
                <tr>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">Pontianak, 31 Desember 2018<br>$jabatan<br><br><br><br><br><b><u>$nama_ttd</u></b><br>$pangkat<br>$nip
                    </td>
                </tr>
                </table>";
             
            if($jenis == 1){
            echo '<title> Neraca Saldo </title>';
            echo $cRet;
            }
            if($jenis ==2){
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0'); 
            }
             
            if($jenis==3){
                header("Content-Type: application/vnd.ms-excel");
                header("Content-Disposition: attachment; filename= $skpd-Neraca_Saldo.xls");
                echo $cRet;
            }
    }
    
    
        


    
    function ctk_neraca_rekap_blud(){
        $data['page_title']= 'NERACA REKAP BLUD';
        $this->template->set('title', 'NERACA REKAP BLUD');   
        $this->template->load('template','akuntansi/cetak_neraca_rekap_blud',$data) ;   
    }   



        
    function cetak_neraca_rekap_blud($cbulan="",$pilih=""){

        $cetak='2';
        $id     = $this->session->userdata('kdskpd');
        $thn_ang = $this->session->userdata('pcThang');
        $thn_ang_1= $thn_ang-1; 

     
     $modtahun= $thn_ang%4;
     
     if ($modtahun = 0){
        $nilaibulan=".31 JANUARI.29 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
            else {
        $nilaibulan=".31 JANUARI.28 FEBRUARI.31 MARET.30 APRIL.31 MEI.30 JUNI.31 JULI.31 AGUSTUS.30 SEPTEMBER.31 OKTOBER.30 NOVEMBER.31 DESEMBER";}
     
     $arraybulan=explode(".",$nilaibulan);
        $cRet='';
        
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"250%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI NERACA BLUD KOTA PONTIANAK</strong></td>
                    </tr>                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN $arraybulan[$cbulan] $thn_ang </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>&nbsp</strong></td>
                    </tr>
                  </table>";   
     
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"250%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>NO</b></td>                            
                            <td colspan =\"6\" bgcolor=\"#CCCCCC\" width=\"35%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL DINAS KESEHATAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL RSUD SULTAN SYARIF MOHAMAD ALKADRIE KOTA PONTIANAK </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. ALIANYANG </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSK PAL TIGA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. KARYA MULYA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. KOMYOS SUDARSO </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. PERUMNAS II </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. PAL LIMA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. KHATULISTIWA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. SIATAN TENGAH </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. SIANTAN HULU </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. TELAGA BIRU </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. KAMPUNG DALAM </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. TANJUNG HULU </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. BANJAR SERASAN </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. TAMBELAN SAMPIT </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. PARIT MAYOR </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPTD PUSKM. KEC. PONTIANAK TENGGARA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. PARIT HAJI HUSIN II </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPTD PUSKM. KEC. PONTIANAK SELATAN </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPK PUSKM. PURNAMA </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL PUSKESMAS KAMPUNG BALI </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL PUSKESMAS SAIGON </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL PUSKESMAS PERUMNAS SATU </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL PUSKESMAS SIANTAN HILIR </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL LABORATORIUM KESEHATAN </b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>TOTAL UPTD PUSAT PENGOBATAN MATA DAN GIGI </b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan =\"6\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td> 
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td> 
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td> 
                            <td style=\"border-top: none;\"></td>                        
                         </tr>
                     </tfoot>                   
                     <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">&nbsp;</td>                            
                            <td colspan =\"6\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"35%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                        </tr>";

        $sqlmaplo="select  a.urut bold,a.kd_rek64 kode,a.nm_rek64 nm_rek, isnull(sum(a.nilai_real),0) as nilai_total,
                            isnull(sum(nilai_real_1_02_01_00),0) as nilai_1_02_01_00,
                            isnull(sum(nilai_real_1_02_01_01),0) as nilai_1_02_01_01,
                            isnull(sum(nilai_real_1_02_01_02),0) as nilai_1_02_01_02,
                            isnull(sum(nilai_real_1_02_01_03),0) as nilai_1_02_01_03,
                            isnull(sum(nilai_real_1_02_01_04),0) as nilai_1_02_01_04,
                            isnull(sum(nilai_real_1_02_01_05),0) as nilai_1_02_01_05,
                            isnull(sum(nilai_real_1_02_01_06),0) as nilai_1_02_01_06,
                            isnull(sum(nilai_real_1_02_01_07),0) as nilai_1_02_01_07,
                            isnull(sum(nilai_real_1_02_01_08),0) as nilai_1_02_01_08,
                            isnull(sum(nilai_real_1_02_01_09),0) as nilai_1_02_01_09,
                            isnull(sum(nilai_real_1_02_01_10),0) as nilai_1_02_01_10,
                            isnull(sum(nilai_real_1_02_01_11),0) as nilai_1_02_01_11,
                            isnull(sum(nilai_real_1_02_01_12),0) as nilai_1_02_01_12,
                            isnull(sum(nilai_real_1_02_01_13),0) as nilai_1_02_01_13,
                            isnull(sum(nilai_real_1_02_01_14),0) as nilai_1_02_01_14,
                            isnull(sum(nilai_real_1_02_01_15),0) as nilai_1_02_01_15,
                            isnull(sum(nilai_real_1_02_01_16),0) as nilai_1_02_01_16,
                            isnull(sum(nilai_real_1_02_01_17),0) as nilai_1_02_01_17,
                            isnull(sum(nilai_real_1_02_01_18),0) as nilai_1_02_01_18,
                            isnull(sum(nilai_real_1_02_01_19),0) as nilai_1_02_01_19,
                            isnull(sum(nilai_real_1_02_01_20),0) as nilai_1_02_01_20,
                            isnull(sum(nilai_real_1_02_01_21),0) as nilai_1_02_01_21,
                            isnull(sum(nilai_real_1_02_01_22),0) as nilai_1_02_01_22,
                            isnull(sum(nilai_real_1_02_01_23),0) as nilai_1_02_01_23,
                            isnull(sum(nilai_real_1_02_01_24),0) as nilai_1_02_01_24,
                            isnull(sum(nilai_real_1_02_01_25),0) as nilai_1_02_01_25,
                            isnull(sum(nilai_real_1_02_01_26),0) as nilai_1_02_01_26
                            from realisasi_neraca_opd_obyek_blud ($cbulan,$thn_ang) a
                            group by a.urut,a.kd_rek64,a.nm_rek64
                            order by a.kd_rek64,a.urut";
                   
                $querymaplo = $this->db->query($sqlmaplo);
                $no     = 0;                                  
               
                foreach ($querymaplo->result() as $loquery)
                {
                    $bold       = $loquery->bold;
                    $kode       = $loquery->kode;
                    $nama     = $loquery->nm_rek;
                    $nil        = $loquery->nilai_total;
                    $nil_1_02_01_00  = $loquery->nilai_1_02_01_00;
                    $nil_1_02_01_01  = $loquery->nilai_1_02_01_01;
                    $nil_1_02_01_02  = $loquery->nilai_1_02_01_02;
                    $nil_1_02_01_03  = $loquery->nilai_1_02_01_03;
                    $nil_1_02_01_04  = $loquery->nilai_1_02_01_04;
                    $nil_1_02_01_05  = $loquery->nilai_1_02_01_05;
                    $nil_1_02_01_06  = $loquery->nilai_1_02_01_06;
                    $nil_1_02_01_07  = $loquery->nilai_1_02_01_07;
                    $nil_1_02_01_08  = $loquery->nilai_1_02_01_08;
                    $nil_1_02_01_09  = $loquery->nilai_1_02_01_09;
                    $nil_1_02_01_10  = $loquery->nilai_1_02_01_10;
                    $nil_1_02_01_11  = $loquery->nilai_1_02_01_11;
                    $nil_1_02_01_12  = $loquery->nilai_1_02_01_12;
                    $nil_1_02_01_13  = $loquery->nilai_1_02_01_13;
                    $nil_1_02_01_14  = $loquery->nilai_1_02_01_14;
                    $nil_1_02_01_15  = $loquery->nilai_1_02_01_15;
                    $nil_1_02_01_16  = $loquery->nilai_1_02_01_16;
                    $nil_1_02_01_17  = $loquery->nilai_1_02_01_17;
                    $nil_1_02_01_18  = $loquery->nilai_1_02_01_18;
                    $nil_1_02_01_19  = $loquery->nilai_1_02_01_19;
                    $nil_1_02_01_20  = $loquery->nilai_1_02_01_20;
                    $nil_1_02_01_21  = $loquery->nilai_1_02_01_21;
                    $nil_1_02_01_22  = $loquery->nilai_1_02_01_22;
                    $nil_1_02_01_23  = $loquery->nilai_1_02_01_23;
                    $nil_1_02_01_24  = $loquery->nilai_1_02_01_24;
                    $nil_1_02_01_25  = $loquery->nilai_1_02_01_25;
                    $nil_1_02_01_26  = $loquery->nilai_1_02_01_26;

                    if ($nil < 0){
                        $lo1="("; $nilai=$nil*-1; $lo2=")";}
                    else {
                        $lo1=""; $nilai=$nil; $lo2="";}     
                    $nilai_tot = number_format($nilai,"2",",",".");
                    
                    
if ($nil_1_02_01_00 < 0){
                        $lo3="("; $nilai_1_02_01_00=$nil_1_02_01_00*-1; $lo4=")";}
                    else {
                        $lo3=""; $nilai_1_02_01_00=$nil_1_02_01_00; $lo4="";}       
                    $nilai_tot_1_02_01_00 = number_format($nilai_1_02_01_00,"2",",",".");
                    
                    
if ($nil_1_02_01_01 < 0){
                        $lo5="("; $nilai_1_02_01_01=$nil_1_02_01_01*-1; $lo6=")";}
                    else {
                        $lo5=""; $nilai_1_02_01_01=$nil_1_02_01_01; $lo6="";}       
                    $nilai_tot_1_02_01_01 = number_format($nilai_1_02_01_01,"2",",",".");
if ($nil_1_02_01_02 < 0){
                        $lo7="("; $nilai_1_02_01_02=$nil_1_02_01_02*-1; $lo8=")";}
                    else {
                        $lo7=""; $nilai_1_02_01_02=$nil_1_02_01_02; $lo8="";}       
                    $nilai_tot_1_02_01_02 = number_format($nilai_1_02_01_02,"2",",",".");
if ($nil_1_02_01_03 < 0){
                        $lo9="("; $nilai_1_02_01_03=$nil_1_02_01_03*-1; $lo10=")";}
                    else {
                        $lo9=""; $nilai_1_02_01_03=$nil_1_02_01_03; $lo10="";}      
                    $nilai_tot_1_02_01_03 = number_format($nilai_1_02_01_03,"2",",",".");
if ($nil_1_02_01_04 < 0){
                        $lo11="("; $nilai_1_02_01_04=$nil_1_02_01_04*-1; $lo12=")";}
                    else {
                        $lo11=""; $nilai_1_02_01_04=$nil_1_02_01_04; $lo12="";}     
                    $nilai_tot_1_02_01_04 = number_format($nilai_1_02_01_04,"2",",",".");
if ($nil_1_02_01_05 < 0){
                        $lo13="("; $nilai_1_02_01_05=$nil_1_02_01_05*-1; $lo14=")";}
                    else {
                        $lo13=""; $nilai_1_02_01_05=$nil_1_02_01_05; $lo14="";}     
                    $nilai_tot_1_02_01_05 = number_format($nilai_1_02_01_05,"2",",",".");
if ($nil_1_02_01_06 < 0){
                        $lo15="("; $nilai_1_02_01_06=$nil_1_02_01_06*-1; $lo16=")";}
                    else {
                        $lo15=""; $nilai_1_02_01_06=$nil_1_02_01_06; $lo16="";}     
                    $nilai_tot_1_02_01_06 = number_format($nilai_1_02_01_06,"2",",",".");
if ($nil_1_02_01_07 < 0){
                        $lo17="("; $nilai_1_02_01_07=$nil_1_02_01_07*-1; $lo18=")";}
                    else {
                        $lo17=""; $nilai_1_02_01_07=$nil_1_02_01_07; $lo18="";}     
                    $nilai_tot_1_02_01_07 = number_format($nilai_1_02_01_07,"2",",",".");
if ($nil_1_02_01_08 < 0){
                        $lo19="("; $nilai_1_02_01_08=$nil_1_02_01_08*-1; $lo20=")";}
                    else {
                        $lo19=""; $nilai_1_02_01_08=$nil_1_02_01_08; $lo20="";}     
                    $nilai_tot_1_02_01_08 = number_format($nilai_1_02_01_08,"2",",",".");
if ($nil_1_02_01_09 < 0){
                        $lo21="("; $nilai_1_02_01_09=$nil_1_02_01_09*-1; $lo22=")";}
                    else {
                        $lo21=""; $nilai_1_02_01_09=$nil_1_02_01_09; $lo22="";}     
                    $nilai_tot_1_02_01_09 = number_format($nilai_1_02_01_09,"2",",",".");
if ($nil_1_02_01_10 < 0){
                        $lo23="("; $nilai_1_02_01_10=$nil_1_02_01_10*-1; $lo24=")";}
                    else {
                        $lo23=""; $nilai_1_02_01_10=$nil_1_02_01_10; $lo24="";}     
                    $nilai_tot_1_02_01_10 = number_format($nilai_1_02_01_10,"2",",",".");
if ($nil_1_02_01_11 < 0){
                        $lo25="("; $nilai_1_02_01_11=$nil_1_02_01_11*-1; $lo26=")";}
                    else {
                        $lo25=""; $nilai_1_02_01_11=$nil_1_02_01_11; $lo26="";}     
                    $nilai_tot_1_02_01_11 = number_format($nilai_1_02_01_11,"2",",",".");
if ($nil_1_02_01_12 < 0){
                        $lo27="("; $nilai_1_02_01_12=$nil_1_02_01_12*-1; $lo28=")";}
                    else {
                        $lo27=""; $nilai_1_02_01_12=$nil_1_02_01_12; $lo28="";}     
                    $nilai_tot_1_02_01_12 = number_format($nilai_1_02_01_12,"2",",",".");
if ($nil_1_02_01_13 < 0){
                        $lo29="("; $nilai_1_02_01_13=$nil_1_02_01_13*-1; $lo30=")";}
                    else {
                        $lo29=""; $nilai_1_02_01_13=$nil_1_02_01_13; $lo30="";}     
                    $nilai_tot_1_02_01_13 = number_format($nilai_1_02_01_13,"2",",",".");
if ($nil_1_02_01_14 < 0){
                        $lo31="("; $nilai_1_02_01_14=$nil_1_02_01_14*-1; $lo32=")";}
                    else {
                        $lo31=""; $nilai_1_02_01_14=$nil_1_02_01_14; $lo32="";}     
                    $nilai_tot_1_02_01_14 = number_format($nilai_1_02_01_14,"2",",",".");
if ($nil_1_02_01_15 < 0){
                        $lo33="("; $nilai_1_02_01_15=$nil_1_02_01_15*-1; $lo34=")";}
                    else {
                        $lo33=""; $nilai_1_02_01_15=$nil_1_02_01_15; $lo34="";}     
                    $nilai_tot_1_02_01_15 = number_format($nilai_1_02_01_15,"2",",",".");
if ($nil_1_02_01_16 < 0){
                        $lo35="("; $nilai_1_02_01_16=$nil_1_02_01_16*-1; $lo36=")";}
                    else {
                        $lo35=""; $nilai_1_02_01_16=$nil_1_02_01_16; $lo36="";}     
                    $nilai_tot_1_02_01_16 = number_format($nilai_1_02_01_16,"2",",",".");
if ($nil_1_02_01_17 < 0){
                        $lo37="("; $nilai_1_02_01_17=$nil_1_02_01_17*-1; $lo38=")";}
                    else {
                        $lo37=""; $nilai_1_02_01_17=$nil_1_02_01_17; $lo38="";}     
                    $nilai_tot_1_02_01_17 = number_format($nilai_1_02_01_17,"2",",",".");
if ($nil_1_02_01_18 < 0){
                        $lo39="("; $nilai_1_02_01_18=$nil_1_02_01_18*-1; $lo40=")";}
                    else {
                        $lo39=""; $nilai_1_02_01_18=$nil_1_02_01_18; $lo40="";}     
                    $nilai_tot_1_02_01_18 = number_format($nilai_1_02_01_18,"2",",",".");
if ($nil_1_02_01_19 < 0){
                        $lo41="("; $nilai_1_02_01_19=$nil_1_02_01_19*-1; $lo42=")";}
                    else {
                        $lo41=""; $nilai_1_02_01_19=$nil_1_02_01_19; $lo42="";}     
                    $nilai_tot_1_02_01_19 = number_format($nilai_1_02_01_19,"2",",",".");
if ($nil_1_02_01_20 < 0){
                        $lo43="("; $nilai_1_02_01_20=$nil_1_02_01_20*-1; $lo44=")";}
                    else {
                        $lo43=""; $nilai_1_02_01_20=$nil_1_02_01_20; $lo44="";}     
                    $nilai_tot_1_02_01_20 = number_format($nilai_1_02_01_20,"2",",",".");
if ($nil_1_02_01_21 < 0){
                        $lo45="("; $nilai_1_02_01_21=$nil_1_02_01_21*-1; $lo46=")";}
                    else {
                        $lo45=""; $nilai_1_02_01_21=$nil_1_02_01_21; $lo46="";}     
                    $nilai_tot_1_02_01_21 = number_format($nilai_1_02_01_21,"2",",",".");
if ($nil_1_02_01_22 < 0){
                        $lo47="("; $nilai_1_02_01_22=$nil_1_02_01_22*-1; $lo48=")";}
                    else {
                        $lo47=""; $nilai_1_02_01_22=$nil_1_02_01_22; $lo48="";}     
                    $nilai_tot_1_02_01_22 = number_format($nilai_1_02_01_22,"2",",",".");
if ($nil_1_02_01_23 < 0){
                        $lo49="("; $nilai_1_02_01_23=$nil_1_02_01_23*-1; $lo50=")";}
                    else {
                        $lo49=""; $nilai_1_02_01_23=$nil_1_02_01_23; $lo50="";}     
                    $nilai_tot_1_02_01_23 = number_format($nilai_1_02_01_23,"2",",",".");
if ($nil_1_02_01_24 < 0){
                        $lo51="("; $nilai_1_02_01_24=$nil_1_02_01_24*-1; $lo52=")";}
                    else {
                        $lo51=""; $nilai_1_02_01_24=$nil_1_02_01_24; $lo52="";}     
                    $nilai_tot_1_02_01_24 = number_format($nilai_1_02_01_24,"2",",",".");
if ($nil_1_02_01_25 < 0){
                        $lo53="("; $nilai_1_02_01_25=$nil_1_02_01_25*-1; $lo54=")";}
                    else {
                        $lo53=""; $nilai_1_02_01_25=$nil_1_02_01_25; $lo54="";}     
                    $nilai_tot_1_02_01_25 = number_format($nilai_1_02_01_25,"2",",",".");
if ($nil_1_02_01_26 < 0){
                        $lo55="("; $nilai_1_02_01_26=$nil_1_02_01_26*-1; $lo56=")";}
                    else {
                        $lo55=""; $nilai_1_02_01_26=$nil_1_02_01_26; $lo56="";}     
                    $nilai_tot_1_02_01_26 = number_format($nilai_1_02_01_26,"2",",",".");
                    
                    
                    $no       = $no + 1;
                    switch ($loquery->bold) {
                    case 0:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 1:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td colspan =\"6\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 2:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"5\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td>
                                 </tr>";
                        break;
                    case 3:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"><b>$no<b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"><b>$nama<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo1$nilai_tot$lo2<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo3$nilai_tot_1_02_01_00$lo4<b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo5$nilai_tot_1_02_01_01$lo6<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo7$nilai_tot_1_02_01_02$lo8<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo9$nilai_tot_1_02_01_03$lo10<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo11$nilai_tot_1_02_01_04$lo12<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo13$nilai_tot_1_02_01_05$lo14<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo15$nilai_tot_1_02_01_06$lo16<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo17$nilai_tot_1_02_01_07$lo18<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo19$nilai_tot_1_02_01_08$lo20<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo21$nilai_tot_1_02_01_09$lo22<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo23$nilai_tot_1_02_01_10$lo24<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo25$nilai_tot_1_02_01_11$lo26<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo27$nilai_tot_1_02_01_12$lo28<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo29$nilai_tot_1_02_01_13$lo30<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo31$nilai_tot_1_02_01_14$lo32<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo33$nilai_tot_1_02_01_15$lo34<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo35$nilai_tot_1_02_01_16$lo36<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo37$nilai_tot_1_02_01_17$lo38<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo39$nilai_tot_1_02_01_18$lo40<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo41$nilai_tot_1_02_01_19$lo42<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo43$nilai_tot_1_02_01_20$lo44<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo45$nilai_tot_1_02_01_21$lo46<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo47$nilai_tot_1_02_01_22$lo48<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo49$nilai_tot_1_02_01_23$lo50<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo51$nilai_tot_1_02_01_24$lo52<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo53$nilai_tot_1_02_01_25$lo54<b></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><b>$lo55$nilai_tot_1_02_01_26$lo56<b></td>
                                     </tr>";
                        break;
                    case 4:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo1$nilai_tot$lo2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo3$nilai_tot_1_02_01_00$lo4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo5$nilai_tot_1_02_01_01$lo6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo7$nilai_tot_1_02_01_02$lo8</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo9$nilai_tot_1_02_01_03$lo10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo11$nilai_tot_1_02_01_04$lo12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo13$nilai_tot_1_02_01_05$lo14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo15$nilai_tot_1_02_01_06$lo16</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo17$nilai_tot_1_02_01_07$lo18</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo19$nilai_tot_1_02_01_08$lo20</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo21$nilai_tot_1_02_01_09$lo22</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo23$nilai_tot_1_02_01_10$lo24</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo25$nilai_tot_1_02_01_11$lo26</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo27$nilai_tot_1_02_01_12$lo28</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo29$nilai_tot_1_02_01_13$lo30</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo31$nilai_tot_1_02_01_14$lo32</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo33$nilai_tot_1_02_01_15$lo34</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo35$nilai_tot_1_02_01_16$lo36</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo37$nilai_tot_1_02_01_17$lo38</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo39$nilai_tot_1_02_01_18$lo40</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo41$nilai_tot_1_02_01_19$lo42</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo43$nilai_tot_1_02_01_20$lo44</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo45$nilai_tot_1_02_01_21$lo46</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo47$nilai_tot_1_02_01_22$lo48</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo49$nilai_tot_1_02_01_23$lo50</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo51$nilai_tot_1_02_01_24$lo52</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo53$nilai_tot_1_02_01_25$lo54</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo55$nilai_tot_1_02_01_26$lo56</td>
                                 </tr>";
                        break;              
                    case 5:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"> $no </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td colspan =\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo1$nilai_tot$lo2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo3$nilai_tot_1_02_01_00$lo4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo5$nilai_tot_1_02_01_01$lo6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo7$nilai_tot_1_02_01_02$lo8</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo9$nilai_tot_1_02_01_03$lo10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo11$nilai_tot_1_02_01_04$lo12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo13$nilai_tot_1_02_01_05$lo14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo15$nilai_tot_1_02_01_06$lo16</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo17$nilai_tot_1_02_01_07$lo18</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo19$nilai_tot_1_02_01_08$lo20</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo21$nilai_tot_1_02_01_09$lo22</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo23$nilai_tot_1_02_01_10$lo24</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo25$nilai_tot_1_02_01_11$lo26</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo27$nilai_tot_1_02_01_12$lo28</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo29$nilai_tot_1_02_01_13$lo30</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo31$nilai_tot_1_02_01_14$lo32</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo33$nilai_tot_1_02_01_15$lo34</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo35$nilai_tot_1_02_01_16$lo36</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo37$nilai_tot_1_02_01_17$lo38</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo39$nilai_tot_1_02_01_18$lo40</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo41$nilai_tot_1_02_01_19$lo42</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo43$nilai_tot_1_02_01_20$lo44</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo45$nilai_tot_1_02_01_21$lo46</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo47$nilai_tot_1_02_01_22$lo48</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo49$nilai_tot_1_02_01_23$lo50</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo51$nilai_tot_1_02_01_24$lo52</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo53$nilai_tot_1_02_01_25$lo54</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo55$nilai_tot_1_02_01_26$lo56</td>
                                 </tr>";
                        break;
                    case 6:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"> $no </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"> $nama </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo1$nilai_tot$lo2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo3$nilai_tot_1_02_01_00$lo4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo5$nilai_tot_1_02_01_01$lo6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo7$nilai_tot_1_02_01_02$lo8</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo9$nilai_tot_1_02_01_03$lo10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo11$nilai_tot_1_02_01_04$lo12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo13$nilai_tot_1_02_01_05$lo14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo15$nilai_tot_1_02_01_06$lo16</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo17$nilai_tot_1_02_01_07$lo18</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo19$nilai_tot_1_02_01_08$lo20</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo21$nilai_tot_1_02_01_09$lo22</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo23$nilai_tot_1_02_01_10$lo24</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo25$nilai_tot_1_02_01_11$lo26</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo27$nilai_tot_1_02_01_12$lo28</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo29$nilai_tot_1_02_01_13$lo30</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo31$nilai_tot_1_02_01_14$lo32</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo33$nilai_tot_1_02_01_15$lo34</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo35$nilai_tot_1_02_01_16$lo36</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo37$nilai_tot_1_02_01_17$lo38</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo39$nilai_tot_1_02_01_18$lo40</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo41$nilai_tot_1_02_01_19$lo42</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo43$nilai_tot_1_02_01_20$lo44</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo45$nilai_tot_1_02_01_21$lo46</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo47$nilai_tot_1_02_01_22$lo48</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo49$nilai_tot_1_02_01_23$lo50</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo51$nilai_tot_1_02_01_24$lo52</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo53$nilai_tot_1_02_01_25$lo54</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo55$nilai_tot_1_02_01_26$lo56</td>
                                    </tr>";
                        break;
                    case 7:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"> $no </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"> $nama </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo1$nilai_tot$lo2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo3$nilai_tot_1_02_01_00$lo4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo5$nilai_tot_1_02_01_01$lo6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo7$nilai_tot_1_02_01_02$lo8</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo9$nilai_tot_1_02_01_03$lo10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo11$nilai_tot_1_02_01_04$lo12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo13$nilai_tot_1_02_01_05$lo14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo15$nilai_tot_1_02_01_06$lo16</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo17$nilai_tot_1_02_01_07$lo18</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo19$nilai_tot_1_02_01_08$lo20</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo21$nilai_tot_1_02_01_09$lo22</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo23$nilai_tot_1_02_01_10$lo24</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo25$nilai_tot_1_02_01_11$lo26</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo27$nilai_tot_1_02_01_12$lo28</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo29$nilai_tot_1_02_01_13$lo30</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo31$nilai_tot_1_02_01_14$lo32</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo33$nilai_tot_1_02_01_15$lo34</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo35$nilai_tot_1_02_01_16$lo36</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo37$nilai_tot_1_02_01_17$lo38</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo39$nilai_tot_1_02_01_18$lo40</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo41$nilai_tot_1_02_01_19$lo42</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo43$nilai_tot_1_02_01_20$lo44</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo45$nilai_tot_1_02_01_21$lo46</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo47$nilai_tot_1_02_01_22$lo48</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo49$nilai_tot_1_02_01_23$lo50</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo51$nilai_tot_1_02_01_24$lo52</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo53$nilai_tot_1_02_01_25$lo54</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo55$nilai_tot_1_02_01_26$lo56</td>
                                 </tr>";
                        break;
                    case 8:
                         $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\"> $no </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"2%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-left: none;border-right: none;\" width=\"35%\"> $nama </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo1$nilai_tot$lo2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo3$nilai_tot_1_02_01_00$lo4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo5$nilai_tot_1_02_01_01$lo6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo7$nilai_tot_1_02_01_02$lo8</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo9$nilai_tot_1_02_01_03$lo10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo11$nilai_tot_1_02_01_04$lo12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo13$nilai_tot_1_02_01_05$lo14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo15$nilai_tot_1_02_01_06$lo16</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo17$nilai_tot_1_02_01_07$lo18</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo19$nilai_tot_1_02_01_08$lo20</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo21$nilai_tot_1_02_01_09$lo22</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo23$nilai_tot_1_02_01_10$lo24</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo25$nilai_tot_1_02_01_11$lo26</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo27$nilai_tot_1_02_01_12$lo28</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo29$nilai_tot_1_02_01_13$lo30</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo31$nilai_tot_1_02_01_14$lo32</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo33$nilai_tot_1_02_01_15$lo34</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo35$nilai_tot_1_02_01_16$lo36</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo37$nilai_tot_1_02_01_17$lo38</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo39$nilai_tot_1_02_01_18$lo40</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo41$nilai_tot_1_02_01_19$lo42</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo43$nilai_tot_1_02_01_20$lo44</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo45$nilai_tot_1_02_01_21$lo46</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo47$nilai_tot_1_02_01_22$lo48</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo49$nilai_tot_1_02_01_23$lo50</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo51$nilai_tot_1_02_01_24$lo52</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo53$nilai_tot_1_02_01_25$lo54</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$lo55$nilai_tot_1_02_01_26$lo56</td>
                                 </tr>";
                        break;  
                }
                 
                }                
    
       // $cRet         .= "</table>";
//        $data['prev']  = $cRet;
//        $data['sikap'] = 'preview';
//        
//        
//        
//        $this->template->set('title', 'LAPORAN OPERASIONAL'); 
//        $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');
        //$this->template->load('template','anggaran/rka/perkadaII',$data); 
        
        $cRet .=       " </table>";
 /*       
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_bos where kd_skpd='$kd_skpd' and kode='PABOS' and nip='$ttd1'";
            $sqlttd=$this->db->query($sqlttd1);
            foreach ($sqlttd->result() as $rowttd)
            
                {
                    $nip=$rowttd->nip;                    
                    $oioi= $rowttd->nm;
                    $jabatan = $rowttd->jab;
                }   
            
            $sqlttd12="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd_bos where kd_skpd='$kd_skpd' and kode='BPBOS' and nip='$ttd2'";
            $sqlttd2=$this->db->query($sqlttd12);
            foreach ($sqlttd2->result() as $rowttd)
            
                {
                    $nip2=$rowttd->nip;                    
                    $oioi2= $rowttd->nm;
                    $jabatan2 = $rowttd->jab;
                }   

            
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> Mengetahui,</td>
         <td align=\"center\" width=\"50%\"> Pontianak, $ctgl_ttd </td>
         </tr>      
         <tr>
         <td align=\"center\" width=\"50%\"> $jabatan </td>
         <td align=\"center\" width=\"50%\"> $jabatan2 </td>
         </tr>  
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
          <tr>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         <td align=\"center\" width=\"50%\"> &nbsp; </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> $oioi</td>
         <td align=\"center\" width=\"50%\"> $oioi2 </td>
         </tr>
         <tr>
         <td align=\"center\" width=\"50%\"> NIP :$nip</td>
         <td align=\"center\" width=\"50%\"> NIP :$nip2 </td>
         </tr>
         </table>
         ";
 */       
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul  = ("NERACA REKAP BLUD $cbulan");
        $this->template->set('title', 'NERACA REKAP BLUD  $cbulan');        
        switch($pilih) {       
        case 1;
            echo ("<title>NERACA REKAP BLUD $cbulan</title>");
             echo $cRet;
        break;
        case 2;        
;
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            echo $cRet;
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
        
                 
    }
    
    }
